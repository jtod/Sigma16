<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2025-02-01 Sat 22:49 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Sigma16 User Guide</title>
<meta name="author" content="John T. O'Donnell" />
<meta name="generator" content="Org Mode" />
<style>
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
<link rel="stylesheet" href="../Sigma.css">
<link rel="icon" type="image/png" href="../../src/graphics/favicon.ico">
<style type="text/css"> td { padding: 4px 5px 4px 5px } </style>
<script>
  window.MathJax = {
    tex: {
      ams: {
        multlineWidth: '85%'
      },
      tags: 'ams',
      tagSide: 'right',
      tagIndent: '.8em'
    },
    chtml: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    svg: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    output: {
      font: 'mathjax-modern',
      displayOverflow: 'overflow'
    }
  };
</script>

<script
  id="MathJax-script"
  async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>
</head>
<body>
<div id="preamble" class="status">
<h1 class="title">Sigma16 User Guide</h1>
          <p class="author">John T. O'Donnell</p>
          <p class="date">Version 3.9.0, February 2025</p>
</div>
<div id="content" class="content">
<h1 class="title">Sigma16 User Guide</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#orgc60285a">Introduction</a>
<ul>
<li><a href="#org41edae9">Running Sigma16</a></li>
<li><a href="#orgb50a7c2">Browser compatibility</a></li>
<li><a href="#orgf340c8d">Organization</a></li>
</ul>
</li>
<li><a href="#sec-core-tutorial">Core architecture tutorials</a>
<ul>
<li><a href="#org0d78d31">Hello, world!</a></li>
<li><a href="#org450c1b9">A quick tour</a></li>
<li><a href="#org9d20265">Registers, constants, and arithmetic</a>
<ul>
<li><a href="#orgbabc823">Running an example program</a></li>
</ul>
</li>
<li><a href="#org7b17fbc">Keeping variables in memory</a>
<ul>
<li><a href="#org3144791">load and store</a></li>
<li><a href="#orgdc00d1c">The data statement</a></li>
<li><a href="#org33e77ac">Relationship between arrays, registers, memory</a></li>
</ul>
</li>
<li><a href="#org0106fde">Assembly language</a></li>
<li><a href="#orge87d73a">The Editor</a></li>
<li><a href="#org47a51aa">Jumps and conditionals</a></li>
<li><a href="#orgf71ac8f">Loops</a></li>
<li><a href="#org00d9a62">Machine language</a>
<ul>
<li><a href="#orgcb03123">RRR instructions</a></li>
<li><a href="#orgc5f6df1">RX instructions</a></li>
<li><a href="#org94da082">Pseudoinstructions</a></li>
</ul>
</li>
<li><a href="#org0442997">A strange program</a>
<ul>
<li><a href="#org75bbd5b">The problem</a></li>
<li><a href="#orgb6e08fe">Solution</a></li>
</ul>
</li>
<li><a href="#org4ebc607">Breakpoints</a>
<ul>
<li><a href="#org0baece2">Trap break</a></li>
<li><a href="#org6836513">External break</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org75e4918">Standard architecture tutorials</a>
<ul>
<li><a href="#orgc415097">Defining symbols with equ</a></li>
<li><a href="#org372841a">Some notations for convenience</a>
<ul>
<li><a href="#org4a2d95d">; before comment is optional if operand field exists</a></li>
<li><a href="#org0e10728">[R0] is assumed if it's omitted</a></li>
</ul>
</li>
<li><a href="#org1e9157e">Common logic operations</a>
<ul>
<li><a href="#orga3308b1">Word logic</a></li>
<li><a href="#org32b4fce">Bit logic</a></li>
</ul>
</li>
<li><a href="#orge79498d">Bit manipulation</a>
<ul>
<li><a href="#org9ee9665">Accessing individual bits</a></li>
<li><a href="#org9cab49a">Shifting</a></li>
<li><a href="#org72fdc72">Extracting fields</a></li>
</ul>
</li>
<li><a href="#org355ec53">Saving and restoring contiguous registers</a></li>
</ul>
</li>
<li><a href="#sec-architecture">The Sigma16 architecture</a>
<ul>
<li><a href="#orgf9fe977">Implementations</a></li>
<li><a href="#orga9dba66">Subsystems</a></li>
<li><a href="#org61bb1e6">Words</a>
<ul>
<li><a href="#org1dfbcdc">Indexing bits in a word</a></li>
<li><a href="#orga0cc873">Fields</a></li>
<li><a href="#orgbcc9ffb">Natural numbers</a></li>
<li><a href="#orgfc1bbb8">Integers</a></li>
<li><a href="#org28f79bc">Notations for a word</a></li>
</ul>
</li>
<li><a href="#orgf3bf9ed">Memory</a></li>
<li><a href="#orga8e6daa">Registers</a>
<ul>
<li><a href="#org58d0120">Register file</a></li>
<li><a href="#orgfb38869">Condition code</a></li>
<li><a href="#orgfce8ec5">Instruction control registers</a></li>
</ul>
</li>
<li><a href="#orgb870d88">Interrupts</a>
<ul>
<li><a href="#orgcf9c22e">mask - interrupt mask register</a></li>
<li><a href="#org4ef2736">request - interrupt request register</a></li>
<li><a href="#org599b549">rstat register</a></li>
<li><a href="#org0595c7d">rpc register</a></li>
<li><a href="#org9501088">vect register</a></li>
</ul>
</li>
<li><a href="#orgb8e51f8">Memory management registers</a></li>
</ul>
</li>
<li><a href="#sec-instruction-set">Instruction set</a>
<ul>
<li><a href="#org8cc6679">Instruction representation</a>
<ul>
<li><a href="#orgb029382">RRR format</a></li>
<li><a href="#org4ec8aed">RX format</a></li>
<li><a href="#org1ef15d2">EXP format</a></li>
<li><a href="#org37ad479">Notation for machine language</a></li>
</ul>
</li>
<li><a href="#org43f2f57">Arithmetic</a>
<ul>
<li><a href="#org56ae76f">add</a></li>
<li><a href="#org6408d23">sub</a></li>
<li><a href="#org3ed7f86">mul</a></li>
<li><a href="#orgf877e89">div</a></li>
<li><a href="#org3a65fbb">cmp</a></li>
<li><a href="#orgb9b9a28">addc</a></li>
<li><a href="#orgcdac4c0">muln</a></li>
<li><a href="#org310aa93">divn</a></li>
</ul>
</li>
<li><a href="#orgc8e6d9f">Accessing memory</a>
<ul>
<li><a href="#orgfac14a3">lea</a></li>
<li><a href="#orgdc2d938">load</a></li>
<li><a href="#org0157633">store</a></li>
<li><a href="#orga572717">Stacks</a></li>
<li><a href="#org8fa3822">push</a></li>
<li><a href="#org487c92e">pop</a></li>
<li><a href="#org7a5dc2a">top</a></li>
<li><a href="#orgd400804">Stack frames</a></li>
<li><a href="#org1813de5">save</a></li>
<li><a href="#orgcd142df">restore</a></li>
</ul>
</li>
<li><a href="#org29abe62">Jumps</a>
<ul>
<li><a href="#org311ef61">jump</a></li>
<li><a href="#org0ef39b5">jumpc0, jumpc1</a></li>
<li><a href="#orgad90905">jal</a></li>
<li><a href="#orgfeef2fd">jumpz, jumpnz</a></li>
</ul>
</li>
<li><a href="#org71b819c">Logic</a>
<ul>
<li><a href="#orgb712da1">General logic functions</a></li>
<li><a href="#org148b0e9">Logic on fields: logicf</a></li>
<li><a href="#orgc2f524b">Word logic pseudoinstructions: invw, andw, orw, xorw</a></li>
<li><a href="#org75fa2a3">Bit logic: logicb</a></li>
<li><a href="#org49e8e57">Pseudoinstructions invb, andb, orb, xorb</a></li>
<li><a href="#org5358e69">Pseudoinstructions setb, clearb, copyb, copybi</a></li>
</ul>
</li>
<li><a href="#org2197358">Bit manipulation</a>
<ul>
<li><a href="#orgc1fec39">Shifting: shiftl, shiftr</a></li>
<li><a href="#org66a0144">Bit fields: extract</a></li>
</ul>
</li>
<li><a href="#orgffa5786">User requests</a>
<ul>
<li><a href="#org265d842">Request to OS: trap</a></li>
<li><a href="#orgc14281e">testset</a></li>
</ul>
</li>
<li><a href="#orgad6c9d0">System control</a>
<ul>
<li><a href="#org07368b5">Accessing control registers: getctl, putctl</a></li>
<li><a href="#orgcffa77e">Context switching: resume</a></li>
<li><a href="#orge96679e">Timer: timeron, timeroff</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org20615c5">Summary of instruction set</a>
<ul>
<li><a href="#orgabbfd23">RRR instructions</a></li>
<li><a href="#org09550e1">RX instructions</a></li>
<li><a href="#org2c91fc7">EXP instructions</a></li>
<li><a href="#orga7889db">Summary of pseudoinstructions</a></li>
</ul>
</li>
<li><a href="#orgbde6406">Assembly language</a>
<ul>
<li><a href="#org370c863">Programs, modules, and files</a>
<ul>
<li><a href="#org87b8c7d">Standalone programs</a></li>
<li><a href="#orgf7615fd">Modules</a></li>
<li><a href="#org4733c95">Modules page</a></li>
<li><a href="#org381bbb3">Editor page</a></li>
<li><a href="#orgf6e9eb6">Files</a></li>
</ul>
</li>
<li><a href="#org0b55b5b">Fixed and relocatable values</a>
<ul>
<li><a href="#org16918ee">Expressions</a></li>
<li><a href="#orgd265a6b">Location counter</a></li>
<li><a href="#orgfe6a65b">Attributes</a></li>
</ul>
</li>
<li><a href="#org400e821">Code generators</a>
<ul>
<li><a href="#orgc052004">Instructions</a></li>
<li><a href="#org396767e">Pseudoinstructions</a></li>
<li><a href="#org8a7cdea">data</a></li>
</ul>
</li>
<li><a href="#orgcbf1518">Directives</a>
<ul>
<li><a href="#org29456d1">module</a></li>
<li><a href="#orga8beddf">import</a></li>
<li><a href="#org9832b36">export</a></li>
</ul>
</li>
<li><a href="#orgc3b0dc3">Assembly listing</a>
<ul>
<li><a href="#orge788e04">equ</a></li>
<li><a href="#org04c9347">reserve</a></li>
<li><a href="#org29dc424">org</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-linker">Object code and linker</a>
<ul>
<li><a href="#org52c6c1f">Object language</a>
<ul>
<li><a href="#orgeeaa58b">Object statement syntax</a></li>
<li><a href="#orga5970aa">module</a></li>
<li><a href="#org72ba6e3">org</a></li>
<li><a href="#org89d076f">data</a></li>
<li><a href="#orga8fd4c6">import</a></li>
<li><a href="#org84c85ed">export</a></li>
<li><a href="#org97f9f04">relocate</a></li>
</ul>
</li>
<li><a href="#org50e7a35">Module metadata</a></li>
<li><a href="#orgabe1f54">Linker</a></li>
<li><a href="#org102d5d9">Booter</a>
<ul>
<li><a href="#org42447ec">Executable code</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-programming">Programming</a>
<ul>
<li><a href="#org7b4bb15">Structure of a program</a></li>
<li><a href="#org6d26b1e">How to perform commmon tasks</a>
<ul>
<li><a href="#org6cec832">Using extract</a></li>
<li><a href="#orga626a3f">Copying one register to another</a></li>
</ul>
</li>
<li><a href="#org9ad6c34">Compilation</a></li>
<li><a href="#org4ae3cc7">Errors: avoiding, finding, and fixing</a></li>
<li><a href="#org79b930b">Procedure call and return</a>
<ul>
<li><a href="#org95fbb30">Critical regions</a></li>
<li><a href="#org1404c7c">Robust programming</a></li>
<li><a href="#org7aaebad">Error messages</a></li>
<li><a href="#org14b33de">Runtime debugging</a></li>
<li><a href="#org43c2298">Breakpoints</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org5ba0053">Installation</a>
<ul>
<li><a href="#org4c90195">Command line tools</a>
<ul>
<li><a href="#org485ea6f">node and npm</a></li>
<li><a href="#org1b5aa04">Configuring the shell</a></li>
<li><a href="#org314cc55">Testing the installation</a></li>
<li><a href="#orgb282431">Building Sigma16</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-about-sigma16">About Sigma16</a>
<ul>
<li><a href="#orgbf9a992">Copyright and license</a></li>
<li><a href="#org5b9ba44">In case of problems</a></li>
</ul>
</li>
<li><a href="#org29d8d55">License</a></li>
<li><a href="#orgf36eb19">A</a></li>
<li><a href="#orgecb049e">C</a></li>
<li><a href="#org8de37af">R</a></li>
</ul>
</div>
</div>

<div id="outline-container-orgc60285a" class="outline-2">
<h2 id="orgc60285a">Introduction</h2>
<div class="outline-text-2" id="text-orgc60285a">
<p>
Sigma16 is a computer architecture designed for research and teaching
in computer systems.  This application provides a complete environment
for experimenting with the architecture.  It includes an editor,
assembler, linker, emulator, a collection of examples, a user guide
with tutorials, and an integrated development environment (IDE) with a
graphical user interface.
</p>
</div>

<div id="outline-container-org41edae9" class="outline-3">
<h3 id="org41edae9">Running Sigma16</h3>
<div class="outline-text-3" id="text-org41edae9">
<p>
Sigma16 runs in a web browser: you don't need to download or install
anything.
</p>

<div style="overflow-x: auto">
<div class="majornote" id="org8f2942c">
<p>
To run Sigma16, visit the Sigma16 Home Page at
<a href="https://jtod.github.io/home/Sigma16">https://jtod.github.io/home/Sigma16</a>
and click the prominent <i>Run</i> link.
</p>

</div>
</div>

<p>
There are additional command line tools that can run in a shell; see
the Installation section.  There is also a digital circuit (available
separately) that implements the architecture.  Using these tools,
machine language programs can run on both the emulator and the
circuit.
</p>
</div>
</div>

<div id="outline-container-orgb50a7c2" class="outline-3">
<h3 id="orgb50a7c2">Browser compatibility</h3>
<div class="outline-text-3" id="text-orgb50a7c2">
<div class="majornote" id="org860ae81">
<p>
Sigma16 Version 3.9 runs on up-to-date versions of browsers based on
Chromium, including Opera, Chrome, Edge, DuckDuckGo.  It does not work
on Safari or Firefox.
</p>

</div>
</div>
</div>

<div id="outline-container-orgf340c8d" class="outline-3">
<h3 id="orgf340c8d">Organization</h3>
<div class="outline-text-3" id="text-orgf340c8d">
<p>
The architecture is organized into subsets to make it easier to learn
and to use:
</p>

<ul class="org-ul">
<li>The <b>Core</b> subset has a small instruction set which is a good
starting point for learning about computer architecture.  Although
simple, Core is powerful enough to support realistic programming.</li>
<li>The <b>Standard</b> subset offers flexible programming techniques,
including manipulation of bits, Boolean expressions, shifting,
extracting fields, arithmetic on natural numbers and arbitrary
precision integers, and concise support for stack frames. It also
supports the study of systems programming, providing interrupts,
protection, concurrent processes, mutual exclusion, and memory
management.</li>
</ul>

<p>
For a quick start, begin with the Core tutorials, which introduce the
architecture step by step.  The tutorials explain the machine, show
how to program it, and demonstrate how to enter and run a program and
how to use the programming environment.  A reference section follows
the tutorials.
</p>

<p>
Our focus is on fundamental concepts, ideas and principles.  Sigma16
illustrates the basic ideas of computer systems but it avoids
unnecessary complexity.  For example, Sigma16 has just one word size
(16 bits) while most commercial machines provide a variety.  That
variety is useful for practical applications but it complicates many
of the details while not adding new fundamental ideas.  Most
commercial computers that achieve success in the marketplace evolve
through updates and extensions, and eventually become encrusted with
complications that help support backward compatibility, leading to
complexity.
</p>
</div>
</div>
</div>

<div id="outline-container-sec-core-tutorial" class="outline-2">
<h2 id="sec-core-tutorial">Core architecture tutorials</h2>
<div class="outline-text-2" id="text-sec-core-tutorial">
<p>
The following short tutorials introduce the system; full details
appear in later sections.  You can keep the tutorials visible in the
right panel while following along with the examples in the main
panel.
</p>
</div>

<div id="outline-container-org0d78d31" class="outline-3">
<h3 id="org0d78d31">Hello, world!</h3>
<div class="outline-text-3" id="text-org0d78d31">
<p>
Let's begin by running a simple example program.  For now, we focus
only on how to use the software tools.  You don't need to understand
the example code yet.  An explanation of the program and the Sigma16
architecture will come later.
</p>

<p>
To launch the app, visit the Sigma16 Home Page and click on the link
to run it.  Sigma16 runs in the browser; you don't need to download
or install anything.
</p>

<ul class="org-ul">
<li>Click <b>Editor</b>, then <b>Hello, world!</b>.  This will enter a small
assembly language program into the editor window.  Later, we'll
load some of the more complex example programs into the editor,
and you can also modify a program or type in a new one from
scratch.  For now, don't worry about the content of the program.</li>

<li>Click <b>Assembler</b>.  The assembler translates programs in assembly
language (the source program) to machine language (the object
program).  Assembly language is a human-readable notation, while
machine language is what the computer can execute.  When you first
enter the Assembler tab, the assembly language text in the Editor
window is copied over; this is the source program.</li>

<li>Click the <b>Assemble</b> button.  This will do the translation.  The
<b>assembly listing</b> is displayed: this shows the original source
code along with the machine language, and any error messages.  The
<b>Show object</b> button displays the object code, which is the
machine language program produced by the translation.  The <b>Show
source</b> button displays the original source code, and the <b>Show
Listing</b> button displays the assembly listing again.</li>

<li>For this simple example, we don't need the Linker, so you can skip
it.  The linker is needed for larger and more complex programs
with multiple modules, or with external references, or that need
relocation.</li>

<li>Click <b>Processor</b>, which shows the main components of the computer
architecture, including registers and memory.  These components
are explained later.  For now, just note that this page is where
you can run programs using the emulator.</li>

<li>Still on the Processor page, click <b>Boot</b>.  This reads the machine
language program into the memory, and you can see it in the Memory
display.  The source code (the assembly language) appears in the
bottom section.  If the assembler produced any error messages, the
program will not boot until you fix the errors.</li>

<li><p>
Click <b>Step</b>.  The processor executes a single instruction and
displays the effects on the registers and memory: blue for <i>using</i>
a value, and red for <i>modifying</i> it.  The assembly listing shows
the instruction that just executed by highlighting it in red.  It
also shows the instruction that will execute next by highlighting
it in blue.  This is just to make it easier to follow what is
happening; the machine executes the machine language program,
which is in memory, and it ignores the assembly language listing
which is just a convenience to help you follow the program.  The
machine relies only on the registers and memory, and doesn't even
"know" that the assembly listing exists.
</p>

<p>
There is a keyboard shortcut: after you have clicked Step once, you
can press the space bar to execute the next instruction.  Thus you
can step through the program by clicking Step, and then pressing the
space bar repeatedly.
</p></li>

<li>Click Step repeatedly to watch the program execute, instruction by
instruction.  When the program terminates, the small window
labelled <b>Emulator</b> will display <b>Halted</b>.</li>

<li>You can also run the program to completion, without having to click
Step so many times.  Click <b>Boot</b> again to get the machine back into
the initial state.  Now click <b>Run</b>, and the program will continue
executing instructions until it halts.</li>
</ul>

<p>
To run the program slowly, click Step repeatedly.  To run the program
faster but without updating the display after each instruction, click
Run.  At any time you can click Pause to stop the processor, and you
can resume execution with either Step or Run.  Sometimes it's useful
to let the processor run at full speed until it reaches a particular
instruction, and then stop.  This can be done by setting a
<b>breakpoint</b> (described in the Breakpoint tutorial below).
</p>

<p>
To exit the app, just close the browser window or tab.  This may put
up a dialogue box warning that any unsaved data may be lost and
asking you to confirm.
</p>
</div>
</div>

<div id="outline-container-org450c1b9" class="outline-3">
<h3 id="org450c1b9">A quick tour</h3>
<div class="outline-text-3" id="text-org450c1b9">
<p>
This tutorial introduces the main components of the architecture as
well as the graphical user interface.
</p>

<p>
The main window contains two main sections.  The largest area, on the
left side, is the <b>main working area</b>.  When the program launches,
this will show the Welcome page.  The <b>user guide</b> is on the right
side.  At the top is a row of buttons (Welcome, Examples, etc.).
These select which page is displayed in the main working area.
</p>

<p>
It's convenient to see the main working area and the user guide side
by side.  Begin by resizing the entire window (bigger is better).
Then you can change the amount of space given to the user guide by
clicking the arrow symbols on the right side of the top button bar.
These arrows will expand or shrink the user guide: the small arrows
adjust by one pixel, the larger arrows by ten pixels.  If you resize
the entire browser window, Sigma16 will maintain the same relative
sizes of the main working area and the user guide sections.
</p>

<p>
If your screen is small, and the main working area isn't big enough,
click <i>Hide User Guide</i> and all the space will be made available to
it.  The button will change to <i>Show User Guide</i>.
</p>

<p>
You can also open the User Guide in a separate browser tab or window.
The Welcome page contains a link to do this.
</p>

<p>
The main working area has several pages, with tab buttons at the top
to switch between them:
</p>

<ul class="org-ul">
<li><b>Welcome</b> contains some introductory information and links.</li>

<li><b>Examples</b> contains a collection of assembly language programs
organized by the architecture subset.  Start with the Core examples.</li>

<li><b>Modules</b> shows a summary of all the files and modules you currently
have open.  It also provides buttons allowing you to open files on
your computer, close them, and select one to work on.</li>

<li><b>Editor</b> shows the selected module, where it can be edited.  You can
assemble and execute the selected module.  To run a program, you'll
load it into the Editor (there are several ways to do this), then
assemble it (Assembler tab) and then run it (Processor tab).</li>

<li><b>Assembler</b> translates a program from assembly language to machine
language, and shows the assembly listing as well as the object code.</li>

<li><b>Linker</b> is used to combine a collection of object code modules into
a single executable program.  It also performs external name
resolution and relocation.  Programs that consist of just one module
do not need the linker, and you can skip it.</li>

<li><b>Processor</b> shows the components of the architecture and executes
machine language programs.</li>

<li><b>Options</b> allows you to configure how the system operates.</li>

<li><b>About</b> gives general information about the software, including the
version.</li>

<li><b>Hide User Guide</b> makes the entire window available to the main
working area.  It is a toggle that changes to <b>Show User Guide</b>.</li>
</ul>
</div>
</div>

<div id="outline-container-org9d20265" class="outline-3">
<h3 id="org9d20265">Registers, constants, and arithmetic</h3>
<div class="outline-text-3" id="text-org9d20265">
<p>
Programs do most of their work using the <b>register file</b>, which is
an array of 16 registers named R0, R1, R2, &#x2026;, R15.  The Register
File is displayed in a box on the Processor page.
</p>

<p>
A register is a circuit that can hold a number, and the elements of
the register file can be used to hold variable values.  They are
analogous to the registers in a calculator: think of each register as
a box that can hold a number, and think of the register name as a
variable name.  Two of the registers, R0 and R15, are special and
should not be used to hold variables.
</p>

<p>
A computer program is a sequence of <b>instructions</b>.  Instructions are
similar to statements in a programming language, but they are simpler.
</p>

<p>
Sigma16 performs arithmetic on data in registers.  To do any
computation on some numbers, we first need to get those numbers into
registers.  The <b>lea</b> instruction. can be used to place a constant
into a register.  For example, to load 42 into register 3, write
</p>

<div class="CodeListing" id="org9689d4b"><pre>
     lea  R3,42[R0]     ; R3 := 42
</pre></div>

<p>
This is a statement in <b>assembly language</b>, and it describes one
instruction.  This statement contains three parts:
</p>
<ul class="org-ul">
<li>The <b>operation</b> is <b>lea</b>.  This tells the computer what action to
perform, and "lea" says to put a value into a register.  Later we
will see why this instruction is called "lea".</li>
<li>The <b>operands</b> are <b>R2,42[R0]</b>.  R2 is the <i>destination</i>, where the
value will be placed.  The value to be put into the destination
is 42.  For now, ignore the <b>[R0]</b>; its purpose will be described
later.</li>
<li>Everything after the semicolon is a <b>comment</b>.  This comment is a
programming language statement that describes what the instruction
does: it sets the variable R3 to 42.</li>
</ul>

<p>
The name <b>lea</b> is the <b>operation</b>, i.e. the name of the instruction.
The operand field consists of two operands separated by a comma.  The
first operand, R2, is called the <b>destination</b>; this is the register
where the result will be placed.  The second operand is a constant 42
followed by [R0].  When the computer executes this instruction, it
simply places the constant into the destination.  In a higher level
language, we could write <b>R2 := 42</b>.
</p>

<p>
Most instructions follow a similar pattern: the first operand is the
destination where the result is placed, and the subsequent operands
are the arguments to the computation.  This is the same convention
used in assignment statements in many programming languages: the
registers in add R1,R2,R3 appear in the same order as the variables in
R1 := R2 + R3.
</p>

<p>
All arithmetic operations take place in the registers, and there is a
separate instruction for each operation.  For example, the following
instruction will add the values in R8 and R1 and then put the result
into R4:
</p>

<div class="CodeListing" id="orgc348ca2"><pre>
    add   R4,R8,R1  ; R4 := R8 + R1
</pre></div>

<p>
Notice that the operand field doesn't use operators like := or +;
those are specified by the operation field (lea, add).  Each
instruction performs only one operation.  The operand field just
separates the operands with commas.  The first operand (R4 in this
example) is the <b>destination</b>, which is where the result will be
placed.  The last two operands (R8 and R1) are the values that will be
added.
</p>

<p>
To perform a calculation, we need to get the data into registers
(using lea) and then perform the calculation (using arithmetic
instructions).  The following program calculates 3 + 4 and puts the
result into R2:
</p>

<div class="CodeListing" id="org3e6663c"><pre>
     lea   R5,3[R0]    ; R5 := 3
     lea   R8,4[R0]    ; R8 := 4
     add   R2,R5,R8    ; R2 := R5 + R8 = 3+4 = 7
</pre></div>

<p>
It's a good idea to use comments to explain the meaning of an
instruction.  For now, comments like "R4 := R8 + R1" will be used to
show what the instruction does. That's useful while learning what the
instructions do, but later on we will use comments to give more
meaningful information (for example, what do the values in the
registers mean, and why are we adding them?).
</p>

<p>
There are three more arithmetic instructions.  These follow the same
pattern as add: in each case, the arithmetic is performed on the last
two registers and the result is placed in the destination (the first
register):
</p>

<div class="CodeListing" id="org3b99e9e"><pre>
     add  R4,R11,R6   ; R4 := R11 + R6
     sub  R5,R2,R13   ; R5 := R2 - R13
     mul  R2,R10,R7   ; R2 := R10 * R7
     div  R5,R6,R12   ; R5 := R6 / R12, R15 := R6 rem R12
</pre></div>

<p>
The divide instruction is slightly different: it produces two results,
the quotient and the remainder.  The quotient is placed in the
destination, and the remainder is automatically placed into R15, even
though the instruction doesn't mention R15.  If you write <b>div
R15,R1,R2</b>, the quotient is placed in R15 and the remainder is
discarded.
</p>

<p>
Normally an arithmetic instruction will put a new value into the
destination register, but the operand registers are left unchanged.
However, what happens if one of the operands is the same as the
destination, for example <b>add R7,R7,R8</b>?
</p>

<p>
An arithmetic instruction proceeds in three phases: (1) obtain the
values in the operand registers; (2) perform the arithmetic on those
values; and (3) put the result into the destination, discarding
whatever value was previously there.  So consider this example:
</p>

<div class="CodeListing" id="orga5316e7"><pre>
    lea   R7,20[R0]  ; R7 := 20
    lea   R8,30[R0]  ; R8 := 30
    add   R7,R7,R8   ; R7 := R7 + R8
</pre></div>

<p>
After the two lea instructions have executed, R7 contains 20 and R8
contains 30.  The add instruction does the following:
</p>

<ol class="org-ol">
<li>It fetches the values in R7 and R8, obtaining 20 and 30</li>
<li>It adds the values, obtaining the result 50</li>
<li>It puts the result 50 into the destination R7, discarding the
previous value.</li>
</ol>

<p>
The final result is that R7 contains 50.
</p>

<p>
Constant data can be specified using either decimal or hexadecimal
notation.
</p>

<ul class="org-ul">
<li>Decimal numbers are written as strings of digits, optionally
preceded by a minus sign: 3,-19, 42.  Leading zeros are optional, so
23 and 0023 both mean the same (twenty three).</li>

<li>Hexadecimal numbers are written as four hex digits, and in assembly
language programs they are indicated by putting $ before the number.
Thus $00a5 and 0165 both represent the integer 165.</li>
</ul>

<div class="CodeListing" id="orgcf31fab"><pre>
     lea   R1,13[R0]     ; R1 =  13 (hex 000d)
     lea   R2,$002f[R0]  ; R2 := 47 (hex 002f)
     lea   R3,$0012[R0]  ; R3 := 18 (hex 0012)
     lea   R4,0012[R0]   ; R4 := 12 (hex 000c)
</pre></div>

<p>
The processor page shows numbers as hex without the leading $, but in
an assembly language program the $ is needed to avoid ambiguity.
</p>

<p>
Sigma uses := as the assignment operator; thus we write R7 := R7 + R8
(and we don't write R7 = R7 + R8).  This is because an assignment
statement is profoundly different from an equation, and mathematicians
have long used the = operator to indicate equations.  It isn't just an
academic or theoretical point; there have been plenty of occasions
where computer programmers get confused between assignment and
equality, and using the wrong operator leads to serious bugs.  (A
major security breach occurred because a C programmer forgot that in
C, = does not mean equals.)
</p>

<p>
Why does assembly language use a notation like add R5,R2,R3 instead of
R5 := R2 + R3?  In short, every instruction will use a similar
notation: a keyword for the operation, followed by the operands
separated by commas.  This notation is also related closely to the way
instructions are represented in memory, which we'll see later.
</p>

<p>
An arithmetic instruction performs just one operation.  Several
instructions are needed to evaluate a larger expression.  In general,
you'll need a separate instruction for every operator that appears in
an expression.
</p>

<p>
Example: calculate 6 + 2 * 4 and put the result into R10.  We have to
put the numbers into registers, using lea, and then perform the
arithmetic.  It doesn't matter which registers are used (as long as we
avoid R0 and R15).
</p>

<div class="CodeListing" id="org1f7f808"><pre>
    lea   R1,6[R0]    ; R1 := 6
    lea   R2,2[R0]    ; R2 := 2
    lea   R3,4[R0]    ; R3 := 4
    mul   R2,R2,R3    ; R2 := R2*R3 = 2*8 = 8
    add   R10,R1,R2   ; R10 := R1+R2 = 6+8 = 14 (hex 000e)
    trap  R0,R0,R0    ; halt
</pre></div>

<p>
This is nearly enough to constitute a complete program.  Only one more
thing is needed: a way to terminate the program when it finishes.
There is a special instruction to do this: a trap instruction, where
the first operand is R0, will stop the program.
</p>

<div class="CodeListing" id="org8e6d2c9"><pre>
    trap  R0,R0,R0   ; halt
</pre></div>

<p>
Here is a complete program named ConstArith.  It consists of
</p>
<ol class="org-ol">
<li>Comments that identify the program</li>
<li>Comments that say what it does</li>
<li>The instructions</li>
<li>A trap instruction to terminate execution</li>
</ol>

<div class="CodeListing" id="org49fd179"><pre>
; ConstArith: Illustrate lea and arithmetic instructions.
; Use lea to load constants into registers, then do arithmetic.
; Sigma16: <a href="https://jtod.github.io/home/Sigma16/">https://jtod.github.io/home/Sigma16/</a>  John O'Donnell, 2025

; Calculate 6 + 2 * 4 and put the result into R10
; Use lea to put a constant into a register
; Use mul and add to do arithmetic

    lea   R1,6[R0]    ; R1 := 6
    lea   R2,2[R0]    ; R2 := 2
    lea   R3,4[R0]    ; R3 := 4
    mul   R2,R2,R3    ; R2 := R2*R3 = 2*8 = 8
    add   R10,R1,R2   ; R10 := R1+R2 = 6+8 = 14 (hex 000e)
    trap  R0,R0,R0    ; halt
</pre></div>
</div>

<div id="outline-container-orgbabc823" class="outline-4">
<h4 id="orgbabc823">Running an example program</h4>
<div class="outline-text-4" id="text-orgbabc823">
<p>
You can go to the Editor, and type it in (or copy and paste it in),
but this program is part of the collection of examples built in to
Sigma16.  Here's how to run it:
</p>

<ul class="org-ul">
<li>Go to the <b>Examples</b> page.  Click <b>Examples</b>, then <b>Core</b>, then
<b>Simple</b>.  This brings up a list of small and simple example
programs.  Click <b>ConstArith.asm.txt</b>.  You should see the listing
of the program.  The file name has an extension <b>.asm.txt</b> that
identifies the file as an assembly language source program.</li>
<li>Click <b>Editor</b>, and you should see the text of the program in the
window.</li>
<li>Go to the <b>Assembler</b> page and click <b>Assemble</b>.</li>
<li>Go to the <b>Processor</b> page.  Click <b>Boot</b>, then <b>Step</b> repeatedly
and watch the effect of each instruction by observing how the
registers are changed.</li>
</ul>

<p>
The Processor page shows numbers in hexadecimal.  The add instruction
puts 14 into R10, and this is displayed as hex 000e.
</p>

<p>
It's a good idea to step through the program slowly, rather than
running it to completion at full speed.  The emulator will show the
next instruction to be executed, highlighted in blue.  Think about
what the instruction should do; in particular what changes to the
registers will occur?  Then click Step and check to see if the right
thing happened.
</p>

<p>
Generally you can use any register you like (apart from R0 and R15),
and the choices of registers in the previous examples are arbitrary.
Registers R1 through R14 behave the same.  However, two of the
registers are different:
</p>

<ul class="org-ul">
<li><b>R0</b> contains the constant 0 and it will never change.  Any time an
instruction uses R0, the value it gets will be 0.  It is legal for
an instruction to attempt to modify R0 (for example, add R0,R3,R4 is
legal) but after executing this instruction R0 still contains 0.
The reason for this is that we frequently need to have access to a
register containing 0.</li>

<li><b>R15</b> is used for two specific purposes.  We have already seen the
first: the divide instruction places the remainder into R15.  The
second purpose is that R15 contains the <b>condition code</b>, which is a
word that contains a number of bits that provide some information
about an instruction.  For example, if an addition produces a result
that is too large to fit in a register, a special flag indicating
this is set in R15.  Several of the instructions, particularly the
arithmetic instructions, change the value of R15 as well as placing
the result in the destination register.  For this reason, R15 cannot
be used to hold a variable since its value would be destroyed almost
immediately.</li>
</ul>

<p>
To summarise, Registers R1 through R14 are all identical and can be
used for variables.  R0 contains 0 and will never change.  R15 changes
frequently and can be used to detect various error conditions and
other information about an instruction.
</p>

<p>
Here is another example:
</p>
<ul class="org-ul">
<li>Suppose we have variables a, b, c, d</li>
<li>And suppose we already have these variables in registers</li>
<li>Choose a register for each variable: R1=a, R2=b, R3=c, R4=d</li>
<li>We wish to compute R5 = (a+b) * (c-d)</li>
</ul>

<div class="CodeListing" id="orgc2eaf86"><pre>
     add   R6,R1,R2     ; R6 := a + b
     sub   R7,R3,R4     ; R7 := c - d
     mul   R5,R6,R7     ; R5 := (a+b) * (c-d)
</pre></div>

<p>
Summary.
</p>

<ul class="org-ul">
<li>A lea instruction of the form <b>lea Rd,const[R0]</b> will put the
constant into Rd.  It can also be written as <b>lea Rd,const</b>.</li>
<li>The general form of an arithmetic instruction is <b>op d,a,b</b>.  
The meaning is <b>R<sub>d</sub> := R<sub>a</sub>  op  R<sub>b</sub></b>, and the fields are:
<ul class="org-ul">
<li>op is one of add, sub, mul, div</li>
<li>Rd is the destination register (where the result goes)</li>
<li>Ra is the register containing the first operand</li>
<li>Rb is the register containing the second operand</li>
</ul></li>
</ul>
</div>
</div>
</div>

<div id="outline-container-org7b17fbc" class="outline-3">
<h3 id="org7b17fbc">Keeping variables in memory</h3>
<div class="outline-text-3" id="text-org7b17fbc">
<p>
So far we have used registers in the register file to hold variables.
However, there are only 16 of these, and two have special purposes (R0
and R15).  That leaves only 14 registers for general use, and most
programs need more than 14 variables.
</p>

<p>
To solve this problem, the computer contains another subsystem called
the <b>memory</b>.  The memory contains a sequence of <b>memory locations</b>,
each of which can hold a word (16 bits).  Each location is identifed
by an <b>address</b>, which is a natural number \(0, 1, 2, 3, \ldots,
65535\).  The notation <b>M[a]</b> denotes the value stored in the memory
location with address a.
</p>

<p>
The register file and the memory serve different purposes:
</p>

<ul class="org-ul">
<li>The register file is used to perform calculations.  In computing
something like x := (2*a + 3*b) / (x-1), all the arithmetic must be
done using the register file.  For example, the instruction add
R1,R5,R3 has both operands and destination in registers, and this is
true for all arithmetic instructions.  The purpose of the registers
is to provide fast access to a small number of variables while they
are needed for calculations.</li>

<li>There are only a few registers available, so we can't keep all the
variables permanently in registers.  The memory is much larger: it
contains 65,536 locations so it can hold all the variables in a
program.  But the memory is slow, and it has a limitation: there is
no instruction that can do arithmetic on data in the memory.  The
purpose of the memory is to hold large amounts of data for future
use.</li>
</ul>

<p>
Normally, a program keeps its variables in memory, so a variable name
refers to a memory location.  The variable name just stands for the
<i>address</i> of the location that contains the variable.  This allows you
to refer to a variable by a name (x, sum, count) rather than an
address (003c, 0104, 00d7).
</p>
</div>

<div id="outline-container-org3144791" class="outline-4">
<h4 id="org3144791">load and store</h4>
<div class="outline-text-4" id="text-org3144791">
<p>
Since we need a lot of variables, they need to be kept in memory.  But
since we need to do arithmetic, and arithmetic can be performed only
on data in registers, we adopt the following strategy:
</p>

<ul class="org-ul">
<li>Keep variables permanently in memory.</li>
<li>When you need to do arithmetic on some variables, copy them from
memory to registers.</li>
<li>When finished, copy the results from registers back to memory.</li>
</ul>

<p>
Two instructions are needed to do this:
</p>
<ul class="org-ul">
<li><b>load</b> copies a word from a memory location into a register.
Suppose <b>xyz</b> is a variable in memory; then to copy its value into
R2 we write <b>load R2,xyz[R0]</b>.</li>
<li><b>store</b> copies a word from a register into a memory location.  If R3
contains the result of some calculations, and we want to put it back
into memory in a variable named result, we would write <b>store
R3,result[R0]</b>.</li>
</ul>

<p>
At this point we have enough instructions to write an assignment
statement in assembly language.  Typically we will first write an
algorithm using higher level language notation, and then translate it
into instructions.  Translating from a high level language to assembly
language is called "compiling".
</p>

<p>
Example: translate <b>x := a+b+c</b> into assembly language.
</p>

<p>
Solution:
</p>

<div class="CodeListing" id="org00100fb"><pre>
    load   R1,a[R0]      ; R1 := a
    load   R2,b[R0]      ; R2 := b
    add    R3,R1,R2      ; R3 := a+b
    load   R4,c[R0]      ; R4 := c
    add    R5,R3,R4      ; R5 := (a+b) + c
    store  R5,x[R0]      ; x := a+b+c
</pre></div>
</div>
</div>

<div id="outline-container-orgdc00d1c" class="outline-4">
<h4 id="orgdc00d1c">The data statement</h4>
<div class="outline-text-4" id="text-orgdc00d1c">
<p>
The variables used in a program need to be defined and given an
initial value.  This is done with the <b>data</b> statement.  The variable
name comes first, and it must start at the beginning of the line (no
space before it).  Then comes the keyword <b>data</b>, followed by the
initial value, which may be written in either decimal or hexadecimal.
These pieces of the statement must be separated by white space.
</p>

<p>
For example, to define variables x, y, z and give them initial values:
</p>

<div class="CodeListing" id="orgb2d47e7"><pre>
x    data   34    ; x is a variable with initial value 34
y    data    9    ; y is initially 9
z    data    0    ; z is initially 0
abc  data  $02c6  ; specify initial value as hex
</pre></div>

<p>
The data statements should come <b>after</b> all the instructions in the
program.  This may look surprising: in some programming languages you
have to declare your variables at the beginning, before using them.
There is a good reason why we will put the instructions first, and the
data statements after; but the reason will come later.
</p>

<p>
Here is a simple example of a complete program that uses load, store,
and data statements, to implement z := x + y.
</p>

<div class="CodeListing" id="org4d97652"><pre>
; Program Add.  See README in top Sigma16 folder
; A minimal program that adds two integer variables

; Execution starts at location 0, where the first instruction will be
; placed when the program is executed.

      load   R1,x[R0]   ; R1 := x
      load   R2,y[R0]   ; R2 := y
      add    R3,R1,R2   ; R3 := x + y
      store  R3,z[R0]   ; z := x + y
      trap   R0,R0,R0   ; terminate

; Expected result: z = 37 (0025)

; Static variables are placed in memory after the program

x     data  23
y     data  14
z     data   0
</pre></div>

<p>
Now you can run the program:
</p>

<ul class="org-ul">
<li>Go to the Examples page.  Click Core, then Simple, then Add.</li>
<li>Click Editor, and you should see the text of the program in the
window.</li>
<li>Go to the Assembler page.  Click Assemble.</li>
<li>Go to the Processor page.  Click Boot, then Step repeatedly and
watch the effect of each instruction by observing how the registers
and memory are changed.</li>
</ul>

<p>
The processor page shows the contents of the memory.  For each memory
location, the address is shown followed by the contents of that
location.  For example, if a line in the memory display shows 00b7
4c3f, this means that the memory location with address 00b7 contains
4c3f.  This is written as M[00b7] = 4c3f.
</p>

<p>
Memory addresses and contents, as well as register contents, are shown
in hexadecimal with no leading $.  Since all these numbers are
hexadecimal, putting $ in front (or 0x as in C) just adds distraction
without telling you anything useful.
</p>

<p>
The processor displays two independent views into the memory.  This is
convenient because it's frequently necessary to look at two different
portions of the memory at the same time.  For example, it's helpful to
look at the machine language code in one view and the data in the
other view.  With programs that use advanced techniques (e.g. pointers
and activation records) it's essential to be able to view two
different areas of memory.  Despite the two views, there is just one
memory.
</p>
</div>
</div>

<div id="outline-container-org33e77ac" class="outline-4">
<h4 id="org33e77ac">Relationship between arrays, registers, memory</h4>
<div class="outline-text-4" id="text-org33e77ac">
<p>
The register file and the memory are similar in many ways, and they
are also similar to ordinary arrays in some programming languages.
The essential difference is that registers are fast but there are only
a few of them, whereas memory is large but slow.
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">&#xa0;</th>
<th scope="col" class="org-left">array</th>
<th scope="col" class="org-left">reg file</th>
<th scope="col" class="org-left">memory</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Type of element:</td>
<td class="org-left">declared</td>
<td class="org-left">word</td>
<td class="org-left">word</td>
</tr>

<tr>
<td class="org-left">Size of element:</td>
<td class="org-left">declared</td>
<td class="org-left">16 bits</td>
<td class="org-left">16 bits</td>
</tr>

<tr>
<td class="org-left">Element notation:</td>
<td class="org-left">a[i]</td>
<td class="org-left">R3</td>
<td class="org-left">M[a]</td>
</tr>

<tr>
<td class="org-left">Element is called:</td>
<td class="org-left">element</td>
<td class="org-left">register</td>
<td class="org-left">location</td>
</tr>

<tr>
<td class="org-left">Index is called:</td>
<td class="org-left">index</td>
<td class="org-left">reg number</td>
<td class="org-left">address</td>
</tr>

<tr>
<td class="org-left">Range of index:</td>
<td class="org-left">declared</td>
<td class="org-left">0..15</td>
<td class="org-left">0..65535</td>
</tr>

<tr>
<td class="org-left">Number of elements:</td>
<td class="org-left">declared</td>
<td class="org-left"><b>small</b></td>
<td class="org-left"><b>large</b></td>
</tr>

<tr>
<td class="org-left">Access time:</td>
<td class="org-left">slow</td>
<td class="org-left"><b>fast</b></td>
<td class="org-left"><b>slow</b></td>
</tr>
</tbody>
</table>

<p>
Why does the computer have both registers and memory?  After all, this
makes programming a little more complicated.  You have to keep track
of which variables are currently in registers, and you have to use
load and store instructions to copy data between the registers and
memory.  Wouldn't it be easier just to get rid of the distinction
between registers and memory, and do all the arithmetic on memory?
</p>

<p>
Yes, this would be simpler, and there have been real computers like
that.  However, this approach makes the computer slower.  With modern
circuits, a computer without load and store instructions (where you do
arithmetic on memory locations) would run approximately 100 times
slower.  So nearly all modern computers do arithmetic in registers,
and use instructions like load and store to copy data back and forth
between registers and memory.
</p>
</div>
</div>
</div>

<div id="outline-container-org0106fde" class="outline-3">
<h3 id="org0106fde">Assembly language</h3>
<div class="outline-text-3" id="text-org0106fde">
<p>
The programs we have seen so far are written in <b>assembly language</b>.
The machine itself executes programs in <b>machine language</b>, which is
covered later.  Assembly language is translated to machine language by
a program called an <b>assembler</b>.
</p>

<p>
The purpose of assembly language is to give the programmer absolute
control over the machine language program without having to remember
lots of numeric addresses and codes.  Assembly language is readable
for humans, while machine language is executable by machines.  For
example, it is easier to remember the name "mul" for multiply than to
remember the machine language code (which happens to be 3).
Similarly, it's easier to remember the names of variables (x, y, sum,
total) than the numeric addresses of the memory locations that hold
these variables.
</p>

<p>
The syntax of assembly language is simple and rigid.  Every statement
must fit on one line of source code; you cannot have a statement that
spans several lines, and you cannot have several statements on one
line.
</p>

<p>
Sigma16 assembly language uses a small set of characters.  Any
character not on this list will generate an error message.  A Sigma16
program can <b>manipulate</b> any 16-bit character, but the source assembly
language code is restricted to this source character set.  There are
many characters that look similar but are actually distinct.  For
example, the minus sign, the hyphen, the en-dash, and the em-dash all
look similar &#x2013; you have to look closely to see the difference &#x2013; but
Sigma16 assembly language uses the minus sign, and the hyphens and
dashes won't work.
</p>

<p>
These are the legal characters in an assembly language program:
</p>

<ul class="org-ul">
<li>letters
<ul class="org-ul">
<li>_abcdefghijk</li>
<li>lmnopqrstuvwxyz</li>
<li>ABCDEFGHIJKLMN</li>
<li>OPQRSTUVWXYZ</li>
</ul></li>
<li>digits: 0123456789</li>
<li>separators: space tab ,;</li>
<li>quotes: " '</li>
<li>punctuation: ".$[]()+-*</li>
<li>other: ?&lt;=&gt;!%^&amp;{}#~@:|/\'</li>
</ul>

<p>
Word processors often substitute characters.  For example, when you
type a minus sign in a paragraph of English text, word processors may
replace the minus sign with a hyphen or dash, which is correct for
typeset English but incorrect for assembly language.  The Sigma16
editor will insert the correct characters, as will plain text editors.
</p>

<p>
Each statement has a rigid format that consists of up to four
<b>fields</b>.  The fields must be separated by one or more spaces, and a
field cannot contain a space.  Every field is optional, but if a field
is missing then the following fields must also be missing, except for
an optional comment.  The fields are:
</p>

<ul class="org-ul">
<li>label (optional) &#x2013; If present, the label must begin in the first
character of the line.  If a line starts with a space, then there is
no label field.  A label has the same syntax as names or identifiers
in many languages: it may contain letters, digits, underscores, and
must begin with a letter.  Both upper and lower case letters are
allowed, and the syntax is case sensitive (Loop and LOOP and loop
are three different labels).</li>

<li>mnemonic &#x2013; This is the name of the operation: load, lea, add, sub,
etc.  The mnemonic must be preceded by white space, and it must be
the name of a valid instruction or assembler directive.</li>

<li>operands field &#x2013; the operands required by the type of statement.
There are several formats possible for the operands field, depending
on the instruction; these are detailed later.  For example, for the
add instruction the operand field must consist of three registers,
separated by commas (e.g. R1,R2,R3).  Spaces are not allowed in the
operands field: R1,R2,R3 is fine but R1, R2, R3 is an error.</li>

<li>comments &#x2013; anything that follows the operands field, or anything
that appears after a semicolon, is a comment.  The semicolon is not
required if the mnemonic and operands fields are present, but it is
good practice to include it.</li>
</ul>

<p>
Here are some syntactically valid statements:
</p>
<div class="CodeListing" id="orgccd3672"><pre>
loop   load   R1,count[R0]    ; R1 := count
       add    R1,R1,R2        ; R1 := R1 + 1
</pre></div>

<p>
Each of the following statements is wrong!
</p>

<div class="CodeListing" id="org684248b"><pre>
   add   R2, R8, R9    ; spaces in the operand field
loop1  store x[R0],R5  ; wrong order: should be R5,x[R0]
    addemup            ; invalid mnemonic
 loop2  load R1,x[R0]  ; Space before the label
</pre></div>

<p>
If you forget some detail, look at one of the example programs.
</p>

<p>
When the assembler is translating a program, it begins by looking at
the spaces in order to split each statement into the four fields.
This happens before it looks at the operation and operands.  The
assembly listing uses colors to indicate the different fields.  If you
get a syntax error message, the first thing to check is that the
fields are what you intended.  For example if you meant to say
</p>

<div class="CodeListing" id="org1516388"><pre>
     add R1,R2,R3  ; x := a + b
</pre></div>

<p>
but you have a spurious space, like this
</p>

<div class="CodeListing" id="orgac4fd4a"><pre>
     add R1, R2,R3  ; x := a + b
</pre></div>

<p>
the assembler will decide that the mnemonic is add, the operands field
is "R1," and all the rest - "R2,R3 ; x := a + b" &#x2013; is a comment, and
the colors of the text in the assembly listing will show this clearly.
</p>

<p>
The rules above mean that a label must begin in the first character of
a line, and also that if any non-space character appears at the
beginning, it is taken to be a label.  The following statement has a
label "add", an operation "R1,R2,R3" (and of course there is no such
instruction), and the operand field is ";".  Again, the syntax
highlighting will show the error clearly.
</p>

<div class="CodeListing" id="orga319aa3"><pre>
add R1,R2,R3  ; x := a + b
</pre></div>

<p>
In assembly language, you can write constants in either decimal
or hexadecimal.
</p>

<ul class="org-ul">
<li>decimal:   50 -39</li>
<li>hexadecimal: $003b</li>
</ul>

<p>
Examples:
</p>

<div class="CodeListing" id="org9733017"><pre>
    lea   R1,40[R0]      ; R1 = 40
    lea   R2,$ffff[R0]   ; R2 = -1

x   data  25
y   data  $2c9e
</pre></div>

<p>
There are two instruction formats in the Core architecture, which
differ in the form of the operands:
</p>

<ul class="org-ul">
<li><b>RRR</b> instructions have an operand field containing three registers
separated by commas.  Example: <b>add R8,R13,R6</b>.</li>

<li><b>RX</b> instructions have an operand field that specifies a register
and an address.  The address is a name or constant, followed by a
register. Examples: <b>load R12,array[R6]</b> and <b>lea R5,23[R0]</b>.</li>
</ul>

<p>
It isn't enough just to get the assembler to accept your program
without error messages.  Your program should be clear and easy to
read.  This requires good style.  Good style saves time writing the
program and getting it to work, while aA sloppy program looks
unprofessional and makes testing and debugging harder.  Here are a few
tips.
</p>

<p>
<b>Write good comments.</b> You should include good comments in all
programs, regardless of language.  Comments are especially important
in assembly language, because the code tends to need more explanation.
At the beginning of the program, use comments to identify the program
and author and to say what it does.  Use full line comments to
describe in general what's going on, and put a comment on every
instruction to explain what it's doing.
</p>

<p>
<b>Indent your code consistently.</b> Each field should be lined up
vertically, like this:
</p>

<div class="CodeListing" id="org9d37bba"><pre>
     load   R1,three[R0]  ; R1 = 3
     load   R2,x[R0]      ; R2 = x
     mul    R3,R1,R2      ; R3 = 3*x
     store  R3,y[R0]      ; y = 3*x
     trap   R0,R0,R0      ; stop the program
</pre></div>

<p>
Not haphazard like this:
</p>

<div class="CodeListing" id="org3a49295"><pre>
   load   R1,three[R0]     ; R1 = 3
 load  R2,x[R0] ; R2 = x
      mul R3,R1,R2           ; R3 = 3*x
store         R3,y[R0]      ; y = 3*x
  trap  R0,R0,R0      ; stop the program
</pre></div>

<p>
The exact number of spaces each field is indented isn't important;
what's important is to make the program neat and readable.
</p>

<p>
<b>Spaces, not tabs.</b> To indent your code, always use spaces &#x2013; avoid
tabs.  In general, never use tabs except in the (rare) cases they are
required (for example in makefiles).  The tab character was introduced
long ago into computer character sets to try to mimic the tab key on
old mechanical typewriters.  Unfortunately, software does not handle
tab characters consistently.  If you use tabs, your program can look
good in one application and like a mess in another.  It's easy to
indent with spaces, and it works everywhere.
</p>

<p>
Some programming languages use indentation to indicate program
structure.  If some of that indentation is done with tabs, it could
work on one computer but give syntax errors on another system.  Even
worse, it could compile but give different results as the program
structure has changed.  (Wrong results are worse than error messages.)
</p>
</div>
</div>

<div id="outline-container-orge87d73a" class="outline-3">
<h3 id="orge87d73a">The Editor</h3>
<div class="outline-text-3" id="text-orge87d73a">
<p>
To run an assembly language program, you first need to put it into the
editor window.  Then you can go to the Assembler page, assemble it and
run it on the Processor page.  There are several ways to enter a
program into the editor window.
</p>

<ul class="org-ul">
<li><b>Starter program.</b> Editor tab. Click Hello World.  This will load a
small fixed example program into the editor buffer.</li>
<li><b>Collection of examples.</b> Examples tab.  The Sigma15 app provides a
collection of example programs.  Click Core to see the examples that
use only the core instruction set.  Click Simple, then ConstArith.
Go to the Editor tab and the example you selected will be in the
window.  All of these example programs are in the Sigma16 system,
not on your local computer.</li>
<li><b>Type it in.</b> Editor tab. Type in a program.  If there was already
some text there, click New.</li>
<li><b>Read from a file.</b> Editor tab. Click Open File.  This brings up a
file chooser dialog where you can traverse the file system on your
computer and select a file.</li>
<li><b>Copy from file and paste.</b> If your program is visible in another
window on your computer, you can copy its text, then go to the
Sigma16 editor, and paste.  Normally it's better to use Open File,
but if your browser has disabled file access the copy-paste method
is ok.</li>
</ul>

<p>
You can edit the text in the Editor window:
</p>
<ul class="org-ul">
<li>Click the arrow keys or the left mouse button to move the cursor.</li>
<li>Click left mouse button and drag to select text.</li>
<li>Click right mouse button and select Cut, Copy, Paste, Undo.</li>
</ul>

<p>
<b>Save your work.</b> After typing in a program, or editing it, you should
save it to a file.  Click Save As.  This brings up a dialog where you
can traverse your file system and provide a file name (which should
end in .asm.txt).
</p>

<p>
If you leave the browser without saving the text in the editor window
to a file, that text will be lost, so it's important to save your work
regularly.  If you don't do that, sooner or later the system will
crash and you'll lose your data.  When you close a browser tab that's
running Sigma16, the browser may put up a message warning you that
"Changes you made may not be saved".  The browser can't tell whether
the editor text needs to be saved.
</p>

<p>
The Sigma16 app will know what file is associated with your program
if you have read it from a file (Editor: Open File) or if you have
saved it to a specific location in your computer (Editor: Save As).
</p>

<p>
Once the app knows which file contains your program, you can edit it
and save it again just by clicking Editor: Save.  This is easier than
Save As because you don't need to traverse the file system again.
</p>

<p>
You can also edit your assembly language program using an external
text editor, rather than the simple editor in the Sigma16 app.  If you
have modified the file using an external editor, click Editor: Refresh
to reload the file from your disk.
</p>

<p>
If you do use an external text editor, use a real text editor (emacs,
vim, notepad++, or whatever you prefer), not a word processor.  Word
processors embed extra formatting data into the file, and the
assembler can't handle that.  Furthermore, word processors often
change the characters you type.  For example, they may change the
minus character (-) into an en-dash.  There are four different
characters that look similar to a minus sign (minus, hyphen, en-dash,
em-dash) and the assembly language only accepts the minus sign.  If
you get bad characters, the assembler will give an error message.
</p>
</div>
</div>

<div id="outline-container-org47a51aa" class="outline-3">
<h3 id="org47a51aa">Jumps and conditionals</h3>
<div class="outline-text-3" id="text-org47a51aa">
<p>
Conditionals allow a program to decide which statements to execute
based on Boolean expressions.  One example is the if-then statement,
for example:
</p>

<div class="CodeListing" id="org6239676"><pre>
if x&lt;y
  then statement 1
statement 2
</pre></div>

<p>
A related form is the if-then-else statement:
</p>

<div class="CodeListing" id="org8c23a9d"><pre>
if x&lt;y
  then statement 1
  else statement 2
statement 3
</pre></div>

<p>
Most high level control constructs can be translated into code that
contains just one form of conditional, the <b>conditional goto</b>.  This
uses a Boolean expression <i>bexp</i> to decide whether to jump to
<i>someLabel</i>, or not to jump:
</p>

<div class="CodeListing" id="org9ba391b"><pre>
if bexp then goto someLabel
</pre></div>

<p>
The commonest case is where <i>bexp</i> is a comparision between two
integers:
</p>

<div class="CodeListing" id="orgb1a2e6d"><pre>
if x &lt; y then goto someLabel
</pre></div>

<p>
This statement is implemented in assembly language in two steps:
</p>

<ol class="org-ol">
<li>First, a <b>comparison</b> instruction is used to produce a Boolean
result, which is placed in the <i>condition code</i> (which is in R15).</li>

<li>Second, a <b>conditional jump</b> instruction will either jump or not
jump, depending on the condition code.  This allows a choice of
what instruction to execute next.</li>
</ol>

<p>
The cmp instruction compares the integers in two registers, and it
sets R15 to the result of the comparison.  R15 is a special register
because several instructions, including cmp, use it automatically
without specifying R15 in the instruction.  Reflecting its special
status, R15 also has a name: it's called the <i>condition code</i>.
</p>

<p>
Any relational operation can be used; it isn't limited to less-than.
You can think of the condition code as holding a result like "less
than", or "equal", etc.  The way these comparison results are
represented will be covered later.
</p>

<p>
After setting the condition code with cmp, the program executes a
conditional jump.  The instruction jumplt someLabel[R0] will go to the
instruction with the specified label if and only if the condition code
indicates "less than" (lt).
</p>

<p>
Here is a high level language statement:
</p>

<div class="CodeListing" id="org39a0323"><pre>
if x &lt; y then goto someLabel
</pre></div>

<p>
To implement this in assembly language, we use a cmp instruction
followed by jumplt:
</p>

<div class="CodeListing" id="org58b06f6"><pre>
    load   R2,x[R0]       ; R2 := x
    load   R3,y[R0]       ; R3 := y
    cmp    R2,R3          ; compare x and y
    jumplt someLabel[R0]  ; if x &lt; y then goto someLabel
    xxx                   ; this executes if x &gt;= y
    xxx
    xxx
someLabel
    xxx                  ; this executes if x &lt; y
</pre></div>

<p>
The conditional jump instructions have the form jumpXX, where XX is a
relation, such as lt, eq, and so on:
</p>

<div class="CodeListing" id="org8077079"><pre>
jumplt  someLabel[R0]  ; if &lt;  then goto someLabel
jumple  someLabel[R0]  ; if &lt;= then goto someLabel
jumpeq  someLabel[R0]  ; if =  then goto someLabel
jumpne  someLabel[R0]  ; if != then goto someLabel
jumpge  someLabel[R0]  ; if &gt;= then goto someLabel
jumpgt  someLabel[R0]  ; if &gt;  then goto someLabel
</pre></div>

<p>
These conditional jumps treat the contents of the registers as
integers represented in two's complement notation.  This means, for
example, that $ffff is less than 0, because $ffff represents -1.
There are several more conditional jumps that you can use for
comparing natural numbers (binary), and a few other things as well.
</p>

<p>
A compare instruction is often followed immediately by a conditional
jump, as in the example above.  You can also save the result of a
comparison in a Boolean variable and perform logic on Boolean
variables.  The Boolean variables can later be used to control
conditional jumps.  This topic will be discussed later, as it involves
instructions from the full standard instruction set.
</p>

<p>
The address in a jump instruction &#x2013; the place to jump to &#x2013; is
normally specified as a label which is defined in the label field of
some instruction.  You can place a label in the same line as the
instruction, or it can be on a line with nothing else, in which case
the label refers to the next instruction.  In the following code,
label1 is the address of the add instruction and label 2 is the
address of the sub instruction.
</p>

<div class="CodeListing" id="org6eed381"><pre>
label1   add  R2,R4,R13
label2
         sub  R15,R0,R1
</pre></div>

<p>
If-then constructs are translated into assembly language following two
similar fixed patterns.  Suppose Bexp is a Boolean in any register Rd
</p>

<div class="CodeListing" id="org7791ebc"><pre>
if bexp
  then statement 1
statement 2
</pre></div>

<p>
This is translated according to the following pattern:
</p>

<div class="CodeListing" id="org6ca393b"><pre>
     if !bexp then goto L2
     statement 1
L2:
     statement 2
</pre></div>

<p>
Here is an example:
</p>

<div class="CodeListing" id="org19eaf95"><pre>
a := 93
x := 35
y := 71
if y &gt; x then a := 59
b := 104
</pre></div>

<p>
The corresponding assembly language is:
</p>

<div class="CodeListing" id="org4329acd"><pre>
; a := 93
      lea     R1,93[R0]    ; R1 := 93
      store   R1,a[R0]     ; a := 93

; x := 35
      lea     R1,35[R0]    ; R1 := 35
      store   R1,x[R0]     ; x := 35

; y := 71
      lea     R1,71[R0]    ; R1 := 71
      store   R1,x[R0]     ; x := 71

; if y &gt; x
      load    R1,y[R0]     ; R1 := y
      load    R2,x[R0]     ; R2 := x
      cmp     R1,R2        ; compare y with x
      jumple  R3,skip[R0]  ; if not y &gt; x then goto skip

;  then a := 59
      lea    R1,59[R0]     ; R1 := 59
      store  R1,a[R0]      ; a := 59

; b := 104
skip  lea    R1,104[R0]    ; R1 := 104
      store  R1,b[R0]      ; b := 104
</pre></div>

<p>
Notice the use of jumple: if the Boolean expression (y&gt;x) is False we
want to skip over the "then" part, so we want to jump if y &lt;= x (hence
jumple).
</p>

<p>
An if-then-else statement has a similar compilation pattern, but this
time there are two separate parts: the "then-part" and the
"else-part".  Depending on the value of the Boolean expression, one of
those parts should be executed and the other should be skipped over.
</p>

<p>
For if-then-else, and many other control constructs, we need an
<b>unconditional jump</b> which will always go to the specified address,
and which doesn't use a Boolean.
</p>

<div class="CodeListing" id="orgd41cdae"><pre>
jump   somewhere[R0]    ; go to somewhere
</pre></div>

<p>
The general form of an if-then-else is
</p>

<div class="CodeListing" id="orgb4b64c5"><pre>
if x &lt; y
  then S1
  else S2
S3  
</pre></div>

<p>
The general if-then-else construct can be translated to use just goto
and conditional goto:
</p>

<div class="CodeListing" id="org33fe3bb"><pre>
    if x &gt;= y then goto L2
    S1
    goto L3
L2: S2
L3: S3
</pre></div>
</div>
</div>

<div id="outline-container-orgf71ac8f" class="outline-3">
<h3 id="orgf71ac8f">Loops</h3>
<div class="outline-text-3" id="text-orgf71ac8f">
<p>
Loops are implemented using compilation patterns based on comparisons
and jumps.  The fundamental form is the <b>while loop</b>.
</p>

<div class="CodeListing" id="orgcfcb90f"><pre>
while Bexp do S1
S2
</pre></div>

<p>
The compilation pattern is:
</p>

<div class="CodeListing" id="org8d0e1de"><pre>
L1   if not Bexp then goto L2
     S2
     goto L1
L2
</pre></div>

<p>
Occasionally you may encounter an infinite loop, which is sometimes
expressed as a while loop:
</p>

<div class="CodeListing" id="orgff8a35e"><pre>
while true do S1
</pre></div>

<p>
This doesn't need a Boolean expression; it is simply compiled into:
</p>

<div class="CodeListing" id="org93a721c"><pre>
loop
   instructions for S1
   jump   loop[R0] 
</pre></div>

<p>
Infinite loops are rather rare, or at least they should be.  On
occasion they are exactly what is wanted.  For example, operating
systems contain a loop that looks for something useful to do, and then
does it, and this should be an infinite loop.
</p>

<p>
However, there is a common but poor programming style that uses
infinite loops with random break or goto statements to get out of the
loop.  This may be appropriate on occasion but generally it is bad
style.
</p>

<p>
So far we have seen several compilation patterns:
</p>

<ul class="org-ul">
<li>if-then</li>
<li>if-then-else</li>
<li>while</li>
</ul>

<p>
Every high level programming construct has a compilation pattern, and
they are mostly built using comparisons and jumps.  In principle,
these patterns are straightforward to use.  However, there are two
issues that require a little care: uniqueness of labels and nested
statements.
</p>

<p>
Labels must be unique: the same one cannot be used twice in the same
program, and if it is, the assembler will give an error message.
This means that you cannot follow the compilation patterns blindly.
If you use "loop" as the label for a while loop, as in the pattern
above, you need a different label for your next while loop.
</p>

<p>
The best approach here is not to use labels like loop, loop1, loop2.
It's far better to think about the <b>purpose</b> of the construct in your
program and to use a label that reflects this purpose.
</p>

<p>
Another complication is that most programs contain <b>nested
statements</b>.  These are statements that contain smaller statements,
and the containment may go several levels deep.
</p>

<div class="CodeListing" id="org4974484"><pre>
if b1
  then S1
       if b2 then S2 else S3
       S4
  else S5;
       while b3 do S6
S7
</pre></div>

<p>
There is an important principle to follow here: every time a statement
appears in a compilation pattern (we have been calling them S1, S2,
S3, etc.), it should be translated as a <b>block</b>.
</p>

<p>
A block is a sequence of instructions which <b>always</b> begins execution
at the first instruction, and <b>always</b> finishes at the end.  You
<b>never</b> jump into the middle of it, and it <b>never</b> jumps out of the
middle to some other place.
</p>

<p>
Every statement should be compiled into a block of code.  This block
may contain internal structure &#x2014; it may contain several smaller
blocks &#x2014; but to execute it you should always begin at the beginning
and it should always finish at the end.
</p>

<p>
In programming language theory, programming with blocks is often
considered to be good practice or good style.  But it is more than
just an issue of style.  If you always treat the statements inside
compilation patterns as blocks, the patterns will "just work", no
matter how deeply nested they are.  If you violate the block
structure, you will find it difficult to get the program to work.
</p>
</div>
</div>

<div id="outline-container-org00d9a62" class="outline-3">
<h3 id="org00d9a62">Machine language</h3>
<div class="outline-text-3" id="text-org00d9a62">
<p>
The bits representing an instruction (written in hex) (e.g 0d69) are
<b>machine language</b>.  The hardware runs the machine language &#x2014; it's
just looking at the numbers.  The text notation with names &#x2013; e.g. add
R13,R6,R9 &#x2013; is called <b>assembly language</b>.  Assembly language is for
humans to read and write; machine language is for machines to execute.
Both languages specify the program in complete detail, down to the
last bit.
</p>

<p>
As a program is running, the memory contains all your program's data:
the variables, data structures, arrays, lists, etc.  <b>The memory also
contains the machine language program itself.</b> The program is stored
inside the computer's main memory, along with the data.  This concept
is called <b>the stored program computer</b>.
</p>

<p>
There is an alternative approach: a computer can be designed to have
one memory to hold the data, and a completely separate memory to hold
the program.  This approach is often used for special-purpose
computers (primarily micro-controllers), but experience has shown this
to be inferior for general purpose computers.
</p>

<p>
Sigma16 has several different kinds of instruction.  These are called
<i>instruction formats</i>.  All the instructions with the same format have
similar representations in machine language.  The Sigma16 Core has two
instruction formats:
</p>

<ul class="org-ul">
<li>RRR instructions use the registers</li>
<li>RX instructions use the memory</li>
</ul>

<p>
The machine language program is in the memory.  Therefore we need to
represent each instruction as a word that can be stored in memory.  An
instruction format is a systematic way to represent an instruction
using one or more words (a word is a string of bits).
</p>

<ul class="org-ul">
<li>An RRR instruction is represented in one word</li>
<li>An RX instruction is represented in two words.</li>
</ul>
</div>

<div id="outline-container-orgcb03123" class="outline-4">
<h4 id="orgcb03123">RRR instructions</h4>
<div class="outline-text-4" id="text-orgcb03123">
<p>
Every RRR instruction is represented in one word (16 bits), which is
organised as four 4-bit fields.  When describing a machine word, we
normally write each field value as a hexadecimal digit: one of 0, 1,
2, 3, 4, 5, 6, 7, 8, 9, a, b, c, d, e, f.  These correspond to 0, 1,
&#x2026;, 15 in decimal.
</p>

<p>
The machine language code needs to specify which RRR instruction this
is.  Is it add? sub?  mul? another?  This is done with an operation
code &#x2014; a number that says what the operation is.  There are about a
dozen RRR instructions, so a 4-bit operation code suffices.  For
example, the add instruction has an opcode of 0.
</p>

<p>
We also need to specify three registers: destination and two source
operands.  There are 16 registers, so a specific one can be specified
by 4 bits.  Thus the requirements for an RRR instruction are 4 fields,
each containing 4 bits, for a total of 16 bits, so an RRR instruction
exactly fills one word.
</p>

<p>
The four fields in an RRR instruction are named:
</p>
<ul class="org-ul">
<li>op &#x2013; Operation code (e.g. add, sub, etc.)  This is a number that
specifies which instruction it is.</li>
<li>d &#x2013; Destination register</li>
<li>a &#x2013; First source operand register</li>
<li>b &#x2013; Second source operand register</li>
</ul>

<p>
Here are the operation codes for the RRR instructions we have seen so
far.  There are a few more RRR instructions, but they all have the
same form as these do.
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">mnemonic</th>
<th scope="col" class="org-right">opcode</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">add</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-left">sub</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-left">mul</td>
<td class="org-right">2</td>
</tr>

<tr>
<td class="org-left">div</td>
<td class="org-right">3</td>
</tr>

<tr>
<td class="org-left">trap</td>
<td class="org-right">b</td>
</tr>
</tbody>
</table>

<p>
Don't memorise this table: you just need to understand how it's used.
For example, let's translate this assembly language statement into
machine language:
</p>

<div class="CodeListing" id="orgb7bc6a0"><pre>
    mul  R14,R6,R10
</pre></div>

<ol class="org-ol">
<li>mul is an RRR instruction, so we need to find the values of the
four fields: op, d, a, b.</li>
<li>The table above says that the opcode for mul is $2 (that's 0010 as
a bit string).</li>
<li>The destination is R14, so the d field is $e.</li>
<li>The first operand is R6, so the a field is $6.</li>
<li>The last operand is R10, so the b field is $a.</li>
<li>Putting the fields together ("assembling them into an
instruction"), we get the machine language instruction: $2e6a.</li>
</ol>

<p>
Every RRR instruction is assembled the same way.  The numbers in the
fields will be different, but the procedure is always exactly the
same.
</p>
</div>
</div>

<div id="outline-container-orgc5f6df1" class="outline-4">
<h4 id="orgc5f6df1">RX instructions</h4>
<div class="outline-text-4" id="text-orgc5f6df1">
<p>
We have seen several RX instructions so far:
</p>

<div class="CodeListing" id="org641ce16"><pre>
    lea    R5,19[R0]   ; R5 = 19
    load   R1,x[R0]    ; R1 = x
    store  R3,z[R0]    ; z = R3
</pre></div>

<p>
An RX instruction contains two operands, separated by a comma.
</p>
<ul class="org-ul">
<li>The first operand is a register, and it's called the "register
operand" (e.g. R5)</li>
<li>The second operand is a constant or label followed by a register
(e.g. 19[R0] or x[R0]).  This is called the "address operand", and
it contains two parts:
<ul class="org-ul">
<li>The first part is either a constant like 19, or a label like x.
This part is called the "displacement", and its value is one word.
If this part is a constant (e.g. 19) then the value of the
displacement is simply the value of the constant.  If it's a label
like x, the value is the address in memory of x.</li>
<li>The seocnd part is a register in square brackets, e.g. [R0].  This
is called the "index register".  In the examples we've seen so
far, the index register has always been R0, but in general it can
be any register, and this is useful for several purposes we'll see
later.</li>
</ul></li>
</ul>

<p>
For RRR instructions, the op field contains a number saying which RRR
instruction it is.  This is the primary opcode.  For RX instructions,
the op field always contains f.  So how does the machine know which RX
instruction it is?  This is specified by a secondary code in the b
field.  Here are the full codes (op and b) for a few of the RX
instructions:
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">mnemonic</th>
<th scope="col" class="org-left">op</th>
<th scope="col" class="org-left">b</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">lea</td>
<td class="org-left">$f</td>
<td class="org-left">$0</td>
</tr>

<tr>
<td class="org-left">load</td>
<td class="org-left">$f</td>
<td class="org-left">$1</td>
</tr>

<tr>
<td class="org-left">store</td>
<td class="org-left">$f</td>
<td class="org-left">$2</td>
</tr>
</tbody>
</table>

<p>
Consider this assembly language statement:
</p>

<div class="CodeListing" id="org378a2ab"><pre>
     lea   R2,38[R7]
</pre></div>

<p>
There are two words in the machine language code.  The first word has
the same 4 fields as for RRR instructions: op, d, a, b, where
</p>

<ul class="org-ul">
<li>op contains $f for every RX instruction</li>
<li>d contains the register operand (in the example, $2)</li>
<li>a contains the index register (in the example, $7)</li>
<li>b contains a code indicating which RX instruction this is (1
means load).  This "secondary opcode" is required because the op
field just indicates that the instruction is RX format, but doesn't
say which RX instruction it is.</li>
</ul>

<p>
The second word contains the <b>displacement</b>.  In the example, this is
38 (or $0026).
</p>

<p>
If the address field of an instruction has a label (like x) rather
than a constant (lik 204), we need to know the value of the label in
order to assemble the instruction.  If x is a variable, the value of
the label x is the address of the variable in memory.  If x is a label
on an instruction, its value is the address of the instruction.
</p>

<p>
Example: translate load R7,x[R12] from assembly language to machine
language, given that the address of x is $0c3a.
</p>
<ul class="org-ul">
<li>First word:
<ul class="org-ul">
<li>op = $f (indicates that this is an RX instruction, but not which
one; that needs the b field)</li>
<li>d = $7 (the register operand)</li>
<li>a = $c (part of the address operand: the register [R12])</li>
<li>b = $1 (this is the secondary opcode, which indicates that this RX
instruction is load)</li>
<li>The first word is $f701</li>
</ul></li>
<li>Second word:
<ul class="org-ul">
<li>The displacement, part of the address operand, is $0c3a</li>
</ul></li>
<li>The complete machine language instruction: $f7c1 $0c3a</li>
</ul>

<p>
The instruction jump loop[R0] has only one operand in assembly
language, which is loop[R0].  This looks like an exception: the other
RX instructions have two operands.  However, the machine language
representation of jump also contains a register operand, just like all
RX instructions, but the machine ignores that register when the
program runs, and the assembler just sets it to R0 in the machine
code.  This is called a "don't care" operand.
</p>
</div>
</div>

<div id="outline-container-org94da082" class="outline-4">
<h4 id="org94da082">Pseudoinstructions</h4>
<div class="outline-text-4" id="text-org94da082">
<p>
We have seen conditional jump instructions like <b>jumplt loop</b>.
Technically, jumplt, jumpeq and the rest are called
"pseudoinstructions".  They are just a convenient assembly language
notations to describe the actual underlying machine language
instructions.  All conditional jumps are expressed in machine language
using just two real instructions: jumpc0 and jumpc1:
</p>

<div class="CodeListing" id="org9e387a1"><pre>
    jumpc0 Rd,disp[Ra]
    jumpc1 Rd,disp[Ra]
</pre></div>

<p>
The details of how jumpc0 and jumpc1 work will be discussed in the
section on the Standard architecture.  Here is a list of the
pseudoinstructions for conditional jumps after an integer comparison:
</p>

<div class="CodeListing" id="orgc54239a"><pre>
    jumplt  someLabel[R0]  ; if &lt;  then goto someLabel
    jumple  someLabel[R0]  ; if &lt;= then goto someLabel
    jumpeq  someLabel[R0]  ; if =  then goto someLabel
    jumpne  someLabel[R0]  ; if != then goto someLabel
    jumpge  someLabel[R0]  ; if &gt;= then goto someLabel
    jumpgt  someLabel[R0]  ; if &gt;  then goto someLabel
</pre></div>
</div>
</div>
</div>

<div id="outline-container-org0442997" class="outline-3">
<h3 id="org0442997">A strange program</h3>
<div class="outline-text-3" id="text-org0442997">
<p>
Consider "Program Strange" below.  You can find the program on the
Examples page (go to the Core/Instructions section), or you can copy
it from below and paste it into the Editor page.
</p>

<p>
This program doesn't compute anything particularly useful.  It's
rather strange and not a model for good programming style, but it
illustrates an extremely important concept, which is discussed in the
solution below.
</p>

<p>
The program has a variable y which is defined in the last line: y
data 0.  But you can edit that line to give y any initial value; it
doesn't need to be 0.
</p>

<p>
The aim of this tutorial is to figure out what the program does, and
to do so for several specific values of y.  A solution is given below,
but please try first to work it out for yourself.
</p>
</div>

<div id="outline-container-org75bbd5b" class="outline-4">
<h4 id="org75bbd5b">The problem</h4>
<div class="outline-text-4" id="text-org75bbd5b">
<p>
Run the program with several different initial values of the variable
y.  These values are given below.  For each run, assume that all the
registers contain 0 after the program is booted, before it begins
execution.  For each value of y, do the following:
</p>
<ol class="org-ol">
<li>Edit the last statement of the program to give y the specified
value.</li>
<li>Execute the program manually, with paper and pencil but without the
computer.  Give the final values of the registers.  Think about
what is going on as the program runs.</li>
<li>Assemble the program and boot it in the processor.  Run the program
on the emulator and check whether your execution was correct.  Be
sure to single-step through the program.  Before executing an
instruction, think about what it will do.  Then click Step and look
at the registers to see if you were right.</li>
</ol>

<p>
Here are the different variations:
</p>
<ol class="org-ol">
<li>Run the program in its original form, with <b>y data 0</b></li>
<li>Change the last line to <b>y data 1</b> and run it again</li>
<li>Now use <b>y data 256</b></li>
<li><b>y data 8192</b></li>
<li><b>y data -5424</b></li>
</ol>

<p>
And here is the program:
</p>

<div class="CodeListing" id="org13e2704"><pre>
; Strange: A Sigma16 program that is a bit strange    
        load   R1,y[R0]
        load   R2,x[R0]
        add    R2,R2,R1
        store  R2,x[R0]
        lea    R3,3[R0]
        lea    R4,4[R0]
x       add    R5,R3,R3
        add    R0,R0,R7
        trap   R0,R0,R0
y       data   0
</pre></div>
</div>
</div>

<div id="outline-container-orgb6e08fe" class="outline-4">
<h4 id="orgb6e08fe">Solution</h4>
<div class="outline-text-4" id="text-orgb6e08fe">
<p>
It's best to try answering the questions on your own first, and then
to check by running the program on the emulator, before reading the
solution!
</p>

<p>
The program loads an <b>instruction</b> into a register, does arithmetic on
it by adding <b>y</b> to it, and stores the result back into memory.  This
phenomenon is called <b>self-modifying code</b>, and it exploits the fact
that instructions and data are held in the same memory (this is the
<b>stored program computer</b> concept).  The original instruction is <b>add
R5,R3,R3</b>, and its machine language code is 0533.
</p>

<ol class="org-ol">
<li>When y=0, the final values are: R1=0, R2=0533, R3=3, R4=4, R5=6.
The only notable points are that the store instruction doesn't
actually change the value of the word in memory (it was 0533 and
0533 is being stored there), and the last add instruction doesn't
change the value in R0 because R0 can never change; it is always 0.
(Of course if R7=0 then the result of the addition is 0 anyway.)</li>

<li>When y=1, the final values are: R1=1, R2=0534, R3=3, R4=4, R5=7.
Note that R5 is <b>not</b> 3+3=6.  When y=1 is added to the instruction,
the result is 0534 which means <b>add R5,R3,R4</b>, so instead of adding
R3+R3 it adds R3+R4.</li>

<li>When y=256, the final values are: R1=256=0100, R2=0633, R3=3, R4=4,
R5=0, R6=6. The decimal number 256 is 0100 in hexadecimal.  When
this is added to the instruction, the result is 0633, which means
<b>add R6,R3,R3</b> so R3+R3 is loaded into R6, not into R5.</li>

<li>When y=8192, the final values are: R1=4096=2000, R2=2533, R3=3,
R4=4, R5=9.  The decimal number 8192 is 2000 in hexadecimal, and
when this is added to the instruction the result is 2533, which
means <b>mul R5,R3,R3</b>.  It's no longer an <b>add</b> instruction, it's a
<b>multiply</b> instruction that calculates R5 := R3*R3 = 9.</li>

<li>When y=-5424 the program goes into an infinite loop. R1=ead0 (the
hexadecimal representation of -5424), R2=f003, R3=3, and R4=4.
What started out as the <b>add</b> instruction at x has been transformed
into <b>jump 7[R0]</b>, comprising the word at <b>x</b> (f003) and the
following word (which is 0007).  This jump instruction goes back to
the first lea instruction, and the program runs for ever (lea, lea,
jump).</li>
</ol>

<p>
There is a lot to say about the phenomenon of self-modifying code.
</p>

<p>
This program shows clearly that a computer does not execute assembly
language; it executes machine language.  Try running it on the Sigma16
application (single step each instruction).  You'll see that the
assembly language statement <b>add R5,R3,R3</b> is highlighted in red, but
that is just the GUI trying to be helpful.  What's important is that
the machine language instruction is fetched from memory and loaded
into ir (the instruction register), and that is not 0533.  The machine
decodes the contents of ir and does whatever that says to do; it isn't
aware of the assembly language statement.  Indeed, a machine doesn't
even understand the concept of assembly language &#x2014; everything is
just bits!
</p>

<p>
To follow exactly what is happening in the emulator, it's important to
look at the pc and ir registers.  These reflect what the machine is
doing.  The assembly language does not.
</p>

<p>
What is self-modifying code good for?  The answer lies in the early
history of electronic computers.  Early computers (late 1940s and
early 1950s) did not use an effective address (i.e.  displacement +
index) like Sigma16; the instructions simply specified the absolute
memory address of an operand.  This is ok for simple variables, but
how could they process arrays?
</p>

<p>
The solution was to use self modifying code.  In a loop that traverses
an array, there would be a load instruction using address 0.  In the
body of the loop, there would be instructions to calculate the address
of x[i] by loading the address of x and adding i; this is then stored
into the address field of the load instruction.  That instruction is
then executed, obtaining the value of x[i].  This technique became
obsolete in the early 1950s with the invention of index registers and
effective addresses.
</p>

<p>
The pioneers of computers considered the concept of the <b>stored
program computer</b> (i.e. the program and data are in the same memory)
to be fundamental and essential.  One of the most important reasons
was that it made arrays possible.  Now we consider the stored program
concept to be fundamental <b>for different reasons</b>.
</p>

<p>
Self modifying code is tricky, and difficult to debug.  It makes
programs hard to read: you can't rely on what the program says, but on
what its instructions will become in the future.  For these reasons,
self modifying code is now considered to be bad programming practice.
</p>

<p>
If a program modifies itself, you can't have one copy of the program
in memory and allow it to be shared by several users.  For example,
it's common now to have a web browser open with several tabs.  Each
tab is served by an independent process (a separate running instance
of a program that updates the window showing the web page).  If you
have 5 tabs open, there are 5 processes, each running the same machine
language code, and there's only one copy of that in memory.  This
wouldn't work if the program modified itself!
</p>

<p>
Self modifying code leads to security holes: if a hacker has the
ability to change your machine language code in memory, they could
make your own program act against you.
</p>

<p>
Modern computers use a technique called <b>segmentation</b> that prevents a
program from modifying itself.  This leads to increased reliability
and security.
</p>

<p>
<a id="org817cf11"></a>
Some computers have a facility that allows you to gain the power of
self modifying code without actually modifying the code in memory.
The idea is to have an instruction <b>execute R1,x[R0]</b> which calculates
the logical or of the two operands and then executes the result; x is
the address of an instruction and R1 contains the modification to it.
The modified instruction is executed, but there is no change to the
machine code in memory.  This idea was used in the IBM 360 and its
successors.  However, as the design of effective addresses has become
more sophisticated, the execute instruction is rarely needed, and most
modern computers don't provide it.
</p>
</div>
</div>
</div>

<div id="outline-container-org4ebc607" class="outline-3">
<h3 id="org4ebc607">Breakpoints</h3>
<div class="outline-text-3" id="text-org4ebc607">
<p>
When you are testing or debugging a program, you may need to execute
many instructions before reaching the point you're interested in.
Some programs execute thousands of instructions just to initialize.
It's infeasible to step through all those instructions, yet if you
just run at full speed you won't be able to see what's happening in
the section you are working on.
</p>

<p>
The solution is to run the program at full speed but to force it to
stop when it reaches a specific instruction.  This is called a
<i>breakpoint</i>.  When the program stops at the breakpoint, you can
examine the registers and memory, and step through instructions from
that point.  At any time you can click Run and full speed execution
resumes, until either another breakpoint is encountered or the program
terminates.
</p>

<p>
Both a breakpoint and a halt instruction (trap R0,R0,R0) will stop
execution of the program.  The difference is that after a breakpoint
you can click Step or Run to continue, but after halt the program
cannot execute any more instructions until you boot the processor
again.
</p>

<p>
There are two ways to set a breakpoint:
</p>
<ul class="org-ul">
<li><i>Trap break</i>: Insert an instruction into the program that breaks
execution at that point.</li>
<li><i>External break</i>: Define a breakpoint in the user interface, without
modifying the program.</li>
</ul>

<p>
Both forms are useful.  Most of the time, while debugging a program, a
trap break is easier and more convenient.  However, if you don't want
to modify the program or reassemble it, or if you realise that you
need a breakpoint after execution has already started, then an
external break is better.
</p>
</div>

<div id="outline-container-org0baece2" class="outline-4">
<h4 id="org0baece2">Trap break</h4>
<div class="outline-text-4" id="text-org0baece2">
<p>
A trap break is a trap instruction whose first operand register
contains the value 4.  The other operand registers are ignored.  When
this instruction is executed, the emulator will stop execution, and
you can resume execution later by clicking Step or Run.
</p>

<p>
Suppose you want to check  what the load instruction is doing
in this code:
</p>

<div class="CodeListing" id="org2c6d302"><pre>
&#x2026;
add    R1,R2,R3
load   R4,x[R1]
&#x2026;
</pre></div>

<p>
Insert a breakpoint just <i>before</i> the instruction you want to examine.
The breakpoint requires two instructions.  The first instruction loads
the break code into some register (say R9 but it doesn't matter
which), and the second instruction is a trap which performs the break.
The first operand is the register that contains the break code, and
the other two operands are ignored, so we can just use R0.
</p>

<div class="CodeListing" id="orgff89105"><pre>
&#x2026;
add    R1,R2,R3
lea    R9,4       ; R9 := trap break code
trap   R9,R0,R0   ; breakpoint
load   R4,x[R1]
&#x2026;
</pre></div>

<p>
Now you can run the program at full speed, but when it executes the
trap instruction, the emulator will stop.  Since the trap instruction
has just executed, it will be highlighted in red, and the instruction
you're interested in &#x2013; the load &#x2013; will be highlighted in blue.
You can single step for a while, and click Run again at any time
to resume full speed execution.
</p>

<p>
A common technique is to put a trap break at the beginning of a loop.
By clicking Run repeatedly, you can step through the loop iterations.
</p>

<p>
For an example of a long running program with a trap break, see
Examples / Core / Testing / Looper.
</p>
</div>
</div>

<div id="outline-container-org6836513" class="outline-4">
<h4 id="org6836513">External break</h4>
<div class="outline-text-4" id="text-org6836513">
<p>
An external break tells the emulator to perform a breakpoint without
modifying the program.  Use these steps to set an external break:
</p>

<ol class="org-ol">
<li>Find the address of the instruction to stop at: look at the
assembly listing, find the instruction, and the listing gives its
address.</li>
<li>Go to the processor page, click Boot and then click
Breakpoint.</li>
<li>A small window will appear; type in the breakpoint address.  It
must be a hexadecimal address in assembly language format: it must
begin with a $ and then contain four hex digits.  No other
characters may be present, not even white space.</li>
<li>Click Refresh.  This parses the address you entered and remembers
it.  (If you change the address in the window, click Refresh
again.)</li>
<li>Click Enable.  This turns on the breakpoint.</li>
<li>Click CLose.  The breakpoint popup window will disappear so you can
see the Processor again.</li>
</ol>

<p>
Now click Run and the program will execute at full speed.  When the pc
register is equal to the breakpoint address, the emulator will stop.
Then you can Step or Run to continue execution.
</p>

<p>
As long as the breakpoint is enabled, execution will stop every time
that location is encountered.  To prevent this, open the breakpoint
popup again and click Disable.
</p>
</div>
</div>
</div>
</div>


<div id="outline-container-org75e4918" class="outline-2">
<h2 id="org75e4918">Standard architecture tutorials</h2>
<div class="outline-text-2" id="text-org75e4918">
<p>
The standard architecture provides additional registers and
instructions that simplify many programming tasks, such as logic,
functions, and procedures.  It supports systems programming, including
emulators, interpreters, and operating system kernels.  There are
assembler directives that simplify large scale programming, modules,
linking, and relocation.
</p>

<p>
Some of the instructions in the standard architecture are under
development and may be changed in future versions.
</p>
</div>

<div id="outline-container-orgc415097" class="outline-3">
<h3 id="orgc415097">Defining symbols with equ</h3>
<div class="outline-text-3" id="text-orgc415097">
<p>
Sometimes a program needs to use a constant.  For example, you may
need to refer to the bit in the condition code that indicates the
"less than" condition, or you may need to use an unusual logic
function that doesn't have a built-in pseudoinstruction.  Both of
these require special constants.
</p>

<p>
There are pseudoinstructions for the most common logic operations:
</p>

<div class="CodeListing" id="org47fe500"><pre>
andb   R2,R7,9,13      ; R2.9 := R2.9 and R7.13
</pre></div>

<p>
But suppose you want to use a less common logic function (for example,
nand) that doesn't have a pseudoinstruction.  You can use the general
logic instruction and specify the encoding of the logic function you
need.  The encoding for the nand function is 14, so you need this
instruction:
</p>

<div class="CodeListing" id="org0ef5c25"><pre>
logicb R2,R7,9,13,14   ; R2.9 := R2.9 nand R7.13
</pre></div>

<p>
However, it's poor programming style to use magic constants like 14 in
your program.  It's easy to get them wrong, it makes the code harder
to understand, someone else reading the program will wonder what the
14 means, and you might even forget it yourself.
</p>

<p>
The assembler provides the "equ" statement for defining symbols.  The
symbol you're defining goes in the label field.  The operation is equ,
and the operand is the value of the symbol.  Thus you can write "nand
equ 14" to define the symbol:
</p>

<div class="CodeListing" id="orgaba99c5"><pre>
nand equ     14             ; logic code for nand
</pre></div>

<p>
Now you can write nand instead of 14:
</p>

<div class="CodeListing" id="org83754ef"><pre>
logicb R2,R7,9,13,nand  ; R2.9 := R2.9 nand R7.13
</pre></div>

<p>
An equ statement must appear before any use of the symbol that it
defines.
</p>

<p>
This kind of statement, which doesn't generate an instruction but
merely gives the assembler some additional information, is called a
directive.  It is not a machine instruction.
</p>

<p>
In a program that does lots of logic, you could define the logic
functions near the beginning of the program:
</p>

<div class="CodeListing" id="org9bd7cd9"><pre>
; Symbolic names for common logic function codes
invx equ     12
and  equ     1
or   equ     7
xor  equ     6
nand equ     14
nor  equ     8
xnor equ     9
</pre></div>

<p>
There are many applications for the equ statement, besides defining
logic function constants.  You can give a symbolic name to condition
code flags you need, and for flags in system control registers, and
for the indices of fields in your application program.  If you have
size constants, such as the number of elements in an array or the size
of a stack or heap, you can define them with equ.
</p>

<p>
If you want to load the value of an equ symbol into a register, use
lea:
</p>

<div class="CodeListing" id="orge45171c"><pre>
lea    R3,nand[R0]  ; R3 := code for nand logic function
</pre></div>
</div>
</div>

<div id="outline-container-org372841a" class="outline-3">
<h3 id="org372841a">Some notations for convenience</h3>
<div class="outline-text-3" id="text-org372841a">
<p>
There are several shortcuts that can be useful for experienced
programmers, especially when working on large programs.  But when
you're starting out, it's better not to use these techniques.
</p>
</div>

<div id="outline-container-org4a2d95d" class="outline-4">
<h4 id="org4a2d95d">; before comment is optional if operand field exists</h4>
<div class="outline-text-4" id="text-org4a2d95d">
<p>
It isn't required to have a semicolon ; before every comment.  If an
assembly language statement has an operation field and an operand
field, then everything after the operand field is taken to be a
comment.
</p>

<div class="CodeListing" id="org183530c"><pre>
     lea  R3,42[R0]    This is a comment
     load R5,xyz[R0]   ; and so is this
</pre></div>

<p>
Although most assembly language statements have an operand field, some
do not.  In these cases, the semicolon is required to indicate a
comment.
</p>

<p>
It's good style to use a semicolon consistently to indicate a comment,
even where it wouldn't be required.
</p>
</div>
</div>

<div id="outline-container-org0e10728" class="outline-4">
<h4 id="org0e10728">[R0] is assumed if it's omitted</h4>
<div class="outline-text-4" id="text-org0e10728">
<p>
The instruction lea R3,42 is an abbreviation for the complete form,
lea R3,42[R0].  In an RX instruction, if you omit the [Reg] after the
displacement, the assembler will automatically use [R0].  The
following two assembly language statements describe the same
instruction:
</p>

<div class="CodeListing" id="orga6d3490"><pre>
     lea  R3,42[R0]   ; R3 := 42
     lea  R3,42       ; R3 := 42
</pre></div>

<p>
You can write the instruction either way; both are translated to
exactly the same machine language, and they execute exactly the same
way.  These are also equivalent:
</p>

<div class="CodeListing" id="orgf5ba423"><pre>
     jumplt loop[R0]  ; if &lt; then goto loop
     jumplt loop      ; if &lt; then goto loop
</pre></div>
</div>
</div>
</div>

<div id="outline-container-org1e9157e" class="outline-3">
<h3 id="org1e9157e">Common logic operations</h3>
<div class="outline-text-3" id="text-org1e9157e">
<p>
The Sigma16 architecture provides two general logic instructions:
logicf operates on fields within a word, and logicb operates on
individual bits.  Those two general instructions implement all
possible logic functions on two operands, not just inv, and, or, xor.
See the Architecture section below for an explanation of logicf and
logicb.
</p>

<p>
To simplify programming, Sigma16 also provides pseudoinstructions for
commonly used logic operations on words and bits.  These are described
below, and they are sufficient for many applications.  For each
pseudoinstruction, the assembler generates an equivalent logicf or
logicb instruction.
</p>
</div>

<div id="outline-container-orga3308b1" class="outline-4">
<h4 id="orga3308b1">Word logic</h4>
<div class="outline-text-4" id="text-orga3308b1">
<p>
Word logic operations are "bitwise": bit \(i\) of the result depends on
bit \(i\) of each operand, and does not depend on bits at any other
index.  There are pseudoinstructions for the most common word logic
operations: invw, andw, orw, xorw.
</p>

<p>
The invw pseudoinstruction inverts all the bits in a register:
</p>

<div class="CodeListing" id="org147a00b"><pre>
lea   R3,$f0f0[R0]   ; R3 := f0f0
invw  R3             ; R3 := 0f0f
</pre></div>

<p>
The other word logic pseudoinstructions take two register operands.
They calculate the result and place the result in the first operand
register, overwriting its previous value.  There is not a separate
destination register, as in the add instruction.
</p>

<p>
For example, andw R1,R2 calculates the logical <i>and</i> of R1 and R2, and
places the result in the destination register R1.
</p>

<div class="CodeListing" id="orgb2930c2"><pre>
lea   R1,$f0f0[R0]   ; R1 := f0f0
lea   R2,$00ff[R0]   ; R2 := 00ff
andw  R1,R2          ; R1 := 00f0
</pre></div>

<p>
The orw (logical inclusive or) and xorw (logical exclusive or)
instructions are similar.
</p>

<div class="CodeListing" id="orgbe952a8"><pre>
lea   R1,$f0f0[R0]   ; R1 := f0f0
lea   R2,$00ff[R0]   ; R2 := 00ff
orw   R1,R2          ; R1 := f0ff
xorw  R1,R2          ; R1 := f000
</pre></div>
</div>
</div>

<div id="outline-container-org32b4fce" class="outline-4">
<h4 id="org32b4fce">Bit logic</h4>
<div class="outline-text-4" id="text-org32b4fce">
<p>
There are also pseudoinstructions that perform logic on two individual
bits, which may be at any index in any register.  The result
overwrites the first operand.  For example, andb R1,R2,3,9 calculates
R1.3 and R2.9 and stores the result in R1.3.  Here are some examples:
</p>

<div class="CodeListing" id="orgb32fb3f"><pre>
   lea     R1,$00ff[R0]   ; R1 := 00ff
   lea     R2,$00f0[R0]   ; R2 := 00f0
   andb  R1,R2,3,9        ; R1 := 00f7
;       (R1.3 := R1.3 and R2.9 = 1 and 0 = 0)
   orb  R1,R2,11,5        ; R1 := 08f7
;       (R1.11 := R1.11 or R2.5 = 0 or 1 = 1)
   xorb  R1,R2,4,6        ; R1 := 08e7
;       (R1.4 := R1.4 xor R2.6 = 1 xor 1 = 0)
</pre></div>
</div>
</div>
</div>

<div id="outline-container-orge79498d" class="outline-3">
<h3 id="orge79498d">Bit manipulation</h3>
<div class="outline-text-3" id="text-orge79498d">
<p>
There are several instructions that treat a word as just a string of
bits, not as a number.  Some of these operate on individual bits in a
word, some operate on fields within a word, and some operate on the
entire word.
</p>
</div>

<div id="outline-container-org9ee9665" class="outline-4">
<h4 id="org9ee9665">Accessing individual bits</h4>
<div class="outline-text-4" id="text-org9ee9665">
<p>
You can set an individual bit in a register at a specified index to 0
using clearb.  The first operand is a register, and the second operand
is the index of the bit.  All other bits in the register remain
unchanged.  So clearb R3,2 makes R3.2 zero (that is, the bit at index
2 in R3).  All the other bits in R3 remain unchanged.
</p>

<div class="CodeListing" id="orgd8ad99d"><pre>
lea     R3,$ffff[R0]  ; R3 := ffff
clearb  R3,2          ; R3 := fffb  (R3.2 := 0)
</pre></div>

<p>
setb is similar, but it makes the specified bit 1.
</p>

<div class="CodeListing" id="org8793493"><pre>
lea     R3,$ffff[R0]  ; R3 := ffff
clearb  R3,2          ; R3 := fffb  (R3.2 := 0)
add     R4,R0,R0      ; R4 := 0000
setb    R4,6          ; R4 := 0040  (R4.6 := 1)
</pre></div>
</div>
</div>

<div id="outline-container-org9cab49a" class="outline-4">
<h4 id="org9cab49a">Shifting</h4>
<div class="outline-text-4" id="text-org9cab49a">
<p>
There are two shift instructions, which shift the word in Re by f bits
(to left or right) and place the result into Rd.  These are logical
shifts: the bits that are shifted out are discarded, and bits shifted
into the word are always 0.
</p>

<div class="CodeListing" id="org86e03be"><pre>
shiftl Rd,Re,f  ; Rd := Re shifted left by f bits
shiftr Rd,Re,f  ; Rd := Re shifted right by f bits
</pre></div>

<p>
Here are some examples; the comments show the expected result in both
hexadecimal and as bits.
</p>

<div class="CodeListing" id="orgbc6e7bc"><pre>
lea    R1,2[R0]  ; R2 = 0002   0000 0000 0000 0010
shiftl R5,R1,4   ; R5 = 0020   0000 0000 0010 0000
shiftl R6,R1,13  ; R6 = 4000   0100 0000 0000 0000
shiftr R7,R6,3   ; R7 = 0800   0000 1000 0000 0000
shiftr R7,R7,11  ; R7 = 0001   0000 0000 0000 0001
</pre></div>
</div>
</div>


<div id="outline-container-org72fdc72" class="outline-4">
<h4 id="org72fdc72">Extracting fields</h4>
<div class="outline-text-4" id="text-org72fdc72">
<p>
A common situation, especially in systems programming, is that you
have a word that contains several fields.  A machine language
instruction is like that; also a network packet contains a number of
fields.  The sizes of the fields, and their positions within a word,
can be anything.  Software, especially systems programming, often
needs to be able to extract a field from a word and put it somwhere
else so it can be used.
</p>

<p>
It's possible to obtain any field from a register, and put it
somewhere in another register, using a sequence of shift and logic
instructions (particularly shiftl, shiftr, andw, orw).  However, these
sequences of instructions are error prone, hard to read, and they
execute frequently in the inner loop of many systems programs.
</p>

<p>
Sigma16 provides an instruction <i>extract</i> which solves this problem
with just one instruction.  It allows you to extract an arbitrary
field from a register and put it into an arbitrary location in another
register.
</p>

<p>
The extract instruction takes operands that specify the source
register (which contains the field you're interested in), the
destination register (where it will put the field), the location of
the field in the source register (specifed as the index of the
rightmost and leftmost bits in the field), and the location where you
want to put the field in the destination register.
</p>

<p>
This instruction copies 4 bits from R1.4:7 to R2:8:11:
</p>

<div class="CodeListing" id="orgfada022"><pre>
extract  R2,R1,8,4,7   ; R2.8:11 := R1.4:7
</pre></div>

<p>
In this example, the operands are:
</p>
<ul class="org-ul">
<li>R2 is the destination register</li>
<li>R1 is the source register</li>
<li>8 is the index of the rightmost bit in the destination where the
field will be placed at ascending bit indices</li>
<li>4 is the index of the rightmost bit of the field in the source
register</li>
<li>7 is the index of the leftmost bit of the field in the source
register</li>
</ul>

<p>
This instruction is equivalent to the following (although it is just
one instruction, not four instructions):
</p>

<pre class="example" id="orge8c2d2a">
R2.8  :=  R1.4
R2.9  :=  R1.5
R2.10 :=  R1.6
R2.11 :=  R1.7 
</pre>

<p>
The extract instruction modifies only the specified bits in the
destination register; the other bits remain unchanged.
</p>

<p>
Here is an executable example:
</p>

<div class="CodeListing" id="org5e89826"><pre>
lea      R1,$00f0[R0]  ; R1 = 00f0
add      R2,R0,R0      ; R2 = 0000   
extract  R2,R1,8,4,7   ; R2 = 0f00  R2.8:11 := R1.4:7
</pre></div>
</div>
</div>
</div>

<div id="outline-container-org355ec53" class="outline-3">
<h3 id="org355ec53">Saving and restoring contiguous registers</h3>
<div class="outline-text-3" id="text-org355ec53">
<p>
There are several situations where a program needs to store a sequence
of registers into consecutive memory locations. Later the registers
must be reloaded from the block of memory.  One example is a procedure
call; another example is gaining access to all the fields of a record.
These operations are supported by the save and restore instructions.
</p>

<p>
The following save instruction stores R3, R4, &#x2026;, R9 into consecutive
memory locations, starting at 5[R14]:
</p>

<div class="CodeListing" id="org1195b33"><pre>
    save    R3,R9,5[R14]   ; save R3 to R9
</pre></div>

<p>
The save is equivalent to a sequence of individual store instructions:
</p>

<div class="CodeListing" id="orgd982771"><pre>
    store   R3,5[R14]
    store   R4,6[R14]
    store   R5,7[R14]
    store   R6,8[R14]
    store   R7,9[R14]
    store   R8,10[R14]
    store   R9,11[R14]
</pre></div>

<p>
To get the values from memory back into the registers, use this
restore instruction:
</p>

<div class="CodeListing" id="org4bd57c8"><pre>
     restore R3,R9,5[R14]  ; restore R3 to R9
</pre></div>

<p>
The restore is equivalent to a sequence of individual load
instructions:
</p>

<div class="CodeListing" id="orga7b4566"><pre>
    load    R3,5[R14]
    load    R4,6[R14]
    load    R5,7[R14]
    load    R6,8[R14]
    load    R7,9[R14]
    load    R8,10[R14]
    load    R9,11[R14]
</pre></div>

<p>
Using save and restore makes the code shorter and more readable, and
it's easier to check that the save an restore match each other.
</p>
</div>
</div>
</div>


<div id="outline-container-sec-architecture" class="outline-2">
<h2 id="sec-architecture">The Sigma16 architecture</h2>
<div class="outline-text-2" id="text-sec-architecture">
<p>
Sigma16 contains a set of registers, an arithmetic logic unit (ALU)
and functional units for arithmetic calculations, a memory, a memory
management unit that provides virtual memory, an interrupt system, and
an Input/Output controller using direct memory access (DMA).
</p>
</div>

<div id="outline-container-orgf9fe977" class="outline-3">
<h3 id="orgf9fe977">Implementations</h3>
<div class="outline-text-3" id="text-orgf9fe977">
<p>
The Sigma16 software application contains a complete programming
environment, using emulation to implement the processor.  The
programming environment includes a file manager, editor, assembler,
linker, and emulator, and it provides Input/Output and secondary
storage.  The software runs in a web browser, and does not require any
installation.  There are also command line tools which can be
installed on a local computer, but they are not necessary.
</p>

<p>
There is also a digital circuit, specified in a functional hardware
description language, which implements the Core architecture.  The
circuit specification is executable, and Core programs can be executed
by simulating the circuit.  The circuit is suitable for implementation
using either an FPGA or a custom VLSI design.  In simulation, the
simulation driver provides Input/Output, and in a hardware realisation
these would be provided by I/O hardware.
</p>
</div>
</div>

<div id="outline-container-orga9dba66" class="outline-3">
<h3 id="orga9dba66">Subsystems</h3>
<div class="outline-text-3" id="text-orga9dba66">
<p>
A <b>register</b> is a digital circuit that can retain one word of data.  A
new value can be loaded into a register, and the current contents may
be read out.  Registers are fast, and most computation is performed
using the registers.  Sigma16 contains several groups of registers;
each group is displayed in a box on the Processor tab.
</p>

<ul class="org-ul">
<li>The <b>Register File</b> is an array of 16 registers named R0, R1,
\(\ldots\), R15.  These registers are accessible to the machine
language program.  Programs use the register file to hold variables
that are currently in use.</li>
<li>The <b>Control</b> registers (pc, ir, adr) keep track of the instruction
that is currently executing.</li>
<li>The <b>System</b> registers control the system status and interrupts.</li>
<li>The <b>Virtual Memory</b> registers are used for memory management.</li>
</ul>

<p>
The <b>memory</b> is an array of \(2^{16}\) words.  Each word in the memory
is identified by an <b>address</b>, which is a 16-bit natural number.  The
memory is similar to the register file, but significantly slower and
much larger.
</p>

<p>
<b>Computational units.</b> The ALU (arithmetic and logic unit) is a
circuit that can do arithmetic, such as addition, subtraction,
comparison, and some other operations More complex operations, such as
multiplication and division, are provided by functional units.
</p>

<p>
The <b>Input/Output</b> system can transfer data between the computer and
the outside world.
</p>
</div>
</div>

<div id="outline-container-org61bb1e6" class="outline-3">
<h3 id="org61bb1e6">Words</h3>
<div class="outline-text-3" id="text-org61bb1e6">
<p>
In Sigma16, a <b>word</b> is a sequence of 16 bits.  Occasionally we will
also refer to a <b>double word</b> (a sequence of 32 bits).  A a <b>generic
word</b> is a sequence of bits of arbitrary length.  The system does not
use bytes (a byte is 8 bits) or extended words (64 bits).
</p>

<p>
The hardware components in Sigma16 are mostly 16 bits wide.  Each
addressable memory location is a word, and a memory address is a word.
Each register is a word.
</p>

<p>
By itself, a word has no inherent meaning: it is just a sequence of
bits.  Some instructions operate on a word without regard to what it
means: for example, several instructions copy a word from one place to
another and it doesn't matter what the word means.  Other instructions
act on a word assuming that it represents some particular primitive
data type.  For example, integer arithmetic assumes that the word
represents an integer, while address arithmetic assumes that the word
represents a natural number.
</p>

<p>
Sigma16 supports natural numbers, and integers, which are represented
as words.  It also supports Booleans, which are represented as a bit
within a word.  Addresses and characters are represented as natural
numbers.
</p>
</div>

<div id="outline-container-org1dfbcdc" class="outline-4">
<h4 id="org1dfbcdc">Indexing bits in a word</h4>
<div class="outline-text-4" id="text-org1dfbcdc">
<p>
The bits of a word are indexed from right to left, starting with
index 0.  The least significant (rightmost) bit has index 0, and the
most significant bit (leftmost) has index 15.
</p>

<p>
The notations \(x_i\) and <code>x.i</code> both mean the bit with index \(i\) in the
word \(x\), for \(0 \leq i \leq 15\).  For example, \(x_0\) is the rightmost
bit and \(x_{15}\) is the leftmost bit.  When used in an instruction, a
bit index is specified as a 4-bit binary number \(i\) such that \(0 \leq
i \leq 15\).
</p>

<p>
The following table shows the indices of all the bits in a word.  The
vertical bars break the word into groups of 4 bits.  This grouping
corresponds to the representation of the word in hex notation.
</p>


<p>
\[\fbox{$\ x_{15}\> x_{14}\> x_{13}\> x_{12}
  \ \vert\ x_{11}\> x_{10}\> x_{9}\> x_{8}$}\]
</p>

<p>
\[\fbox{$ \ \vert\ x_{7}\> x_{6}\> x_{5}\> x_{4}
  \ \vert\ x_{3}\> x_{2}\> x_{1}\> x_{0}
  \ $}\]
</p>
</div>
</div>

<div id="outline-container-orga0cc873" class="outline-4">
<h4 id="orga0cc873">Fields</h4>
<div class="outline-text-4" id="text-orga0cc873">
<p>
A bit field is a contiguous sequence of bits in a word.  It is
specified by two numbers: the indices of the rightmost and leftmost
bits in the field.
</p>
</div>
</div>

<div id="outline-container-orgbcc9ffb" class="outline-4">
<h4 id="orgbcc9ffb">Natural numbers</h4>
<div class="outline-text-4" id="text-orgbcc9ffb">
<p>
The natural numbers are \(0, 1, 2, \ldots\), so all natural numbers are
nonnegative.  Sigma16 represents natural numbers as binary, and uses
them to represent memory addresses.  The binary value of an \(n\) bit
generic word \(x\) is
</p>

<p>
\[binval (x) = \sum_{0 \leq i < n} x_i * 2^i\]
</p>

<p>
For a word of 16 bits, natural numbers are restricted to the range
from 0 through \(2^{16}-1\); that is, from 0 through 65,535.  For a
double word (32 bits), natural numbers are restricted to the range
from 0 through \(2^{32}-1\); that is, from 0 through 4,294,967,295.
</p>

<p>
A natural number (and hence a binary number) cannot be negative.  If
you need numbers that can be negative or positive, you must use an
integer.  The arithmetic instructions in Sigma16 operate on integers,
but address arithmetic is performed in binary.
</p>
</div>
</div>

<div id="outline-container-orgfc1bbb8" class="outline-4">
<h4 id="orgfc1bbb8">Integers</h4>
<div class="outline-text-4" id="text-orgfc1bbb8">
<p>
Integers are represented using two's complement notation.  If the
leftmost (most significant) bit of a word is 0, its two's complement
value is the same as its binary value.  If the leftmost bit is 1, the
two's complement value is negative.
</p>

<p>
Any two's complement number (with one exception) can be negated by
inverting all the bits (replace 0 by 1 and vice versa) and then adding
1, discarding any overflow.  The sole exception is that if the
smallest negative number (\(-2^{15}\)) is negated, the result is
overflow because the largest positive integer representable in 16 bit
two's complement is \(2^{15}-1\).
</p>

<p>
For example, consider \(x\) = 1111 1010.  Since the leftmost bit is 1,
we know that \(x < 0\).  We can negate \(x\) by inverting the bits,
obtaining 0000 0101.  Adding 1 gives 0000 0110 which is 6.  Since \(-x
= 6\), we conclude that \(x = -6\).
</p>
</div>
</div>

<div id="outline-container-org28f79bc" class="outline-4">
<h4 id="org28f79bc">Notations for a word</h4>
<div class="outline-text-4" id="text-org28f79bc">
<p>
Assembly language provides several notations for expressing the value
of a word.
</p>

<ul class="org-ul">
<li>A natural number between 0 and 65,535 (2<sup>16</sup> - 1)</li>
<li>An integer between -32,768 and 32,767 (-2<sup>15</sup> and 2<sup>15</sup> - 1)</li>
<li>A 4-digit hexadecimal constant, where the digits are 0-9 a-f.  The
constant is preceded by $, for example $3e8c.</li>
</ul>

<p>
In assembly language programs, hexadecimal constants are written with
a preceding $ sign (e.g. $3b2f).  This is necessary to avoid
ambiguity: 1234 is a decimal number and $1234 is a hexadecimal number,
and they denote different words.
</p>

<p>
Assembly language always requires a $ before a hexadecimal constant.
For displays of the machine state, in contexts where there is no
ambiguity, the $ may be omitted.  For example, the user interface
displays register and memory contents as hexadecimal without the
leading $.  However, the $ is always required for hex constants in
assembly language programs.
</p>
</div>
</div>
</div>

<div id="outline-container-orgf3bf9ed" class="outline-3">
<h3 id="orgf3bf9ed">Memory</h3>
<div class="outline-text-3" id="text-orgf3bf9ed">
<p>
The memory is a hardware array of words that are accessed by address.
A memory address is 16 bits wide, and there is one memory location
corresponding to each address, so there are 2<sup>16</sup> = 64k memory
locations (1k = 1,024).  Each memory location is a 16-bit word.
</p>

<p>
Instructions specify memory addresses in two parts: the
<b>displacement</b>, which is a word representing a binary number, and the
<b>index</b>, which is one of the registers in the register file.  For
example, a memory address could be specified as $003c[R5]; the
displacement is 003c and the index is R5.
</p>

<p>
When the instruction is executed, the computer calculates the
<b>effective address</b> by adding the value of the displacement and the
value in the index register.  If R5 contains 2, then the effective
address of $003c[R5] is 003e.
</p>

<p>
This scheme may seem more complicated than simply specifying the
address directly, but it is flexible.  If the machine language just
gave the address as a single binary number, it would be limited to
accessing simple static variables.  The effective address mechanism is
simple to implement in hardware, as you can see in the digital circuit
processor, yet it allows the implementation of static variables, local
variables, records, arrays, pointers and linked data structures, jump
tables, and more.  These techniques are described later.
</p>
</div>
</div>

<div id="outline-container-orga8e6daa" class="outline-3">
<h3 id="orga8e6daa">Registers</h3>
<div class="outline-text-3" id="text-orga8e6daa">
</div>
<div id="outline-container-org58d0120" class="outline-4">
<h4 id="org58d0120">Register file</h4>
<div class="outline-text-4" id="text-org58d0120">
<p>
The <b>register file</b> is a set of 16 general registers, each of which
holds a 16 bit word.  A register is referenced by a 4-bit binary
number.  In assembly language, we use the notations R0, R1, R2, &#x2026;,
R9, R10, R11, R12, R13, R14, R15 to refer to the registers.  The state
of the register file can be written as a table showing the value of
each register:
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Register</th>
<th scope="col" class="org-left">Contents</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">R0</td>
<td class="org-left">0000</td>
</tr>

<tr>
<td class="org-left">R1</td>
<td class="org-left">fffe</td>
</tr>

<tr>
<td class="org-left">R2</td>
<td class="org-left">13c4</td>
</tr>

<tr>
<td class="org-left">&#x2026;</td>
<td class="org-left">&#x2026;</td>
</tr>

<tr>
<td class="org-left">R14</td>
<td class="org-left">03c8</td>
</tr>

<tr>
<td class="org-left">R15</td>
<td class="org-left">0020</td>
</tr>
</tbody>
</table>

<p>
Sigma16 is a load/store style architecture.  All calculations are
carried out in the register file, and explicit load and store
instructions must be used to copy data between the memory and the
register file.
</p>

<p>
R0 and R15 are special.  The other registers, R1 through R14, may be
used for any purpose.
</p>

<ul class="org-ul">
<li>R0 always contains the constant 0.</li>
</ul>

<p>
It is legal to perform an instruction that attempts to load some other
value into R0, but the register will still contain 0 after executing
such an instruction.  Such an instruction will simply have no lasting
effect.
</p>

<ul class="org-ul">
<li>R15 is the condition code register.</li>
</ul>
</div>
</div>

<div id="outline-container-orgfb38869" class="outline-4">
<h4 id="orgfb38869">Condition code</h4>
<div class="outline-text-4" id="text-orgfb38869">
<p>
Several instructions produce status information: the result of a
comparison, whether there was an overflow, etc.  This information is
automatically loaded into R15, which is also called the <i>condition
code</i>.  The description of each instruction states whether R15 is
modified, and what goes into it.
</p>

<p>
Each bit in the condition code (R15) is a Boolean that specifies
whether a specific condition is false (0) or true (1).  The bits are
indexed from bit 0 (rightmost, or least significant) to bit 15 (the
leftmost, or most significant).  Condition code bits are sometimes
called <i>flags</i>.  Each flag gives the status of a relation or event.
If the flag is True (1) the relation holds or the event has occurred.
If the flag is False (0) the relation does not hold, or the event has
not occurred.
</p>

<p>
One way to use flags in the condition code is to control conditional
jumps.  The jumpc0 and jumpc1 instructions are conditional jumps that
use a flag in R15 to decide whether to jump:
</p>
<ul class="org-ul">
<li>Use jumpc0 to jump if the Boolean is False</li>
<li>Use jumpc1 to jump if the Boolean is True</li>
</ul>

<p>
Both jumpc0 and jumpc1 take two operands.  The first is a natural
number from 0 to 15, which gives the index of a flag in the condition
code.  The second is an address to jump to, specified as
displacement[index].  The indices of the flags are given below.
</p>

<p>
The two conditional jumps (jumpc0 and jumpc1) let you jump depending
on either the truth or falsity of a condition.  For example, the flag
at index 4 denotes integer less than.  The fist pair of instructions
below jumps if the less than condition holds, and the second pair
jumps if the less than condition is false.  This is equivalent to
jumping if the "greater than or equal" condition holds.
</p>

<div class="CodeListing" id="org447c528"><pre>
cmp     R8,R9
jumpc1  4,xyz[R0] ; if R8 &lt; R9 then goto xyz
&#x2026;
cmp     R8,R9
jumpc0  4,xyz[R0] ; if R8 &gt;= R9 then goto xyz
</pre></div>

<p>
Programs usually use pseudoinstructions rather than the actual machine
instructions jumpc0 and jumpc1.  For example, the following two
instructions are equivalent: the assembler generates exactly the same
machine language code for them.
</p>

<div class="CodeListing" id="org0d5379f"><pre>
jumpc1  4,xyz[R0] ; if R8 &lt; R9 then goto xyz
jumplt  xyz[R0]   ; if R8 &lt; R9 then goto xyz
</pre></div>

<p>
In effect, the pseudoinstruction lets you omit the flag index and
instead to indicate the condition you want in the mnemonic.  It's
easier to remember that less than is indicated by lt than by 4.
</p>

<p>
Another way to use condition code flags is to save them as Boolean
variables and perform logic operations on them.  In this case it's
best to copy a flag to another register, using copyb.  From there you
can evaluate logic expressions using andb, orb, xorb, and logicb.  It
isn't a good idea to keep Boolean variables in R15 for a long time,
because many instructions will modify it.
</p>

<p>
Before doing logic operations on condition code bits, consider whether
"short circuit" evaluation, with a separate comparison followed by
conditional jump for each relation, is more appropriate.
</p>

<p>
There is not just one flag for "less than" and another for "greater
than".  There are separate flags for integers (represented as two's
complement) and natural numbers (represented as binary).  This is
necessary because the relation between two words sometimes depends on
the type of the data.  For example, consider the word ffff (all 1
bits).  On its own, ffff is just a word of bits and has no inherent
meaning.
</p>

<ul class="org-ul">
<li>If ffff is interpreted as a natural number (i.e. binary), it is
positive and has the value 65,535, and ffff &gt; 0000.</li>
<li>If ffff is interpreted as an integer (i.e. two's complement), then
it is negative and has the value -1, and ffff &lt; 0000.</li>
</ul>

<p>
The cmp instruction compares two words, and evaluates five relations
between the words: equality, less than for both natural and integer,
and greater than for both natural and integer.  These evaluations are
performed simultaneously, using parallelism in the ALU circuit, and
the result of each is recorded in the corresponding flag in the
condition code.
</p>

<div class="CodeListing" id="org7d2fcd8"><pre>
    cmp    R5,R6
    jumpc1 3,lessNat[R0]  ; if R5 &lt;Nat R6 then goto lessNat
    &#x2026;
    cmp    R7,R8
    jumpc1 4,LessInt[R0]  ; if R7 &lt;Int R8 then goto lessInt
</pre></div>

<p>
Thus you don't specify the types of the operands in the cmp
instruction.  Instead, you select the condition code flag that
corresponds to the types.
</p>

<p>
Each flag has a short 1-character name to enable it to be displayed
compactly in the user interface.  A naming convention is that flags
for integers (two's complement) have lower case letters, while flags
for natural numbers (binary) have upper case letters.  For example:
</p>

<ul class="org-ul">
<li>l means &lt; for integers</li>
<li>L means &lt; for natural numbers</li>
<li>g means &gt; for integers</li>
<li>G means &gt; for natural numbers</li>
</ul>

<p>
Equality is the same regardless of type.  If two words consist of
exactly the same bits, then they have the same value as integers,
natural numbers, characters, addresses, and for any other possible
type as well.  Therefore there is only one flag for equality, and its
symbol is =.
</p>

<p>
Register R15 is also called the <i>condition code</i>.  Some instructions
modify a bit in the condition code to indicate the results of
comparisons, overflow, carry, other special data, and various errors.
Instructions that operate on registers can access R15 as usual. There
are also some instructions that implicitly access R15 without
specifying it (for example, jumpc0 and jumpc1).  Since many
instructions modify the condition code as a side effect, programs
should not use R15 to hold variables.
</p>

<p>
The following table lists all the condition code flags.
</p>
<ul class="org-ul">
<li>Index is the bit position of the flag in the condition code.  Bits
are numbered from right to left, starting with 0.</li>
<li>Symbol: the graphical user interface shows the symbol for each bit
that is 1.  For example, if G is displayed after a comparison of two
words, this means that &gt; holds if the words are interpreted as
natural numbers but not if they are interpreted as integers.
However, if G&gt; is displayed, the comparison result is greater than
for both integer and two's complement representation.</li>
<li>Meaning: Description using English or mathematical notation</li>
<li>Hex: The value of the condition code word assuming the given flag is
true and all others are false.  If several flags are true, the
condition code register will be the logic or of the hex values of
the true flags.  For example, suppose the words 00a3 is compared
with 00c5.  The comparison result is L (less than for naturals) and
also l (less than for integers).  So the condition code will contain
0008 + 0010 = 0018.</li>
</ul>

<p>
Table: Condition code flags
</p>

<div style="overflow-x: auto">
<!-- This HTML table template is generated by emacs 29.4 -->
<table border="1">
  <tr>
    <td align="left" valign="top">
      &nbsp;Index&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;Symbol&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;Meaning&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;&nbsp;Hex&nbsp;
    </td>
  </tr>
  <tr>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;>&nbsp;g&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;>&nbsp;Int&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;0001&nbsp;
    </td>
  </tr>
  <tr>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;G&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;>&nbsp;Nat&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;0002&nbsp;
    </td>
  </tr>
  <tr>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;0004&nbsp;
    </td>
  </tr>
  <tr>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;L&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;<&nbsp;Nat&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;0008&nbsp;
    </td>
  </tr>
  <tr>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;<&nbsp;l&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;<&nbsp;Int&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;0010&nbsp;
    </td>
  </tr>
  <tr>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;v&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;Int&nbsp;overflow&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;0020&nbsp;
    </td>
  </tr>
  <tr>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;6&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;V&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;Nat&nbsp;overflow&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;0040&nbsp;
    </td>
  </tr>
  <tr>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;7&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;C&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;Carry&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;0080&nbsp;
    </td>
  </tr>
  <tr>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;8&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;S&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;Stack&nbsp;overflow&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;0100&nbsp;
    </td>
  </tr>
  <tr>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;9&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;s&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;Stack&nbsp;underflow&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;0200&nbsp;
    </td>
  </tr>
  <tr>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;10&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;reserved&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;0400&nbsp;
    </td>
  </tr>
  <tr>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;11&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;reserved&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;0800&nbsp;
    </td>
  </tr>
  <tr>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;12&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;reserved&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;1000&nbsp;
    </td>
  </tr>
  <tr>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;13&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;reserved&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;2000&nbsp;
    </td>
  </tr>
  <tr>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;14&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;reserved&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;4000&nbsp;
    </td>
  </tr>
  <tr>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;15&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;reserved&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;8000&nbsp;
    </td>
  </tr>
</table>
</div>

<p>
There is an exception for division by zero, but no corresponding flag
in the condition code.  The reason is that the div instruction places
the remainder in R15, so the condition code isn't available to
represent division by 0.  You can use an interrupt to detect division
by 0, and you can test explicity for division by 0 by using jumpz
specifying the register containing the divisor before executing the
div instruction.
</p>
</div>

<ul class="org-ul">
<li><a id="org049b86e"></a>The ordinary general registers: R1 through R14<br />
<div class="outline-text-5" id="text-org049b86e">
<p>
Registers R1 through R14 have no special properties defined by the
machine.  A program can use them for any purpose.
</p>

<p>
However, there are some programming conventions that use certain
registers for special purposes.  The hardware does not enforce, or
even know about, these conventions, and you do not have to follow the
conventions in programming.  However, it is necessary to obey the
conventions in order to use the standard software libraries in your
program.  See the section on Programming for a discussion of these
standard usage conventions.
</p>
</div>
</li>
</ul>
</div>

<div id="outline-container-orgfce8ec5" class="outline-4">
<h4 id="orgfce8ec5">Instruction control registers</h4>
<div class="outline-text-4" id="text-orgfce8ec5">
<p>
The instruction control registers enable the processor to keep track
of the state of the running program.  These registers are rarely used
directly by the machine language program, but they are essential for
keeping track of the execution of the program, and some instructions
use them directly.
</p>
</div>

<ul class="org-ul">
<li><a id="orge8c869b"></a>pc &#x2013; program counter<br />
<div class="outline-text-5" id="text-orge8c869b">
<p>
The PC (program counter) register contains the address of the next
instruction to be executed (<i>not</i> the address of the instruction
currently being executed).  The name is illogical, but "program
counter" is the traditional name and Sigma16 sticks with standard
terminology.
</p>
</div>
</li>

<li><a id="org7eb4d8d"></a>ir &#x2013; instruction register<br />
<div class="outline-text-5" id="text-org7eb4d8d">
<p>
The IR contains the instruction that is currently executing.  If the
instruction is RRR format, the entire instruction is in the IR.
The other instruction formats require two words; the first word is in
the IR and the second word is in the ADR register.
</p>
</div>
</li>

<li><a id="org7cc173e"></a>adr &#x2013; address register<br />
<div class="outline-text-5" id="text-org7cc173e">
<p>
If the instruction currently executing is RRR format, the ADR register
is not used, and its content is just whatever was left over from
previous instructions.
</p>

<p>
If the instruction currently executing is RX or EXP format, the ADR
register contains the second word of the instruction.  Furthermore,
for RX instructions the effective address is calculated and replaces
the second word of the instruction.
</p>
</div>
</li>

<li><a id="org5cbdb54"></a>status &#x2013; system status register<br />
<div class="outline-text-5" id="text-org5cbdb54">
<p>
The status register contains flags that specify the current execution
mode of the processor.
</p>


<div style="overflow-x: auto">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">Index</th>
<th scope="col" class="org-left">Symbol</th>
<th scope="col" class="org-left">Meaning</th>
<th scope="col" class="org-right">Hex</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">0</td>
<td class="org-left">U/S</td>
<td class="org-left">0: user state. 1: system state</td>
<td class="org-right">0001</td>
</tr>

<tr>
<td class="org-right">1</td>
<td class="org-left">E</td>
<td class="org-left">1: interrupts enabled</td>
<td class="org-right">0002</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-right">&#xa0;</td>
</tr>
</tbody>
</table>

</div>

<p>
If the processor is in system state, any instruction can be executed.
If it is in user state, executing a privileged instruction causes an
interrupt.
</p>

<p>
When the system is started by booting a program, the status is set to
system state.  If the program is just a standalone program (such as
the simple examples), you can ignore the system state.  If an
operating system has been booted, the OS should put the processor into
user state when it gives a time slice to a user process.
</p>

<p>
If the status register indicates that interrupts are enabled, and an
interrupt request is set in the request register, than an interrupt
occurs when the current instruction is completed.  If interrupts are
not enabled, then interrupt requests are ignored.
</p>
</div>
</li>
</ul>
</div>
</div>

<div id="outline-container-orgb870d88" class="outline-3">
<h3 id="orgb870d88">Interrupts</h3>
<div class="outline-text-3" id="text-orgb870d88">
<p>
An interrupt is a jump performed automatically by the machine in
response to an event, not by executing a jump instruction.  Interrupts
are used for error detection and recovery, input/output, concurrency,
memory protection, and virtual memory.  Most of these features are
implemented by an operating system kernel.
</p>

<p>
There are two kinds of event that can trigger an interrupt:
</p>

<ul class="org-ul">
<li>An error that occurs while executing an instruction.  For example,
an arithmetic instruction could produce a result that is too large
to represent in a word (this is called overflow).  Sometimes this is
called an <i>exception</i>, and sometimes it is called an interrupt.</li>
<li>An external event that has nothing to do with the running program,
but which needs to be handled.  For example, an I/O device may
request an interrupt when it has completed an I/O operation.  This
is always called an interrupt.</li>
</ul>

<p>
There are several types of interrupt.  Each type has a unique index.
The interrupt indices serve two purposes: they determine the interrupt
priority, and they give the bit index for the interrupt type in the
mask and request registers.  The following table shows each type of
interrupt and the bit index of its flag.
</p>

<p>
Table: Interrupt Indices
</p>


<div style="overflow-x: auto">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">Index</th>
<th scope="col" class="org-left">Symbol</th>
<th scope="col" class="org-left">Meaning</th>
<th scope="col" class="org-right">Hex</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">0</td>
<td class="org-left">time</td>
<td class="org-left">timer interrupt</td>
<td class="org-right">0001</td>
</tr>

<tr>
<td class="org-right">1</td>
<td class="org-left">sf</td>
<td class="org-left">segmentation fault</td>
<td class="org-right">0002</td>
</tr>

<tr>
<td class="org-right">2</td>
<td class="org-left">sto</td>
<td class="org-left">stack overflow</td>
<td class="org-right">0004</td>
</tr>

<tr>
<td class="org-right">3</td>
<td class="org-left">stu</td>
<td class="org-left">stack underflow</td>
<td class="org-right">0008</td>
</tr>

<tr>
<td class="org-right">4</td>
<td class="org-left">trap</td>
<td class="org-left">user trap</td>
<td class="org-right">0010</td>
</tr>

<tr>
<td class="org-right">5</td>
<td class="org-left">tco</td>
<td class="org-left">integer overflow</td>
<td class="org-right">0020</td>
</tr>

<tr>
<td class="org-right">6</td>
<td class="org-left">bo</td>
<td class="org-left">natural overflow</td>
<td class="org-right">0040</td>
</tr>

<tr>
<td class="org-right">7</td>
<td class="org-left">zdiv</td>
<td class="org-left">divide by 0</td>
<td class="org-right">0080</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-right">&#xa0;</td>
</tr>
</tbody>
</table>
</div>

<p>
Each type of interrupt has a priority which is determined by its
index: a lower index indicates higher priority.  Thus the timer
interrupt has the highest priority, and a stack overflow has higher
priority than integer overflow.
</p>

<p>
Interrupts take place only between execution of instructions.  When
one instruction has finished, the processor checks for interrupts
before going on to the next instruction.  This consists of the
following steps:
</p>

<ol class="org-ol">
<li>If interrupts are not enabled, the check terminates and the next
instruction is executed normally.</li>
<li>If interrupts are enabled, and there is an interrupt request, and
the corresponding mask bit is enabled, an interrupt will take
place.  If several types of interrupt meet these conditions, the
one with highest priority (lowest index) is selected.  Let i be the
index of the type of interrupt that was selected.</li>
<li>The processor clears the request bit for the interrupt in the
request register, it copies the status register into rstat, and it
copies the pc register into the rpc register.  Also, it loads
mem[vect+2*i] into the pc register, and it and sets flags in the
status register to indicate system state and interrupts disabled.</li>
<li>If the timer is running, it is stopped.</li>
<li>Now the interrupt has completed, and the next instruction is
executed normally.  Since the pc has been modified, the machine has
jumped to a different location.</li>
</ol>

<p>
This algorithm is performed entirely by the processor; none of it
involves software.  Although it is described as a sequence of steps,
many of these steps can be performed in parallel, because digital
circuits are inherently parallel.  If an interrupt does not take
place, the time required for the check is minimal (less than one clock
cycle), so checking for interrupts does not signicantly slow down the
processor speed.
</p>
</div>

<div id="outline-container-orgcf9c22e" class="outline-4">
<h4 id="orgcf9c22e">mask - interrupt mask register</h4>
<div class="outline-text-4" id="text-orgcf9c22e">
<p>
The mask register specifies which types of interrupt are allowed to
occur.  It contains a flag for each type of interrupt; if the flag is
1 then the corresponding type of interrupt can take place.  If the
mask flag is 0, then that type of interrupt will not occur even if it
is requested.
</p>
</div>
</div>

<div id="outline-container-org4ef2736" class="outline-4">
<h4 id="org4ef2736">request - interrupt request register</h4>
<div class="outline-text-4" id="text-org4ef2736">
<p>
When an interrupt is requested, the corresponding bit is set in the
request register.  When the next instruction is executed, the
interrupt occurs if interrupts are enabled and the corresponding mask
bit is 1.
</p>
</div>
</div>

<div id="outline-container-org599b549" class="outline-4">
<h4 id="org599b549">rstat register</h4>
<div class="outline-text-4" id="text-org599b549">
<p>
When an interrupt occurs, the value of the status register is copied
into rstat.
</p>
</div>
</div>

<div id="outline-container-org0595c7d" class="outline-4">
<h4 id="org0595c7d">rpc register</h4>
<div class="outline-text-4" id="text-org0595c7d">
<p>
When an interrupt occurs, the value of pc is copied into rpc.  This is
necessary to enable the operating system to resume the interrupted
program.
</p>
</div>
</div>

<div id="outline-container-org9501088" class="outline-4">
<h4 id="org9501088">vect register</h4>
<div class="outline-text-4" id="text-org9501088">
<p>
The interrupt vector register contains the address of a jump table.
This is an array of jumps to interrupt handlers.
</p>
</div>
</div>
</div>

<div id="outline-container-orgb8e51f8" class="outline-3">
<h3 id="orgb8e51f8">Memory management registers</h3>
<div class="outline-text-3" id="text-orgb8e51f8">
<p>
(Will be implemented in future version)
</p>
</div>
</div>
</div>

<div id="outline-container-sec-instruction-set" class="outline-2">
<h2 id="sec-instruction-set">Instruction set</h2>
<div class="outline-text-2" id="text-sec-instruction-set">
</div>

<div id="outline-container-org8cc6679" class="outline-3">
<h3 id="org8cc6679">Instruction representation</h3>
<div class="outline-text-3" id="text-org8cc6679">
<p>
Instructions are represented in the memory of the computer using
words, just like all other kinds of data.  From the programmer's
perspective, an instruction is like a simple statement in a
programming language.  From the circuit designer's perspective,
instructions must be executed using logic gates, and the specific way
it is represented as a word of bits is important.
</p>

<p>
An instruction specifies several pieces of information.  For example,
add R1,R2,R3 is an instruction that says four things: it's an
addition, the operands come from R2 and R3, and the result goes into
R1.  Therefore to represent an instruction we need to organize a word
as a collection of several <b>fields</b>.  A field is a portion of a word
that contains a small number (for example, a register number). Each
field gives one specific piece of information about the instruction.
</p>

<p>
The particular scheme for describing an instruction as a collection of
fields is called an <b>instruction format</b>.  Like most computers,
Sigma16 has a small number of instruction formats and a larger number of
instructions.  The key to understanding the interface between machine
language and digital circuit design is to master the instruction
formats.
</p>

<p>
The core architecture (the simplest part of the system) uses just two
instruction formats: the <b>RRR format</b> for instructions that perform
calculations in the registers, and the <b>RX format</b> for instructions
that refer to a memory location.
</p>

<p>
The advanced parts of the architecture provide additional
instructions, most of which are represented with the <b>EXP format</b>. The
name EXP stands simultaneously for <b>expansion</b> (because it provides
for many additional instructions) and <b>experimental</b> (because it
allows for experimentation with the design and implementation of new
instructions).
</p>

<p>
The first word of every instruction (for all instruction formats)
contains the following fields:
</p>

<ul class="org-ul">
<li>op (bits 15-12) 4-bit opcode, determines instruction format</li>
<li>d  (bits 11-8)  4-bit destination</li>
<li>a  (bits 7-4)   4-bit operand a</li>
<li>b  (bits 3-0)   4-bit operand b, or expanded opcode for RX</li>
</ul>


<!-- This HTML table template is generated by emacs 29.4 -->
<table border="1">
  <tr>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;op&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;d&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;a&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;b&nbsp;
    </td>
  </tr>
  <tr>
    <td align="left" valign="top">
      &nbsp;15-12&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;11-8&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;7-4&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;3-0&nbsp;
    </td>
  </tr>
</table>

<p>
If an instruction is RX or EXP format, it has a second word that
contains four 4-bit fields.  The meanings of the fields depend on the
particular instruction.
</p>

<ul class="org-ul">
<li>e  (bits 15-12) 4-bit operand</li>
<li>f  (bits 11-8)  4-bit operand</li>
<li>g  (bits 7-4)   4-bit operand</li>
<li>h  (bits 3-0)   4-bit operand</li>
</ul>



<!-- This HTML table template is generated by emacs 29.4 -->
<table border="1">
  <tr>
    <td align="left" valign="top">
      &nbsp;disp&nbsp;
    </td>
  </tr>
  <tr>
    <td align="left" valign="top">
      &nbsp;15-0&nbsp;
    </td>
  </tr>
</table>

<!-- This HTML table template is generated by emacs 29.4 -->
<table border="1">
  <tr>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;f&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;g&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;h&nbsp;
    </td>
  </tr>
  <tr>
    <td align="left" valign="top">
      &nbsp;15-12&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;11-8&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;7-4&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;3-0&nbsp;
    </td>
  </tr>
</table>

<p>
The first word of every instruction has a 4-bit field called the
operation code.  This is usually abbreviated to opcode (or just op).
Since the opcode contains 4 bits, it can specify 16 values:
</p>

<ul class="org-ul">
<li>If the opcode is between 0 and 12 (hex 0 to hex c), the instruction
is RRR format, and there are 14 RRR instructions.</li>
<li>An opcode value of 13 is reserved for future expansion of the
architecture.</li>
<li>If the op field is 14 (hex e) the instruction is EXP format and has
a secondary opcode in the a and b fields.</li>
<li>If the op field contains 15 (hex f) the instruction is RX format
with a secondary opcode in the b field.</li>
</ul>

<p>
The details of each format and its fields are given below, and the
following table gives an overview.
</p>
<ul class="org-ul">
<li>Each instruction format has a fixed size, which is the number of
words used to represent any instruction of that format.</li>
<li>These words are subdivided into 4-bit fields, each with a unique
name: op, d, a, b, etc.</li>
<li>The type of instruction is specified by the opcode, which is the op
field for RRR instructions, and which consists of several fields for
the other formats.</li>
<li>The instruction operands are specified by further fields.</li>
<li>Some instructions combine two 4-bit fields into a single 8-bit
field.
<ul class="org-ul">
<li>The a and b fields may be combined to form an 8-bit field called ab
(only for the EXP format)</li>
<li>The g and h fields may be combined to form an 8-bit field called gh</li>
</ul></li>
</ul>

<div style="overflow-x: auto">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Format</th>
<th scope="col" class="org-right">Size</th>
<th scope="col" class="org-left">Opcode</th>
<th scope="col" class="org-left">Operands</th>
<th scope="col" class="org-left">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">RRR</td>
<td class="org-right">1</td>
<td class="org-left">op</td>
<td class="org-left">d,a,b</td>
<td class="org-left">add Rd,Ra,Rb</td>
</tr>

<tr>
<td class="org-left">RX</td>
<td class="org-right">2</td>
<td class="org-left">op,b</td>
<td class="org-left">d,a,disp</td>
<td class="org-left">load Rd,disp[Ra]</td>
</tr>

<tr>
<td class="org-left">EXP</td>
<td class="org-right">2</td>
<td class="org-left">op,ab</td>
<td class="org-left">d,e,f,g,h</td>
<td class="org-left">save Rd,Re,gh[Rf]</td>
</tr>
</tbody>
</table>
</div>

<p>
There are three machine instruction formats: RRR, RX, EXP.  However,
there is a larger set of assembly language statement formats, because
there are special syntaxes for some instructions, and there are
assembler directives that aren't instructions at all.  Thus there are
two kinds of format: the machine instruction formats, and the assembly
language instruction statement formats.  The assembly language formats
are described later.
</p>
</div>

<div id="outline-container-orgb029382" class="outline-4">
<h4 id="orgb029382">RRR format</h4>
<div class="outline-text-4" id="text-orgb029382">
<p>
The RRR format is used for instructions that perform calculations in
the registers, without using memory.
</p>

<p>
An instruction in RRR format is one word containing four 4-bit fields
called op, d, a, b.  Each field contains 4 bits representing a binary
number between 0 and 15.
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">op</td>
<td class="org-left">d</td>
<td class="org-left">a</td>
<td class="org-left">b</td>
</tr>
</tbody>
</table>

<ul class="org-ul">
<li>op (bits with index 15 to 12) is the operation code, usually called
<i>opcode</i>.  This determines the operation to be performed.  If the
opcode is between 0 and 12 it specifies an RRR instruction.  An
opcode greater than 12 indicates an <i>expanding opcode</i>: the
instruction is not RRR but one of the other formats, and it has a
secondary opcode that specifies precisely which instruction it is.
This is explained in the sections on RX and EXP formats.</li>
<li>d (bits 11 to 8) is the <i>destination register</i>; the register where
(in most cases) the result will be loaded.</li>
<li>a (bits 7 to 4) is the register containing the first operand.</li>
<li>b (bits 3 to 0) is the register containing the second operand.</li>
</ul>

<p>
In most cases, an RRR instruction takes two operands in registers
specified by the a and b fields and produces a result which is loaded
into the register specified by the d field.
</p>

<p>
A typical example of an RRR instruction is add R4,R13,R2, which adds
the contents of registers R13 and R2, and loads the result into R4.
It's equivalent to R4 := R13 + R2.  The opcode for add is 0, so the
machine language code for this instruction is 04d2.
</p>
</div>
</div>

<div id="outline-container-org4ec8aed" class="outline-4">
<h4 id="org4ec8aed">RX format</h4>
<div class="outline-text-4" id="text-org4ec8aed">
<p>
The RX format is used for instructions that use a memory location.
There are generally two operands: one is a register and the other is a
word in memory.
</p>

<p>
RX instructions specify a memory location as well as a register
operand.  The machine language representation is two words:
</p>

<p>
Here is RX
</p>

<p>
The RX instruction format is used for instructions that use a memory
address, which is specified by an index register and a displacement.
The name of the format describes briefly the two operands: a register
(R) and an indexed memory address (X).
</p>

<p>
An RX instruction contains two operands: one is a memory address, and
the other is a register.  Typical RX instructions are loads, stores,
and jumps.  The instruction consists of two consecutive words.  The
first has the same format as an RRR instruction, with four fields: op,
d, sa, sb.  The second word is a single 16-bit binary number, and is
called the displacement.
</p>

<p>
An RX instruction is represented by two words, with the following
fields: op=15, b contains the secondary opcode which specifies which
RX instruction it is, d is the destination, a is the index register,
and the second word is a 16 bit constant called the displacement
(often written disp for short).
</p>

<ul class="org-ul">
<li>op field (bits 0-3 of ir) is f for all RX instructions</li>
<li>d field (bits 4-7 of ir) has several uses</li>
<li>a field (bits 8-11 of ir) is index register for effective address</li>
<li>b field (bits 12-15 of ir) is secondary opcode</li>
<li>disp (displacement) is the second word of the instruction</li>
<li>ea (effective address) = displacement + r[a]</li>
</ul>

<p>
The memory address is specified in two parts: an index register and
the displacement.  The index register is specified in the sa field.
In assembly language, the notation used is number[reg], where the
number is the value of the displacement, and the reg is the index
register.  Thus $20b3[R2] means the address has displacement $20b3 and
the index register is R2.
</p>

<p>
When the machine executes an RX instruction, it begins by calculating
the effective address.  This is abbreviated "ea", and its value is the
sum of the displacement and the contents of the index register.
</p>

<p>
RX instructions are represented in two words, and they use an
"expanding opcode".  That is, the op field of the first word of the
instruction contains the constant f (the bits 1111) for every RX
instruction, and the sb field is used to hold a secondary opcode
indicating which RX instruction it is.
</p>

<p>
The register operand is specified in the d field.  For several RX
instructions, this is indeed the destination of the instruction: for
example, load places data into Rd.  However, a few RX instructions use
the d field differently (see, for example, the conditional jump
instructions).
</p>

<p>
The memory address is specified using the sa field and the
displacement, which is the entire second word of the instruction.
</p>

<p>
The RX format is used for instructions that access the memory.  There
are two operands: a memory address and a register.  The memory address
is specified using two fields: a constant (called the displacement)
and a register (called the index register).
</p>

<p>
An RX instruction consists of two words.  The first has the same
format as RRR.  The op field is 15, which means "this instruction has
RX format".  A secondary operation code is needed to specify which RX
instruction this is, this is given in the b field.  The d field is the
destination register, and the a field is the index register.  There is
only one operand register for RX instructions, since the b field is
needed for the secondary operation code.
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">op</td>
<td class="org-left">d</td>
<td class="org-left">a</td>
<td class="org-left">b</td>
</tr>
</tbody>
</table>

<p>
The second word consists of one 16-bit field called the displacement
(abbreviated as disp).
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">displacement</td>
</tr>
</tbody>
</table>

<p>
The index register Rb and the displacement together specify the
<i>effective address</i>.  The assembly language syntax for the effective
address is <code>disp[Rb]</code>, and its value is \(\mathrm{disp} + \mathrm{Rb}\).
For example, suppose R4 contains 7 when the following instruction is
executed:
</p>

<div class="CodeListing" id="org1c71bbe"><pre>
load  R2,5[R4]
</pre></div>

<p>
The address operand is <code>5[R4]</code>, where the displacement is 5 and the
index is R4.  When the instruction executes, the effective address is
\(5 + \mathrm{R4} = 5 + 7 = 12\), or <code>$000c</code>.
</p>

<p>
The displacement is a constant given in the instruction, but the index
register is variable.  Since R0 always contains 0, the effective
address for <code>disp[R0]</code> is the value of <code>disp</code>.
</p>

<p>
The displacement is represented in binary, and the effective address
is calculated in binary, not in two's complement.  Thus the effective
address of <code>ffff[R0]</code> is the (positive) address of the last word in
memory &#x2013; it isn't a negative number.
</p>
</div>
</div>

<div id="outline-container-org1ef15d2" class="outline-4">
<h4 id="org1ef15d2">EXP format</h4>
<div class="outline-text-4" id="text-org1ef15d2">
<p>
The EXP instructions provide more complex operations, and they belong
to the Standard architecture.  (The Core architecture uses only RRR
and RX).  An EXP instruction consists of two words.
</p>

<p>
The first word has the same op and d fields as RRR and RX.  The op
field contains 14 (hex e), which indicates that the instruction is EXP
format.  The a and b fields are treated as one 8-bit natural number,
which is the secondary operation code.  This provides for the
possibility of up to 256 EXP format instructions, which enables new
experimental instructions to be defined.
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">op</td>
<td class="org-left">d</td>
<td class="org-left">ab</td>
</tr>
</tbody>
</table>

<p>
The second word contains for 4-bit fields.  Each of these may contain
either a register number or a short 4-bit number, depending on the
instruction.
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">e</td>
<td class="org-left">f</td>
<td class="org-left">g</td>
<td class="org-left">h</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-org37ad479" class="outline-4">
<h4 id="org37ad479">Notation for machine language</h4>
<div class="outline-text-4" id="text-org37ad479">
<p>
We usually write instructions in assembly language (sub R3,R12,R9) but
the computer executes machine language (13c9).  There is a precise
relationship between these two notations for an instruction.  By
writing assembly language, you determine the exact value of every bit
in every word of a machine language program.  This section explains
how these two notations for an instruction are related.
</p>

<p>
When each instruction is described below, an example is given showing
a typical use of the instruction, along with the general form of the
assembly language instruction.
</p>

<p>
The general form uses the machine language field names to show where
each piece of the instruction goes in the machine code.  The
instruction format is also given, along with any constant fields.
</p>

<p>
As an example, the logicu instruction is EXP format, so its machine
language representation consists of two words with the following
fields:
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">op</th>
<th scope="col" class="org-left">d</th>
<th scope="col" class="org-left">a</th>
<th scope="col" class="org-left">b</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">e</td>
<td class="org-left">f</td>
<td class="org-left">g</td>
<td class="org-left">h</td>
</tr>
</tbody>
</table>

<p>
The primary opcode is e, which goes in the op field.  The secondary
opcode is 14, which goes in the ab field.  Thus op=e, a=1, and b=4
(here, a dollar sign is used before the hex constants to distinguish
them from the field names).
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">$e</th>
<th scope="col" class="org-left">d</th>
<th scope="col" class="org-left">$1</th>
<th scope="col" class="org-left">$4</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">e</td>
<td class="org-left">f</td>
<td class="org-left">g</td>
<td class="org-left">h</td>
</tr>
</tbody>
</table>


<p>
and the 
For example, here is the general form of the logicu instruction:
</p>

<div class="CodeListing" id="org8415ca6"><pre>
logicu  Rd,e,Rf,g,h     ; Rd.e := h (Rd.e, Rf.g)
EXP op=#e ab=$14
</pre></div>


<div class="CodeListing" id="org7fc48e5"><pre>
logicu  Rd,e,Rf,g,h     ; Rd.e := h (Rd.e, Rf.g)
EXP op=#e ab=$14
</pre></div>

<p>
The format is EXP, so the instruction has all the fields of the EXP
format: op, d, ab, e, f, g, h.  There are two constant fields: the
primary opcode (op) is <code>$e</code>, and the secondary opcode (ab) is <code>$14</code>.
The values of the other fields are given in the general form of the
assembly language.  The operands Rd and Rf refer to registers, and
those register numbers go into the d and f fields of the instruction.
The e, g, and h fields are given as numbers in the assembly language.
(The assembly language convention is to give constants in decimal
notation, not hexadecimal.)
</p>

<p>
Example:
</p>
<div class="CodeListing" id="org9e1d686"><pre>
logicu  R7,5,R2,13,xor ; R7.5 := R7.5 xor R2.13
e714 52d6
</pre></div>
</div>
</div>
</div>


<div id="outline-container-org43f2f57" class="outline-3">
<h3 id="org43f2f57">Arithmetic</h3>
<div class="outline-text-3" id="text-org43f2f57">
</div>
<div id="outline-container-org56ae76f" class="outline-4">
<h4 id="org56ae76f">add</h4>
<div class="outline-text-4" id="text-org56ae76f">
<p>
The instruction <code>add Rd,Ra,Rb</code> has operands <code>Ra</code> and <code>Rb</code> and
destination <code>Rd</code>.  It fetches the operands <code>Ra</code> and <code>Rb</code>, calculates
the sum <code>Ra</code> + <code>Rb</code>, and loads the result into the destination <code>Rd</code>.
The effect is <code>Rd := Ra + Rb</code>.  For example, <code>add R5,R12,R2</code>
performs <code>R5 := R12 + R3</code>.
</p>

<p>
As well as setting the destination register, the add instruction sets
or clears the overflow and carry bits in the condition code (which is
R15).  The other bits in R15 are not changed.
</p>

<p>
If the destination register is R15, the sum is placed in R15, and the
overflow and carry flags are discarded.
</p>

<p>
The add instruction is RRR format with opcode=0.  Given destination Rd
and operands Ra and Rb (where d, a, b are hex digits), add Rd,Ra,Rb is
reprseented by 0dab.
</p>

<div style="overflow-x: auto">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">assembly language</td>
<td class="org-left">add Rd,Ra,Rb</td>
</tr>

<tr>
<td class="org-left">instruction format</td>
<td class="org-left">RRR</td>
</tr>

<tr>
<td class="org-left">opcode</td>
<td class="org-left">0</td>
</tr>

<tr>
<td class="org-left">machine language</td>
<td class="org-left">$0 d a b</td>
</tr>

<tr>
<td class="org-left">effect</td>
<td class="org-left">R[d] := R[a] + R[b]</td>
</tr>

<tr>
<td class="org-left">condition code</td>
<td class="org-left">vVC</td>
</tr>
</tbody>
</table>
</div>

<p>
Examples:
</p>

<div style="overflow-x: auto">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Code</th>
<th scope="col" class="org-left">Assembly</th>
<th scope="col" class="org-left">Effect</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">062c</td>
<td class="org-left">add R6,R2,R12</td>
<td class="org-left">; R6 := R2 + R12</td>
</tr>

<tr>
<td class="org-left">0d13</td>
<td class="org-left">add R13,R1,R3</td>
<td class="org-left">; R13 := R1 + R3</td>
</tr>
</tbody>
</table>
</div>


<p>
A field is a consecutiave sequence of bits within a word.  A field is
specified with the index of the leftmost bit in the field, along with
the size of the field.  For example, the field in x with index 9 and
size 3 consists of the bits x.9 x.8 x.7.
</p>

<div class="CodeListing" id="org88ff7b9"><pre>
add R1,R2,R3    ; R1 := R2 + R3
</pre></div>

<p>
The instruction add Rd,Ra,Rb has operands Ra and Rb and destination
Rd.  It fetches the operands Ra and Rb, calculates the sum Ra + Rb,
and loads the result into the destination Rd.  The effect is Rd :=
Ra + Rb.  For example, add R5,R12,R2 performs R5 := R12 + R3.
</p>

<p>
The add instruction is RRR format with opcode=0.  Given destination Rd
and operands Ra and Rb (where d, a, b are hex digits), add Rd,Ra,Rb is
reprseented by 0dab.
</p>


<p>
The add instruction can be used for both binary addition (on natural
numbers) and for two's complement addition (on signed integers).
</p>

<ul class="org-ul">
<li>16-bit natural numbers are unsigned integers 0, 1, 2, &#x2026;, 65535.
If two natural numbers are added, the result is a natural number
(the result cannot be negative).  If the result is 65536 or larger,
it cannot be represented as a 16 bit binary number.  If this
happens, the destination register is set to the lower 16 bits of the
true result, and the binary overflow flag is set in the Condition Code.</li>

<li>16-bit two's complement numbers are signed integers -32999?, &#x2026;,
-1, 0, 1, &#x2026;, 32???.  If two signed integers are added, the result
is a signed integer.  If the result is less than -32000 or greater
than 32000, then the result cannot be represented as a 16 bit two's
complement number.  If this happens, the destination register is set
to the lower 16 bits of the true result, and the two's complement
overflow flag is set in the Condition Code.  Furthermore, the
overflow flag is set in the req register.  If interrupts are enabled
and the overflow flag is 1 in the mask register, then an interrupt
will occur immediatelhy after the add instruction executes.</li>
</ul>

<p>
The add instruction can be used for both binary addition (on natural
numbers) and for two's complement addition (on signed integers).
</p>

<ul class="org-ul">
<li>16-bit natural numbers are unsigned integers 0, 1, 2, &#x2026;, 65535.
If two natural numbers are added, the result is a natural number
(the result cannot be negative).  If the result is 65536 or larger,
it cannot be represented as a 16 bit binary number.  If this
happens, the destination register is set to the lower 16 bits of the
true result, and the binary overflow flag is set in the Condition Code.</li>

<li>16-bit two's complement numbers are signed integers -32999?, &#x2026;,
-1, 0, 1, &#x2026;, 32???.  If two signed integers are added, the result
is a signed integer.  If the result is less than -32000 or greater
than 32000, then the result cannot be represented as a 16 bit two's
complement number.  If this happens, the destination register is set
to the lower 16 bits of the true result, and the two's complement
overflow flag is set in the Condition Code.  Furthermore, the
overflow flag is set in the req register.  If interrupts are enabled
and the overflow flag is 1 in the mask register, then an interrupt
will occur immediatelhy after the add instruction executes.</li>
</ul>
</div>
</div>

<div id="outline-container-org6408d23" class="outline-4">
<h4 id="org6408d23">sub</h4>
<div class="outline-text-4" id="text-org6408d23">
<p>
Example: sub R1,R2,R3 ; R1 := R2 - R3
</p>

<p>
This instruction is similar to add; the only difference is that it
calculates R2-R3 and places the result in R1.  The effect on the
condition code is the same as for add.
</p>


<div style="overflow-x: auto">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">assembly language</td>
<td class="org-left">sub Rd,Ra,Rb</td>
</tr>

<tr>
<td class="org-left">instruction format</td>
<td class="org-left">RRR</td>
</tr>

<tr>
<td class="org-left">opcode</td>
<td class="org-left">1</td>
</tr>

<tr>
<td class="org-left">machine language</td>
<td class="org-left">$1 d a b</td>
</tr>

<tr>
<td class="org-left">effect</td>
<td class="org-left">R[d] := R[a] - R[b]</td>
</tr>
</tbody>
</table>
</div>

<p>
The instruction sub Rd,Ra,Rb has operands Ra and Rb and destination
Rd.  It fetches the operands Ra and Rb, calculates the difference Ra -
Rb, and loads the result into the destination Rd.  The effect is Rd :=
Ra - Rb.  For example, sub R5,R12,R2 performs R5 := R12 - R3.
</p>

<p>
The sub instruction is RRR format with opcode=1.
</p>


<div style="overflow-x: auto">
<p>
Code    Assembly          Effect
&#x2013;&#x2014;   -----------&#x2013;&#x2014;  -------------&#x2013;&#x2014;
162c    sub R6,R2,R12     ; R6 := R2 - R12
1d13    sub R13,R1,R3     ; R13 := R1 - R3
</p>
</div>

<p>
In addition to setting the destination register, the sub instruction
sets several bits in the condition code R15 and may set a bit in the
req register.
</p>

<div style="overflow-x: auto">
<p>
----&#x2013;&#x2014;  ----------------&#x2013;&#x2014;
 R15.ccG    result &gt; 0 (binary)
 R15.ccg    result &gt; 0 (two's complement)
 R15.ccE    result = 0
 R15.ccl    result &lt; 0 (two's complement)
 R15.ccV    overflow (binary)
 R15.CCv    overflow (two's complement)
 R15.CCc    carry output
 R15.ccf    logicc instruction function result
----&#x2013;&#x2014;  ----------------&#x2013;&#x2014;
</p>
</div>
</div>
</div>

<div id="outline-container-org3ed7f86" class="outline-4">
<h4 id="org3ed7f86">mul</h4>
<div class="outline-text-4" id="text-org3ed7f86">
<p>
Example: mul R1,R2,R3 ; R1 := R2 * R3
</p>

<p>
The multiply instruction mul Rd,Ra,Rb calculates the integer (two's
complement) product of the operands Ra and Rb, and places the result
in the destination register Rd.  The mul instruction does not produce
the natural (binary) product.
</p>


<div style="overflow-x: auto">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">assembly language</td>
<td class="org-left">mul Rd,Ra,Rb</td>
</tr>

<tr>
<td class="org-left">instruction format</td>
<td class="org-left">RRR</td>
</tr>

<tr>
<td class="org-left">machine language</td>
<td class="org-left">[$2 d a b]</td>
</tr>

<tr>
<td class="org-left">effect</td>
<td class="org-left">reg[d] := reg[a] * reg[b]</td>
</tr>
</tbody>
</table>
</div>

<p>
If the magnitude of the product is too large to be representable as a
16 bit two's complement integer, this is an overflow.  If overflow
occurs, the integer overflow bit is set in the condition code (F15)
and the integer overflow bit is also set in the interrupt request
register (req), and the lower order 16 bits of the product are loaded
into Rd.
</p>

<div style="overflow-x: auto">
<p>
----&#x2013;&#x2014;  ----------------&#x2013;&#x2014;
 R15.ccg    result &gt; 0 (two's complement)
 R15.ccE    result = 0
 R15.ccl    result &lt; 0 (two's complement)
 R15.CCv    overflow (two's complement)
 R15.CCc    carry output
----&#x2013;&#x2014;  ----------------&#x2013;&#x2014;
</p>
</div>
</div>
</div>

<div id="outline-container-orgf877e89" class="outline-4">
<h4 id="orgf877e89">div</h4>
<div class="outline-text-4" id="text-orgf877e89">
<p>
Example: div R1,R2,R3 ; R1 := R2 / R3, R15 := R2 rem R3
</p>

<p>
Unlike the other arithmetic operations, the divide instruction div
Rd,Ra,Rb produces two results: the quotient Ra / Rb and the remainder
Ra rem Rb.  It loads the quotient into the destination register Rd,
and the remainder is loaded into R15.
</p>


<div style="overflow-x: auto">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">assembly language</td>
<td class="org-left">div Rd,Ra,Rb</td>
</tr>

<tr>
<td class="org-left">instruction format</td>
<td class="org-left">RRR</td>
</tr>

<tr>
<td class="org-left">opcode</td>
<td class="org-left">3</td>
</tr>

<tr>
<td class="org-left">machine language</td>
<td class="org-left">$3 d a b</td>
</tr>

<tr>
<td class="org-left">effect</td>
<td class="org-left">reg[d] := reg[a] / reg[b],</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">reg[15] := reg[a] rem reg[b]</td>
</tr>
</tbody>
</table>
</div>

<p>
If the destination register Rd is R15, then the quotient is placed in
R15, and the remainder is discarded.
</p>

<p>
The divide instruction doesn't set the condition code, since R15 is
used for the remainder.  Therefore there is no condition code bit to
indicate division by 0.  However, it is easy for a program to detect a
division by 0.
</p>

<ul class="org-ul">
<li>(Explicit test for error) The program can compare the divisor with 0
before or after executing the divide instruction, and jump to an
error handler if the divisor is 0.  This is similar to testing the
condition code after an add, sub, or mul instruction, but it does
require two instructions: a compare followed by a conditional jump.
For example:</li>
</ul>

<div class="CodeListing" id="org2655941"><pre>
div    R1,R2,R3       ; R1 := R2/R3, R15 := R2 rem R3
cmp    R3,R0       ; Did we divide by 0?
jumpeq zeroDivide[R0] ; If yes, handle error
</pre></div>

<ul class="org-ul">
<li>(Exception) The program can detect division by 0 using an interrupt.
To do this, enable interrupts and enable the interrupt mask for
division by 0.  See the section on Interrupts.  This approach does
not require a compare or jump instruction for each division.</li>
</ul>
</div>
</div>

<div id="outline-container-org3a65fbb" class="outline-4">
<h4 id="org3a65fbb">cmp</h4>
<div class="outline-text-4" id="text-org3a65fbb">
<p>
The compare instruction <code>cmp Ra,Rb</code> compares the values in the operand
registers <code>Ra</code> and <code>Rb</code>, and then sets flags in the condition code
(R15) to indicate the result. The notation R15.i means bit <i>i</i> in R15;
thus R15.0 is the leftmost bit of R15.  The instruction performs both
natural number comparison (binary) and integer comparison (two's
complement).  The resulting flags are
</p>

<ul class="org-ul">
<li>binary less than (L) in R15.0</li>
<li>two's complement less than (&lt;) in R15.1</li>
<li>equal in R15.2</li>
<li>binary greater than (G) in R15.3</li>
<li>two's complement greater than (&gt;) in R15.4</li>
</ul>


<div style="overflow-x: auto">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">assembly language</td>
<td class="org-left">cmp Rd,Ra,Rb</td>
</tr>

<tr>
<td class="org-left">instruction format</td>
<td class="org-left">RRR</td>
</tr>

<tr>
<td class="org-left">opcode</td>
<td class="org-left">4</td>
</tr>

<tr>
<td class="org-left">machine language</td>
<td class="org-left">$4 d a b</td>
</tr>

<tr>
<td class="org-left">effect</td>
<td class="org-left">reg[d] := reg[a] / reg[b]</td>
</tr>
</tbody>
</table>
</div>

<p>
The result of a cmp instruction can be used to control a conditional
jump.  The jumpc0 instruction jumps is a specified bit of R15 is 0,
and the jumpc1 instruction jumps if a specified bit is 1.
</p>

<p>
Pseudoinstructions provide the most common cases; for example jumple
jumps if the condition code indicates that a comparison produced
either integer less-than or equal.  A common pattern is a cmp followed
by a jump pseudoinstruction, for example:
</p>

<div class="CodeListing" id="org3afef65"><pre>
cmp     R4,R9      ; compare R4 with R9
jumpgt  abc]R0]    ; if R4 &gt; R9 then goto abc
</pre></div>
</div>
</div>
<div id="outline-container-orgb9b9a28" class="outline-4">
<h4 id="orgb9b9a28">addc</h4>
<div class="outline-text-4" id="text-orgb9b9a28">
<p>
The addc instruction performs a binary addition with carry
propagation.  It adds the two operand registers and the carry bit in
the condition code register, R15.  The sum is loaded into the
destination register Rd and the carry output is written back into the
carry bit, overwriting its previous value.  Overflow is not possible
with this instruction.
</p>
</div>
</div>

<div id="outline-container-orgcdac4c0" class="outline-4">
<h4 id="orgcdac4c0">muln</h4>
<div class="outline-text-4" id="text-orgcdac4c0">
<div class="CodeListing" id="orga37a87b"><pre>
muln   Rd,Ra,Rb
</pre></div>

<p>
The muln instruction calculates the product of two natural numbers in
Ra and Rb.  The result is 32 bits; the leftmost 16 bits (the most
significant part) is loaded into R15, and the rightmost 16 bits (the
least significant part) is loaded into Rd.  If Rd is R15, the most
significant part is discarded.
</p>


<div style="overflow-x: auto">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">instruction format</td>
<td class="org-left">RRR</td>
</tr>

<tr>
<td class="org-left">machine language</td>
<td class="org-left">[$4 d a b]</td>
</tr>

<tr>
<td class="org-left">effect</td>
<td class="org-left">reg[d] := reg[a] / reg[b]</td>
</tr>

<tr>
<td class="org-left">assembly language</td>
<td class="org-left">cmp Rd,Ra,Rb</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>

<div id="outline-container-org310aa93" class="outline-4">
<h4 id="org310aa93">divn</h4>
<div class="outline-text-4" id="text-org310aa93">
<div class="CodeListing" id="org0d38ad0"><pre>
divn   Rd,Ra,Rb
</pre></div>

<p>
The divn instruction divides two natural numbers: dividend / divisor.
All the numbers &#x2013; numerator, denominator, quotient, remainder &#x2013; are
natural numbers represented in binary.
</p>

<div style="overflow-x: auto">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">instruction format</td>
<td class="org-left">RRR</td>
</tr>

<tr>
<td class="org-left">machine language</td>
<td class="org-left">[$4 d a b]</td>
</tr>

<tr>
<td class="org-left">effect</td>
<td class="org-left">reg[d] := reg[a] / reg[b]</td>
</tr>

<tr>
<td class="org-left">assembly language</td>
<td class="org-left">divn Rd,Ra,Rb</td>
</tr>
</tbody>
</table>
</div>

<ul class="org-ul">
<li>The dividend is a 32 bit natural number; its leftmost 16 bits are in
R15 and the rightmost 16 bits are in Ra.  Thedenominator is in Rb.</li>
<li>Two results are produced: a 32-bit quotient anda 16-bit remainder.</li>
<li>The leftmost 16 bits of the quotient are placedin R15 (replacing the
leftmost part of the dividend).  The rightmost16 bits of the
quotient are placed in Rd.</li>
<li>The remainder is placed in Ra, overwriting the least significant
half of the dividend operand</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-orgc8e6d9f" class="outline-3">
<h3 id="orgc8e6d9f">Accessing memory</h3>
<div class="outline-text-3" id="text-orgc8e6d9f">
<p>
A memory address is a 16-bit binary number.  Instructions don't
specify addresses directly; they specify an address with two
components: a <b>displacement</b> and an <b>index</b>, written as
"displacement[index]".  The displacement is a 16 bit constant, and in
assembly language it may be given as a decimal integer, a hexadecimal
word, or a label.  The index is a register.  For example,$0c45[R5] has a
displacement of 0c45 and an index of R5.
</p>

<p>
When an instruction executes, the machine takes the displacement and
index and calculates the <b>effective address</b>.  This is defined to be
the binary sum of the displacement and the curent value in the index
register.  In the example above, if R5 contains 3, then the effective
address of $0c45[R5] is $0c48.
</p>

<p>
If you just want to specify an address <b>a</b> in an instruction, this can
be written as "a[R0]".  Since R0 contains the constant 0, the
effective address is just <b>a</b>.
</p>
</div>

<div id="outline-container-orgfac14a3" class="outline-4">
<h4 id="orgfac14a3">lea</h4>
<div class="outline-text-4" id="text-orgfac14a3">
<p>
The <b>load effective address</b> instruction <b>lea Rd,disp[Ra]</b> calculates
the effective address of the operand disp[Ra] and places the result in
the destination register Rd.  The effective address is the binary sum
disp+Ra.
</p>

<div style="overflow-x: auto">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">assembly language</td>
<td class="org-left">lea Rd,disp[Ra]</td>
</tr>

<tr>
<td class="org-left">opcode</td>
<td class="org-left">f, 0</td>
</tr>

<tr>
<td class="org-left">instruction format</td>
<td class="org-left">RX</td>
</tr>

<tr>
<td class="org-left">machine language</td>
<td class="org-left">$f d a $0, disp</td>
</tr>

<tr>
<td class="org-left">effect</td>
<td class="org-left">reg[d] := disp+reg[a]</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>

<div id="outline-container-orgdc2d938" class="outline-4">
<h4 id="orgdc2d938">load</h4>
<div class="outline-text-4" id="text-orgdc2d938">
<p>
The <b>load</b> instruction <b>load Rd,disp[Rx]</b> calculates the effective
address of the operand disp[Rx] and copies the word in memory at the
effective address into the destination register Rd.  The effective
address is the binary sum disp+Rx.
</p>

<div style="overflow-x: auto">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">assembly language</td>
<td class="org-left">load Rd,disp[Ra]</td>
</tr>

<tr>
<td class="org-left">instruction format</td>
<td class="org-left">RX</td>
</tr>

<tr>
<td class="org-left">opcode</td>
<td class="org-left">f, 1</td>
</tr>

<tr>
<td class="org-left">machine language</td>
<td class="org-left">$f d a $1, disp</td>
</tr>

<tr>
<td class="org-left">effect</td>
<td class="org-left">reg[d] := mem[disp+reg[a]]</td>
</tr>
</tbody>
</table>
</div>

<p>
Examples
</p>
<div class="CodeListing" id="org3ad28ae"><pre>
load  R12,count[R0]   ; R12 := count
load  R6,arrayX[R2]   ; R6 := arrayX[R2]
load  R3,$2b8e[R5]    ; R3 := mem[2b8e+R5]
</pre></div>
</div>
</div>

<div id="outline-container-org0157633" class="outline-4">
<h4 id="org0157633">store</h4>
<div class="outline-text-4" id="text-org0157633">
<p>
The <b>store</b> instruction <b>store Rd,disp[Rx]</b> calculates the effective
address of the operand disp[Rx].  The value of the destination
register Rd is stored into memory at the effective address.
</p>

<div style="overflow-x: auto">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">assembly language</td>
<td class="org-left">store Rd,disp[Ra]</td>
</tr>

<tr>
<td class="org-left">instruction format</td>
<td class="org-left">RX</td>
</tr>

<tr>
<td class="org-left">opcode</td>
<td class="org-left">f, 2</td>
</tr>

<tr>
<td class="org-left">machine language</td>
<td class="org-left">$f d a $2, disp</td>
</tr>

<tr>
<td class="org-left">effect</td>
<td class="org-left">mem[disp+reg[a]] := reg[d]</td>
</tr>
</tbody>
</table>
</div>

<p>
Store copies the word in the destination register into memory at the
effective address.  This instruction is unusual in that it treats the
"destination register" as the source of data, and the actual
destination which is modified is the memory location.
</p>

<p>
Most instructions take data from the rightmost operands and modify the
leftmost destination, just like an assignment statement (x := y+z).
However, the store instruction operates in the opposite direction.
The reason for this has to do with the circuit design of the
processor.  Although the "left to right" nature of the store
instruction may look inconsistent from the programmer's point of view,
it actually is more consistent from the deeper perspective of circuit
design.
</p>

<p>
Examples
</p>

<div class="CodeListing" id="org7734ace"><pre>
store  R3,$2b8e[R5]
store  R12,count[R0]
store  R6,arrayX[R2]
</pre></div>
</div>
</div>

<div id="outline-container-orga572717" class="outline-4">
<h4 id="orga572717">Stacks</h4>
<div class="outline-text-4" id="text-orga572717">
<p>
Three instructions (push, pop, top) support operations on a stack
represented as an array of contiguous elements, where the stack grows
from lower to higher addresses.  These instructions provide safe
operations: they never overwrite memory outside the stack, and they
indicate stack underflow and overflow by setting the condition code
and optionaly performing an exception.
</p>

<p>
A stack is represented by three addresses, which are provided to the
push, pop, and top instructions in registers:
</p>
<ul class="org-ul">
<li>The <i>stack base</i> is the address of the first word allocated for the
stack.</li>
<li>The <i>stack limit</i> is the address of the last word allocated for the
stack.</li>
<li>The <i>stack top</i> is the address of the stack element that was pushed
most recently.</li>
</ul>

<p>
Although three addresses are required to characterise the state of a
stack, each individual stack instruction (push, pop, top) requires
only two of those addresses.  These are supplied as the Ra and Rb
operands, while Rd is used to supply or receive the data value.
</p>

<p>
The maximum number of elements the stack may contain is <i>stack
limit</i> - <i>stack base</i> + 1.  Normally, <i>stack limit</i> is greater than
<i>stack base</i>.  If they are equal, there is only one word allocated for
the stack (which is generally not useful), and if <i>stack base</i> &gt;
<i>stack limit</i> then no memory at all is allocated and every stack
operation will signal an underflow or overflow error.
</p>

<p>
If the stack is not empty, then <i>stack top</i> is the address of the top
element in the stack.  If the stack is empty, then <i>stack top</i> must be
<i>stack base</i> - 1.
</p>

<p>
A stack can be created and initialized by allocating a region of
memory, setting <i>stack base</i> to the first word and <i>stack limit</i> to
the last word, and setting <i>stack top</i> to <i>stack base</i> - 1.
</p>
</div>
</div>

<div id="outline-container-org8fa3822" class="outline-4">
<h4 id="org8fa3822">push</h4>
<div class="outline-text-4" id="text-org8fa3822">
<p>
The push instruction pushes an element onto a stack.  It is RRR
format, and its general form is:
</p>

<div class="CodeListing" id="org2182368"><pre>
push   Rd,Ra,Rb
</pre></div>

<ul class="org-ul">
<li>Rd = <i>stack data</i>: value to be pushed, unchanged</li>
<li>Ra = <i>stack top</i>: incremented unless stack was full</li>
<li>Rb = <i>stack limit</i>: unchanged</li>
<li>R15 condition code indicates stack overflow</li>
<li>System interrupt request register indicates stack overflow</li>
</ul>

<p>
This instruction pushes the word in Rd onto a stack with <i>stack top</i>
in Rd and <i>stack limit</i> in Rb, provided that the stack is not full.
The push stores the data word in Ra into memory and increments <i>stack
top</i> Rd.  If the stack is full, nothing is stored into memory and a stack
overflow error is indicated in the condition code and interrupt
request registers; an interrupt will occur if interrupts are enabled
and the stack mask bit is set.  The operational semantics is:
</p>

<div class="CodeListing" id="orga21eb2b"><pre>
if Ra &lt; Rb
  then Ra := Ra + 1; mem[Ra] := Rd
  else R15.sovfl := 1, req.sovfl := 1
</pre></div>

<p>
If Rd = Rb this means the stack completely fills the region of memory
allocated for the stack, and there is no space to store a new element.
In this case, the push instruction does not store Ra, it doesn't
modify Rd, it doesn't modify memory outside the block, and it doesn't
overwrite data in the stack.  Instead, the instruction indicates a
stack overflow by setting the sovfl (stack overflow) bit in the
condition code (R15), and it also sets the stack fault bit in the
interrupt request register.  If interrupts are enabled and the stack
fault bit is set in the interrupt mask register, then an interrupt
will occur after the push instruction completes.  There will be no
interrupt if interrupts are disabled, or the stack fault bit is not
set in the mask register.
</p>
</div>
</div>

<div id="outline-container-org487c92e" class="outline-4">
<h4 id="org487c92e">pop</h4>
<div class="outline-text-4" id="text-org487c92e">
<p>
The push instruction removes an element onto a stack and returns it.
The instruction is RRR format, and its general form is:
</p>

<div class="CodeListing" id="orga2c2612"><pre>
pop    Rd,Ra,Rb
</pre></div>

<ul class="org-ul">
<li>Rd = <i>stack data</i>: destination for the popped stack element</li>
<li>Ra = <i>stack top</i>: decremented unless stack was empty</li>
<li>Rb = <i>stack base</i>: unchanged</li>
<li>R15 condition code indicates stack underflow</li>
<li>System interrupt request register indicates stack underflow</li>
</ul>

<p>
This instruction pops the word from a stack with <i>stack top</i> in Ra and
<i>stack base</i> in Rb, provided that the stack is not empty.  The pop
loads the top element of the stack into Rd and decrements <i>stack top</i>.
If the stack is empty, <i>stack top</i> is not decremented, Rd is not
modified, and a stack underflow error is indicated in the condition
code and interrupt request registers; an interrupt will occur if
interrupts are enabled and the stack mask bit is set.  The operational
semantics is:
</p>

<div class="CodeListing" id="org965346d"><pre>
if Ra &gt;= Rb
  then Rd := mem[Ra]; Ra := Ra - 1
  else R15.suvfl := 1, req.suvfl := 1
</pre></div>
</div>
</div>

<div id="outline-container-org7a5dc2a" class="outline-4">
<h4 id="org7a5dc2a">top</h4>
<div class="outline-text-4" id="text-org7a5dc2a">
<p>
The top instruction returns the top element on a stack but does not
remove it.  The instruction is RRR format, and its general form is:
</p>

<div class="CodeListing" id="orgcadde34"><pre>
top    Rd,Ra,Rb
</pre></div>

<ul class="org-ul">
<li>Rd = <i>stack data</i>: destination for the top element of the stack;
unchanged if stack is empty</li>
<li>Ra = <i>stack top</i>: unchanged</li>
<li>Rb = <i>stack base</i>: unchanged</li>
<li>R15 condition code indicates stack underflow</li>
<li>System interrupt request register indicates stack underflow</li>
</ul>

<p>
This instruction loads the element at <i>stack top</i> into Rd, provided
that the stack is not empty.  If the stack is empty, Rd is not
modified and a stack underflow error is indicated in the condition
code and interrupt request registers; an interrupt will occur if
interrupts are enabled and the stack mask bit is set.  The operational
semantics is:
</p>

<div class="CodeListing" id="org031faf4"><pre>
if Ra &gt;= Rb
  then Rd := mem[Ra]
  else R15.suvfl := 1, req.suvfl := 1
</pre></div>
</div>
</div>

<div id="outline-container-orgd400804" class="outline-4">
<h4 id="orgd400804">Stack frames</h4>
<div class="outline-text-4" id="text-orgd400804">
<p>
When a program calls a procedure it is usually necessary to save the
state of the caller in a data structure called a stack frame.  (This
is not necessary during a "tail call".)  The stack frame is pushed
onto the execution stack.  When the procedure returns, the contents of
the stack frame need to be loaded back into the registers.  These
operations can be performed by ordinary store instructions (for
procedure call) and load instructions (for procedure return).
However, this often requires a significant number of instructions.
</p>

<p>
The <code>save</code> and <code>restore</code> instructions transfer a block of data between
registers and memory, making it easier to use stack frames.  These
instructions are analogous to <code>store</code> and <code>load</code>, but they store or
load multiple words, not just an individual word.
</p>

<ul class="org-ul">
<li><b>save</b> stores a sequence of adjacent registers into a block of
contiguous memory locations.</li>
<li><b>restore</b> is the opposite: it loads the block of memory into the
registers.</li>
</ul>

<p>
For both instructions, the sequence of registers is specified by
giving the first and last register.  The starting address of the
memory block is specified by an effective address of the form
<code>offset[Reg]</code>, where Reg is any register (e.g. R4, R13, etc) and
<code>offset</code> is a number between 0 and 255.
</p>

<p>
Normally \(d \leq e\), in which case the number of registers to be saved
is \(e-d + 1\).  If \(d > e\), the instruction will do nothing.  The base
register \(R_f\) should not lie within the group of registers to be
saved or restored.
</p>

<p>
The first register to be saved is \(R_d\), and the last register to be
saved is \(R_e\).  The instruction always stores at least one register.
If \(d = e\), for example <code>save R5,R5,0[R14]</code> then only R5 is stored.
If \(d < e\) then the register numbers wrap around For example,
</p>

<p>
There is an important restriction with <code>save</code> and <code>restore</code>: the
displacement is limited to a small natural number between 0 and 255.
(Recall that for load and store, the displacement can be as large as
65,535.)  The reason for this is that the save and restore
instructions are EXP format and the offset is represented by an 8-bit
field (whereas load and store are RX format and the displacement is a
16-bit word).
</p>

<p>
The instruction is EXP format, and the offset is limited to 8 bits,
because it is specified in the <b>gh</b> field, which is the rightmost 8
bits of the second word of the instruction.  The secondary opcode is
9, which is in the ab field of the first word of the instruction.
</p>
</div>
</div>

<div id="outline-container-org1813de5" class="outline-4">
<h4 id="org1813de5">save</h4>
<div class="outline-text-4" id="text-org1813de5">
<p>
The save instruction performs a sequence of stores, which copy the
contents of a sequence of registers into consecutive memory locations.
</p>

<ul class="org-ul">
<li>\(\mathsf{mem}[R_f+gh] := R_d\)</li>
<li>\(\mathsf{mem}[R_f+gh+1] := R_{d+1}\)</li>
<li>\(\mathsf{mem}[R_f+gh+2] := R_{d+2}\)</li>
<li>\(\ldots\)</li>
<li>\(\mathsf{mem}[R_f+gh+e-d] := R_e\)</li>
</ul>

<div style="overflow-x: auto">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">assembly language</td>
<td class="org-left">save Rd,Re,gh[Rf]</td>
</tr>

<tr>
<td class="org-left">instruction format</td>
<td class="org-left">EXP</td>
</tr>

<tr>
<td class="org-left">opcode</td>
<td class="org-left">E, 0A</td>
</tr>

<tr>
<td class="org-left">machine language</td>
<td class="org-left">E d 0A, e f gh</td>
</tr>

<tr>
<td class="org-left">effect</td>
<td class="org-left">\(M[R_f+gh] := R_d\)</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">\(M[R_f+gh+1] := R_{d+1}\)</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">\(M[R_f+gh+2] := R_{d+2}\)</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">\(\ldots\)</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">\(M[R_f+gh+e-d] := R_e\)</td>
</tr>
</tbody>
</table>

</div>

<p>
For example, the following instruction will save registers R3 through
R9 into memory starting at address 6 + R13.  Its machine language code
is e30b 9d06.
</p>

<div class="CodeListing" id="org059620b"><pre>
save   R3,R9,6[R13]
</pre></div>

<p>
This instruction  is equivalent to a sequence of store instructions:
</p>

<div class="CodeListing" id="org8804bb6"><pre>
store   R3,6[R13]
store   R4,7[R13]
store   R5,8[R13]
store   R6,9[R13]
store   R7,10[R13]
store   R8,11[R13]
store   R9,12[R13]
</pre></div>

<p>
As this example shows, using <code>save</code> and <code>restore</code> can make procedure
calls more concise and readable as well as less error-prone.
</p>
</div>
</div>

<div id="outline-container-orgcd142df" class="outline-4">
<h4 id="orgcd142df">restore</h4>
<div class="outline-text-4" id="text-orgcd142df">
<p>
This <code>restore</code> instruction has the same operands as <code>save</code>, and it
performs a sequence of loads corresponding to the stores performed by
save.
</p>

<div style="overflow-x: auto">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">assembly language</td>
<td class="org-left">restore Rd,Re,gh[Rf]</td>
</tr>

<tr>
<td class="org-left">instruction format</td>
<td class="org-left">EXP</td>
</tr>

<tr>
<td class="org-left">opcode</td>
<td class="org-left">E, 0B</td>
</tr>

<tr>
<td class="org-left">machine language</td>
<td class="org-left">E d 0B, e f gh</td>
</tr>

<tr>
<td class="org-left">effect</td>
<td class="org-left">\(R_d := M[R_f+gh]\)</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">$R<sub>d+1</sub> := M[R<sub>f</sub>+gh+1]</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">\(R_{d+2} := M[R_f+gh+2]\)</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">\(\ldots\)</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">\(R_e := M[R_f+gh+e-d]\)</td>
</tr>
</tbody>
</table>
</div>

<p>
For example, consider this instruction:
</p>

<div class="CodeListing" id="orge31c680"><pre>
restore  R3,R10,4[R14]
</pre></div>

<p>
The effect is equivalent to
</p>

<div class="CodeListing" id="org81a9663"><pre>
load  R3,4[R14]
load  R4,5[R14]
load  R5,6[R14]
load  R6,7[R14]
load  R7,8[R14]
load  R8,9[R14]
load  R9,10[R14]
load  R10,11[R14]
</pre></div>

<p>
Suppose a stack frame was created by the <code>save</code> example above. 
To restore the registers from the stack frame, use:
</p>

<div class="CodeListing" id="orga4fc415"><pre>
restore R3,R9,6[R13]  ; e30b 9d06. store R3-R9 starting at 6[R13]
</pre></div>

<p>
It is equivalent to a sequence of store instructions:
</p>

<div class="CodeListing" id="org13d1070"><pre>
load   R3,6[R13]
load   R4,7[R13]
load   R5,8[R13]
load   R6,9[R13]
load   R7,10[R13]
load   R8,11[R13]
load   R9,12[R13]
</pre></div>


<div class="CodeListing" id="orge4f7e63"><pre>
restore R3,R5,6[R13]  ; e30c 5d06. load R3-R5 starting at 6[R13]
</pre></div>

<p>
This is equivalent to a sequence of load instructions:
</p>
<div class="CodeListing" id="org6d5a0b6"><pre>
load    R3,6[R13]
load    R4,7[R13]
load    R5,8[R13]
load    R6,9[R13]
</pre></div>



<p>
The <b>restore</b> instruction copies a sequence of consecutive memory
locations starting from the effecive address into a sequence of
adjacent registers.  The index register (R14 in this example) is not
changed.  Restore is equivalent to a fixed sequence of load
instructions; its purpose of restore is to restore the state of
registers from memory after a procedure call or a context switch.
</p>


<p>
The instruction <b>restore Re,Rf,gh[Rd]</b> copies the contents of memory
at consecutive locations beginning with mem[gh+Rf] into registers Re,
Re+1, &#x2026;, Rf.
</p>
</div>
</div>
</div>


<div id="outline-container-org29abe62" class="outline-3">
<h3 id="org29abe62">Jumps</h3>
<div class="outline-text-3" id="text-org29abe62">
<p>
A jump is a transfer control to another address, rather than to the
following instruction. The destination address is specified as the
effective address in the jump instruction.  A jump can be used to
implement a goto statement.
</p>
</div>


<div id="outline-container-org311ef61" class="outline-4">
<h4 id="org311ef61">jump</h4>
<div class="outline-text-4" id="text-org311ef61">
</div>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">instruction format</td>
<td class="org-left">RX</td>
</tr>

<tr>
<td class="org-left">machine language</td>
<td class="org-left">{$f d a $3} {disp}</td>
</tr>

<tr>
<td class="org-left">effect</td>
<td class="org-left">pc := disp+R[a]</td>
</tr>

<tr>
<td class="org-left">assembly language</td>
<td class="org-left">jump disp[Ra]</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>

<div id="outline-container-org0ef39b5" class="outline-4">
<h4 id="org0ef39b5">jumpc0, jumpc1</h4>
<div class="outline-text-4" id="text-org0ef39b5">
<p>
These instructions jump to a destination if a specified bit in the
condition code is 0 (for jumpc0) or 1 (for jumpc1).
</p>

<p>
The first operand of jumpc0 is the index of a bit in R15.  Don't
specify R15; the condition bit is always in R15.  The index of the
condition bit must be specified in the d field of the instruction.
Since this is an index, not a register, it's written as a number.
</p>

<ul class="org-ul">
<li>jumpc0 3,loop[R0]  ; Right</li>
<li>jumpc0 R3,loop[R0] ; Wrong - not using R3!</li>
</ul>

<div class="CodeListing" id="org08e4a6a"><pre>
lea     R1,5[R0]
lea     R2,6[R0]
cmp     R1,R2
jumpc0  0,yes[R0]  ; jump if GT so don't jump
jumpc0  4,no[R0]   ; jump if LT so do jump
</pre></div>

<p>
jumpc0 goes to the destination if the specified condition bit is 0.
</p>

</div>
<div class="InstructionTable" id="orgd2e49fc">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">assembly language</td>
<td class="org-left">jumpc0 d,disp[Ra]</td>
</tr>

<tr>
<td class="org-left">instruction format</td>
<td class="org-left">RX</td>
</tr>

<tr>
<td class="org-left">opcode</td>
<td class="org-left">f,4</td>
</tr>

<tr>
<td class="org-left">machine language</td>
<td class="org-left">$f d a $4</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">disp</td>
</tr>

<tr>
<td class="org-left">effect</td>
<td class="org-left">if R[15].d=0</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">then pc := disp+R[a]</td>
</tr>
</tbody>
</table>

</div>
</div>

<p>
jumpc1 is similar: it jumps if the specified bit is 1.
</p>

<div style="overflow-x: auto">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">assembly language</td>
<td class="org-left">jumpc1 d,disp[Ra]</td>
</tr>

<tr>
<td class="org-left">instruction format</td>
<td class="org-left">RX</td>
</tr>

<tr>
<td class="org-left">opcode</td>
<td class="org-left">f,5</td>
</tr>

<tr>
<td class="org-left">machine language</td>
<td class="org-left">$f d a $5</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">disp</td>
</tr>

<tr>
<td class="org-left">effect</td>
<td class="org-left">if R15.d=1</td>
</tr>

<tr>
<td class="org-left">effect</td>
<td class="org-left">then R15.d=1</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>

<div id="outline-container-orgad90905" class="outline-4">
<h4 id="orgad90905">jal</h4>
<div class="outline-text-4" id="text-orgad90905">
<div style="overflow-x: auto">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">assembly language</td>
<td class="org-left">jal Rd,disp[Ra]</td>
</tr>

<tr>
<td class="org-left">instruction format</td>
<td class="org-left">EXP</td>
</tr>

<tr>
<td class="org-left">opcode</td>
<td class="org-left">f,6</td>
</tr>

<tr>
<td class="org-left">machine language</td>
<td class="org-left">{$f d a $6} {disp}</td>
</tr>

<tr>
<td class="org-left">effect</td>
<td class="org-left">R[d]:=pc, pc:=disp+R[a]</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>

<div id="outline-container-orgfeef2fd" class="outline-4">
<h4 id="orgfeef2fd">jumpz, jumpnz</h4>
<div class="outline-text-4" id="text-orgfeef2fd">
<p>
The jumpz instruction jumps to the destination if a specified register
is 0 (i.e. all the bits in that register are 0).
</p>

<div style="overflow-x: auto">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">assembly language</td>
<td class="org-left">jumpz d,disp[Ra]</td>
</tr>

<tr>
<td class="org-left">instruction format</td>
<td class="org-left">EXP</td>
</tr>

<tr>
<td class="org-left">opcode</td>
<td class="org-left">f,7</td>
</tr>

<tr>
<td class="org-left">machine language</td>
<td class="org-left">{$f d a $7} {disp}</td>
</tr>

<tr>
<td class="org-left">effect</td>
<td class="org-left">R[15].d=0 -&gt; pc := disp+R[a]</td>
</tr>
</tbody>
</table>
</div>

<p>
The jumpnz instruction jumps to the destination if a specified register
is not 0 (i.e. at least one of the bits in that register is 1).
</p>

<div style="overflow-x: auto">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">assembly language</td>
<td class="org-left">jumpnz d,disp[Ra]</td>
</tr>

<tr>
<td class="org-left">instruction format</td>
<td class="org-left">EXP</td>
</tr>

<tr>
<td class="org-left">opcode</td>
<td class="org-left">f,8</td>
</tr>

<tr>
<td class="org-left">machine language</td>
<td class="org-left">{$f d a $8} {disp}</td>
</tr>

<tr>
<td class="org-left">effect</td>
<td class="org-left">R[15].d=1 <code>&gt; pc :</code> disp+R[a]</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>

<div id="outline-container-org71b819c" class="outline-3">
<h3 id="org71b819c">Logic</h3>
<div class="outline-text-3" id="text-org71b819c">
<p>
Sigma16 provides two logic instructions that can evaluate arbitrary
Boolean expressions.  They implement all possible logic functions, not
just the most common ones.  You can perform logic on individual bits,
on a field within words, or on all the bits in a word.
</p>

<ul class="org-ul">
<li><code>logicf</code> performs bitwise logic on corresponding fields within two
operand registers; the result overwrites the field in the first
operand.</li>
<li><code>logicb</code> performs logic on two operand bits that may be at arbitrary
indices within arbitrary registers.  The result overwrites the first
operand bit.</li>
</ul>

<p>
The assembly language provides a group of pseudoinstructions for the
most common operations. Some of these (invw, andw, orw, xorw) are
introduced in the tutorial section on logic.  It is often more
convenient and readable to use the pseudoinstructions, rather than the
general <code>logicf</code> and <code>logicb</code>.
</p>

<p>
When translating a high level language program into assembly language,
there are two ways to implement a Boolean expression: using logic
instructions, or using a sequence of conditional jumps ("short circuit
evaluation").  It's good practice to understand both methods and to
use whichever is more appropriate in a specific situation.  Just
because an AND or OR operator appears in a program, that doesn't
necessarily mean that a logic instruction should be used.  The logic
instructions are important, and have many applications in practical
programming, but it is sometimes better to use "short circuit
evaluation" instead.
</p>

<p>
The next section explains how logic functions are represented, and the
following sections describe each logic instruction followed by its
pseudoinstructions.
</p>
</div>

<div id="outline-container-orgb712da1" class="outline-4">
<h4 id="orgb712da1">General logic functions</h4>
<div class="outline-text-4" id="text-orgb712da1">
<p>
The commonest Boolean operators are <code>inv</code>, <code>and2</code>, <code>or2</code>, and <code>xor2</code>.
The <code>inv</code> function (also called invert, not, logical negation) has one
input and produces one output, as defined by the truth table:
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">x</th>
<th scope="col" class="org-right">inv x</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">0</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-right">1</td>
<td class="org-right">0</td>
</tr>
</tbody>
</table>

<p>
The <code>and2</code>, <code>or2</code>, <code>xor2</code> functions have two inputs, so their truth
tables have four lines.  There are also functions with more inputs,
such as <code>and3</code> with 3 inputs, <code>and4</code> with 4 inputs, and so on.
Sigma16 doesn't have instructions for those, but you can replace them
with multiple uses of <code>and2</code>, <code>or2</code>, etc.
</p>

<div style="overflow-x: auto">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">x</th>
<th scope="col" class="org-right">y</th>
<th scope="col" class="org-right">x and2 y</th>
<th scope="col" class="org-right">x or2 y</th>
<th scope="col" class="org-right">x xor2 y</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-right">1</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
</tr>
</tbody>
</table>
</div>

<p>
These aren't the only useful operations: there are 16 logic functions
that take two arguments.  Instead of providing specialised
instructions for a few of the logic functions, Sigma16 provides
general instructions that implement all of them.
</p>

<p>
Every logic function with two inputs \(x\) and \(y\) can be defined by a
truth table where we list all possible values for the inputs and give
the corresponding result.  Each input could be either 0 or 1.  Since
there are 2 inputs, there are \(2^2 = 4\) lines in the truth table.
</p>

<p>
The tables above for and2, or2, xor2 give specific values, either 0 or
1, for each result.  For example, the result column for the <code>and2</code>
function is (reading from top to bottom) 0001, while <code>xor2</code> is 0110.
For an arbitrary function, we can write the result column as \(abcd\)
where each variable is either 0 or 1.
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">x</th>
<th scope="col" class="org-right">y</th>
<th scope="col" class="org-left">result</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-left">a</td>
</tr>

<tr>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-left">b</td>
</tr>

<tr>
<td class="org-right">1</td>
<td class="org-right">0</td>
<td class="org-left">c</td>
</tr>

<tr>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-left">d</td>
</tr>
</tbody>
</table>

<p>
If \((a,b,c,d) = (0,0,0,1)\) this is the truth table for <code>and2</code>.  if
\((a,b,c,d) = (0,1,1,0)\) it is the truth table for <code>xor2</code>.  Since there
are 4 variables, there are \(2^4=16\) possible settings of \((a,b,c,d)\)
and consequently there are 16 Boolean logic functions that take two
arguments.
</p>

<p>
The Sigma16 logic instructions provide all 16 of these functions;
taking a 4-bit code that specifies the logic function by giving the
values of \((a,b,c,d)\).  In assembly language, the code is given as the
decimal number represented by the bits \((a,b,c,d)\), which is between 0
and 15.  The codes for  a few of the functions are:
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">abcd</th>
<th scope="col" class="org-right">code</th>
<th scope="col" class="org-left">name</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">0001</td>
<td class="org-right">1</td>
<td class="org-left">x and2 y</td>
</tr>

<tr>
<td class="org-right">0111</td>
<td class="org-right">7</td>
<td class="org-left">x or2 y</td>
</tr>

<tr>
<td class="org-right">0110</td>
<td class="org-right">6</td>
<td class="org-left">x xor2 y</td>
</tr>

<tr>
<td class="org-right">1110</td>
<td class="org-right">14</td>
<td class="org-left">x nand2 y</td>
</tr>

<tr>
<td class="org-right">1000</td>
<td class="org-right">8</td>
<td class="org-left">x nor2 y</td>
</tr>
</tbody>
</table>

<p>
The <code>inv</code> function can be treated as a 2-input function where the
second argument is ignored.
</p>

<p>
Instead of writing the numeric code, we can define symbolic names for
the logic functions we need:
</p>

<div class="CodeListing" id="orgc884851"><pre>
and  equ     1
or   equ     7
xor  equ     6
</pre></div>

<p>
Now, instead of specifying a logic function as (for example) 6, we can
write it as <code>xor</code>.
</p>
</div>
</div>

<div id="outline-container-org148b0e9" class="outline-4">
<h4 id="org148b0e9">Logic on fields: logicf</h4>
<div class="outline-text-4" id="text-org148b0e9">
<p>
The logicf instruction performs a bitwise logic operation on fields
within two words.  The fields may be in different registers, but each
field must be at the same position: their start and end indices must
be the same.  Each bit of the result is obtained by performing a
specified logic function on the corresponding bits of the two fields.
The result overwrites the field in the first operand register. The
function \(h\) is specified as described above; for example, 6 is the
code for exclusive or.
</p>

<p>
The field is specified as a pair of 4-bit constants f, g, where f is
the index of the rightmost bit in the field and g is the index of the
leftmost bit.  Since the rightmost bit has a lower index, g should be
greater than f.  If \(f=g\) then the field consists of just one bit.  If
\(g<f\) then the field is empty, and the instruction will not change the
destination register.  The notation Rd.f:g means bits f through g in
register Rd.
</p>

<pre class="example" id="org4ad4efa">
;    logicf  Rd,Re,f,g,h
;      Rd = first operand register and destination register
;      Re = second operand register
;      f = index of rightmost bit in field (in both registers))
;      g = index of leftmost bit in field (in both registers)
;      h = logic function
;      effect:  Rd.f:g := map2 h (Rd.f:g, Re.f:g)
;      format: EXP
;      machine language: Ed00 efgh (op=$E, ab=$00)
     logicf  R3,R9,5,8,xor   ; e300 9586
</pre>

<p>
The following examples use the definitions of and, or, xor given
above.
</p>

<div class="CodeListing" id="orgb798ae9"><pre>
lea     R1,$3333[R0]   ; R1 := 3333
lea     R2,$5555[R0]   ; R2 := 5555
logicf  R1,R2,0,3,and  ; R1 := 3331
logicf  R1,R2,4,7,or   ; R1 := 3371
logicf  R1,R2,8,11,xor ; R1 := 3671
</pre></div>
</div>
</div>

<div id="outline-container-orgc2f524b" class="outline-4">
<h4 id="orgc2f524b">Word logic pseudoinstructions: invw, andw, orw, xorw</h4>
<div class="outline-text-4" id="text-orgc2f524b">
<p>
Several special cases of <code>logicf</code> appear frequently.  There are
special pseudoinstructions that simplify these special cases by
allowing some of the operands to be omitted.
</p>

<p>
The first simplification is to omit the operand that specifies the
logic function, and instead to indicate the function in the mnemonic.
For example, suppose you want to calculate the logical <i>and</i> of two
fields.  This can be done with the general logicf instruction:
</p>

<pre class="example" id="org84b23b3">
logicf Rd,Re,f,g,1
</pre>

<p>
Alternatively, you can indicate the logic function in the mnemonic and
omit the function operand:
</p>

<pre class="example" id="orgc91c222">
andf Rd,Re,f,g
</pre>

<p>
This simplification can be used with the following four functions (the
comment shows the actual machine instruction generated by the
assembler):
</p>

<pre class="example" id="org2e3a44f">
;    invf   Rd,f,g        ; logicf Rd,R0,f,g,12
;    andf   Rd,Re,f,g     ; logicf Rd,Re,f,g,1
;    orf    Rd,Re,f,g     ; logicf Rd,Re,f,g,2
;    xorf   Rd,Re,f,g     ; logicf Rd,Re,f,g,6
</pre>

<p>
The second simplification is to perform logic on an entire word,
rather than a field within the word.  This is achieved by specifying
\(f=0\) and \(g=15\).  The instruction <code>logicf Rd,Re,0,15,h</code> applies h
bitwise to the entire regisers Rd and Re, and the result overwrites
Rd.  There are pseudoinstructions to simplify this (which were
introduced in a tutorial section above):
</p>

<div class="CodeListing" id="orgea14a88"><pre>
invw  R3      ; R3 := invert R3
andw  R3,R4   ; R3 := R3 and R4
orw   R3,R4   ; R3 := R3 or R4
xorw  R3,R4   ; R3 := R3 xor R4
</pre></div>

<p>
A pseudoinstruction is not a machine instruction: the Sigma16
processor does not have an <code>andw</code> instruction.  Instead, the assembler
generates the <code>logicf</code> instruction corresponding to any of <code>invw</code>,
<code>andw</code>, <code>orw</code>, <code>xorw</code>.  The following assembly language statements
generate exactly the same machine language:
</p>

<div class="CodeListing" id="org9068629"><pre>
andw    R5,R7          ; R5 := R5 and R7
logicf  R5,R7,0,15,1   ; R5 := R5 and R7
</pre></div>

<p>
If you're using one of the most common logic functions, a
pseudoinstruction is convenient and can make a program more readable.
If you prefer to use the actual machine instruction, rather than a
pseudoinstruction, you can define a symbol for the logic function
using an <code>equ</code> assembly directive.  The symbol can then be used
instead of the numeric code:
</p>

<div class="CodeListing" id="org0cbb04b"><pre>
xor  equ   6
     &#x2026;
     logicf R5,R7,R2,xor   ; R5 := R7 xor R2
</pre></div>
</div>
</div>

<div id="outline-container-org75fa2a3" class="outline-4">
<h4 id="org75fa2a3">Bit logic: logicb</h4>
<div class="outline-text-4" id="text-org75fa2a3">
<p>
The bit logic instruction <code>logicb</code> specifies two operand bits, which
may be in any register at any index.  It applies a specified logic
function to these bits and puts the result bit back into the first
operand, overwriting the previous value of that bit.  The other bits
in the first operand register remain unchanged.  As this instruction
modifies only one bit in the first operand, it enables you to keep
many Boolean variables in just one register.
</p>

<p>
The general form is:
</p>

<pre class="example" id="org80c4ef3">
;    logicb  Rd,Re,f,g,h
;      effect: Rd.f := h (Rd.f, Re.g)
;      format: EXP
;      machine language: Ed01 efgh (op=E ab=01)
     logicb  R7,R9,3,5,6    ; e701 9356
</pre>

<p>
Suppose you want to calculate the logical xor of the bit in R3 at
index 12 and the bit in R7 at index 14.  This instruction will do it
(provided that the symbol xor is defined to be 6), The result will
overwrite the bit in R3 at index 12:
</p>

<div class="CodeListing" id="org52bf8a8"><pre>
logicb  R3,R7,12,14,xor  ; R3.12 := R3.12 xor R7.14
</pre></div>

<p>
Example:
</p>

<div class="CodeListing" id="orgbb47b26"><pre>
lea    R2,$0f00[R0]   ; R2.9 := 1
lea    R7,$2000[R0]   ; R7.13 := 1
logicb R2,R7,9,13,xor ; R2 := 0b00 (R2.9 := R2.9 xor R7.13 = 0)
</pre></div>
</div>
</div>

<div id="outline-container-org49e8e57" class="outline-4">
<h4 id="org49e8e57">Pseudoinstructions invb, andb, orb, xorb</h4>
<div class="outline-text-4" id="text-org49e8e57">
<p>
There are pseudoinstructions for the commonest logic functions:
</p>

<div class="CodeListing" id="orgeeb0df1"><pre>
invb    R1,3,R2,9   ; R1.3 := inv R2.9
andb    R1,3,R2,9   ; R1.3 := R1.3 and R2.9
orb     R1,3,R2,9   ; R1.3 := R1.3 or R2.9
xorb    R1,3,R2,9   ; R1.3 := R1.3 xor R2.9
</pre></div>

<p>
The <code>logicf</code> instruction and its pseudoinstructions (<code>andf</code>, etc.) can
operate on fields of any size, including 1-bit fields.  However,
<code>logicb</code> and its pseudoinstructions are more flexible than <code>logicf</code> on
a 1-bit field, because <code>logicb</code> allows the operands to have different
bit indices.
</p>
</div>
</div>

<div id="outline-container-org5358e69" class="outline-4">
<h4 id="org5358e69">Pseudoinstructions setb, clearb, copyb, copybi</h4>
<div class="outline-text-4" id="text-org5358e69">
<p>
The bit logic instructions have some useful special cases that don't
appear to involve logic at all.  These are supported by
pseudoinstructions.
</p>

<ul class="org-ul">
<li><code>setb Rd,f</code> puts 1 into a specified bit: <code>Rd.f :</code> 1=.</li>
<li><code>clearb Rd,f</code> puts 0 into the specified bit.</li>
<li><code>copyb Rd,Re,f,g</code> copies a bit from register Re at index g into
register Rd at index f.</li>
<li><code>copybi Rd,Re,f,g</code> is similar to copyb, except that it inverts the
bit as it is written into the destination.</li>
</ul>

<p>
Here are some examples:  
</p>

<div class="CodeListing" id="org7c43cee"><pre>
setb   R4,7         ; R4.7 := 1
clearb R4,7         ; R4.7 := 0
copyb  R4,R12,7,5   ; R4.7 := R12.5
copybi R4,R12,7,5   ; R4.7 := inv R12.5
</pre></div>
</div>
</div>
</div>

<div id="outline-container-org2197358" class="outline-3">
<h3 id="org2197358">Bit manipulation</h3>
<div class="outline-text-3" id="text-org2197358">
</div>
<div id="outline-container-orgc1fec39" class="outline-4">
<h4 id="orgc1fec39">Shifting: shiftl, shiftr</h4>
<div class="outline-text-4" id="text-orgc1fec39">
<p>
The shift instructions treat the operand as a string of bits, and move
each bit a fixed distance to the left or right.
</p>

<p>
The instruction shiftl <code>Rd,Re,h</code> shifts the value in the operand
register Ra by h bits to the left, and the result is placed in the
destination register Rd.  The operand Re is not modified.  The
leftmost h bits of the operand are discarded and the rightmost h bits
of the result become 0.  The general form is
</p>

<pre class="example" id="orgb818257">
;    shiftl Rd,Re,h
;      effect:  Rd := Re shl h
;      Rd = first operand register and destination register
;      Re = second operand register
;      f = unused
;      g = unused
;      h = constant shift distance
;      format: EXP/RRk
;      machine language: Ed04 efgh (op=$E, ab=$03)
     lea    R1,2[R0]   ;           R2 = 0002  0000 0000 0000 0010
     shiftl R5,R1,4    ; E503 1004 R5 = 0020  0000 0000 0010 0000
</pre>

<p>
The instruction <code>shiftr Rd,Re,h</code> shifts the value in the operand
register Re by h bits to the right, and the result is placed in the
destination register Rd.  The operand Re is not modified.  During the
shift, the rightmost k bits of the value are discarded and the
leftmost k bits become 0.  The general form is
</p>

<pre class="example" id="org9446f24">
;    shiftr Rd,Re,h
;      effect:  Rd := Re shr h
;      Rd = first operand register and destination register
;      Re = second operand register
;      f = unused
;      g = unused
;      h = constant shift distance
;      format: EXP/RRk
;      machine language: Ed04 efgh (op=$E, ab=$04)
</pre>

<p>
The following instruction shifts the value in R3 to the right by 5
bits and place the result in R2.  The operand register R3 is not
changed.
</p>

<div class="CodeListing" id="orgc2d4aef"><pre>
shiftr  R2,R3,5
</pre></div>
</div>
</div>

<div id="outline-container-org66a0144" class="outline-4">
<h4 id="org66a0144">Bit fields: extract</h4>
<div class="outline-text-4" id="text-org66a0144">
<p>
The extract instruction copies a field within a register to another
register.  The extract instruction copies an arbitrary field of bits
from a source register and inserts them into an arbitrary position in
a destination register. The destination field is overwritten, while
other bits in the destination register as well as all bits in the
source register are unchanged.
</p>

<p>
These instructions are useful for systems programming.  Emulators need
to access instruction fields, software implementing floating point
needs to access the parts of a floating point number, and networking
software needs to decode message headers.
</p>

<p>
<b>Bit indexing.</b> Sigma16 indexes bit positions in a word from right to
left, starting from 0.  The least significant (rightmost) bit has
index 0, and the most significant (leftmost) bit has index 15.
</p>

<p>
A bit field is a sequence of bits within a word.  A field is specified
using a pair of 4-bit natural numbers \(L,R\), where \(L\) is the index of
the leftmost bit in the field and \(R\) is the index of the rightmost
bit.  The size of a field is \(\max (0, L-R+1)\). Consequently, if \(L <
R\) the size is 0. For example:
</p>

<ul class="org-ul">
<li>R8.6,4 is the field consisting of R8.6, R8.5, R8.4 and its size
is 3.</li>
<li>R8.11,11 is the field consisting of R8.11 and its size is 1.</li>
<li>R8.15,0 is the field containing the entire contents of R8 and its
size is 16.</li>
<li>R8.5,7 is an empty field containing no bits; its size is 0</li>
</ul>

<p>
<b>Machine language.</b> The machine language format of extract is EXP,
with the following fields:
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">op</th>
<th scope="col" class="org-left">d</th>
<th scope="col" class="org-left">a</th>
<th scope="col" class="org-left">b</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">e</td>
<td class="org-left">f</td>
<td class="org-left">g</td>
<td class="org-left">h</td>
</tr>
</tbody>
</table>

<ul class="org-ul">
<li>op  = $e (escape to EXP)</li>
<li>Rd  = destination register</li>
<li>ab  = secondary opcode: $05 for extract</li>
<li>Re  = source register</li>
<li>f   = destination start index L</li>
<li>g   = destination end index R</li>
<li>h   = source start index L</li>
</ul>

<p>
The instruction specifies the destination field as \(f,g\).  The field
size S and the R index for the source are not specified in the
instruction: only the leftmost index of the source field is specified
explicitly as \(h\).
</p>

<p>
The sizes of the source and destination fields must be the same.  The
size and right index of the source are calculated as follows.  The
calculations verify that both the source and destination fields have
the same size.
</p>

<ul class="org-ul">
<li>The size \(S\) of a field specified by \(L,R\) is \(\max (0, L-R+1)\).</li>
<li>In general, \(R = L - S + 1\).</li>
<li>Destination field = Rd.f, Rd.f-1, &#x2026;, Rd.g.</li>
<li>Check that this works for destination: R = L - S + 1 = f -
(f-g+1) + 1 = f - f + g - 1 + 1 = g.</li>
<li>Source field = Re.h, Re.h-1, &#x2026;, Re.h-f+g</li>
<li>Calculate \(R\) for source, which is not specified in the instruction.
R = L - S + 1 = h - (f-g+1) + 1 = h - f + g - 1 + 1 = h - f + g.</li>
</ul>

<p>
<b>Assembly language.</b> The assembly language operand format for extract
is RkkRk, where R denotes a register number and k denotes a 4-bit
constant.  The general form of the instruction, in assembly language,
is
</p>

<div class="CodeListing" id="org07a6579"><pre>
extract Rd,f,g,Re,h
</pre></div>

<p>
<b>Effect.</b> The effect is to overwrite each bit in the destination field
with the corresponding bit in the source field:
</p>

<div class="CodeListing" id="orge12969c"><pre>
Rd.f := Re.h
Rd.f-1 := Re.h-1
&#x2026;
Rd.g := Re.h-f+g
</pre></div>

<p>
For example, consider <code>extract R14,9,7,R13,5</code>, where \(f=9\), \(g=7\),
\(h=5\).  The field size is \(f-g+1 = 9-7+1 = 3\), so 3 bit assignments
take place.  The index of the rightmost bit in the source field =
\(h-f+g = 5 -9 + 7 = 3\).  Therefore the instruction performs the
following bit assignments:
</p>

<div class="CodeListing" id="orge667d70"><pre>
R14.9 := R13.5
R14.8 := R13.4
R14.7 := R13.3
</pre></div>

<div class="CodeListing" id="orge30f807"><pre>
; Assembly language: extract Rd,f,g,Re,h
; Effect:            Rd.f..g := Re.h..(h+g-f)
; EXP opcode:        e,15

; Example:           extract R2,11,8,R1,3
; Machine language:  e215 1b83
</pre></div>


<p>
Example:
</p>
<div class="CodeListing" id="org52dd683"><pre>
extract R2,7,4,R3,20
R2.7 := R3.20
R2.6 := R3.19
R2.5 := R3.18
R2.4 := R3.17
</pre></div>

<p>
The extract instruction can be implemented using a
combination of logic and shift instructions. It is included in the
architecture for several reasons:
</p>

<ul class="org-ul">
<li>extract provides useful abstractions for writing
interpreters and simulators.</li>
<li>When used in an interpreter, bit field operations are executed
frequently: they are a crucial part of the "inner loop".  Therefore
the efficiency of common bit field operations is important.</li>
<li>The bit field instructions are easier to use and more readable than
the corresponding logic and shifts.</li>
<li>This instruction can be implemented efficiently in a digital
circuit and this implementation is an interesting design problem.</li>
</ul>

<p>
The effect of an extract instruction can be described by writing each
bit assignment individually, so there are <i>size</i> individual bit
assignments.  The notation R2.7 means <i>the bit at position 7 in
register R2</i>.  Using this notation, the example above performs the
following bit assignments:
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">extract R2,R1,11,3,4</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">R2.11 := R1.3</td>
</tr>

<tr>
<td class="org-left">R2.10 := R1.2</td>
</tr>

<tr>
<td class="org-left">R2.9 := R1.1</td>
</tr>

<tr>
<td class="org-left">R2.8 := R1.0</td>
</tr>
</tbody>
</table>

<p>
<b>Relation to other instructions.</b>
Although extract performs a number of bit assignments, it is a single
instruction and its execution time is a small fixed number of clock
cycles.  The execution time does not depend on the value of the field
size, and extracting a large field doesn't require more time than
extracting a small field. The hardware implementation of the
instruction does not use an iteration to copy the bits; they are all
copied in parallel in one clock cycle.
</p>

<p>
Any register may be specified for the source and destination.  If they
are the same, the effect is to move a bit field from one place to
another within the register (this is not the same as a shift).  If the
destination is R0, the result is discarded and the instruction has no
effect.
</p>

<p>
These instructions can be implemented using a combination of
logic and shift instructions.  They are included in the architecture
for several reasons:
</p>

<ul class="org-ul">
<li>These operations provide useful abstractions for writing
interpreters and simulators.</li>
<li>When used in an interpreter, bit field operations are executed
frequently: they are a crucial part of the "inner loop".  Therefore
the efficiency of common bit field operations is important.</li>
<li>The bit field instructions are easier to use and more readable than
the corresponding logic and shifts.</li>
<li>These instructions can be implemented efficiently in a digital
circuit and this implementation is an interesting design problem.</li>
</ul>
</div>
</div>
</div>


<div id="outline-container-orgffa5786" class="outline-3">
<h3 id="orgffa5786">User requests</h3>
<div class="outline-text-3" id="text-orgffa5786">
</div>
<div id="outline-container-org265d842" class="outline-4">
<h4 id="org265d842">Request to OS: trap</h4>
</div>
<div id="outline-container-orgc14281e" class="outline-4">
<h4 id="orgc14281e">testset</h4>
<div class="outline-text-4" id="text-orgc14281e">
<div style="overflow-x: auto">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">assembly language</td>
<td class="org-left">testset Rd,disp[Ra]</td>
</tr>

<tr>
<td class="org-left">instruction format</td>
<td class="org-left">EXP</td>
</tr>

<tr>
<td class="org-left">opcode</td>
<td class="org-left">f,9</td>
</tr>

<tr>
<td class="org-left">machine language</td>
<td class="org-left">{$f d a $9} {disp}</td>
</tr>

<tr>
<td class="org-left">effect</td>
<td class="org-left">R[d]:=M[disp+R[a], M[disp+R[a]]:=0001</td>
</tr>
</tbody>
</table>
<div style="overflow-x: auto">
</div>
</div>
</div>


<div id="outline-container-orgad6c9d0" class="outline-3">
<h3 id="orgad6c9d0">System control</h3>
<div class="outline-text-3" id="text-orgad6c9d0">
</div>
<div id="outline-container-org07368b5" class="outline-4">
<h4 id="org07368b5">Accessing control registers: getctl, putctl</h4>
</div>
<div id="outline-container-orgcffa77e" class="outline-4">
<h4 id="orgcffa77e">Context switching: resume</h4>
</div>

<div id="outline-container-orge96679e" class="outline-4">
<h4 id="orge96679e">Timer: timeron, timeroff</h4>
</div>
</div>
</div>

<div id="outline-container-org20615c5" class="outline-2">
<h2 id="org20615c5">Summary of instruction set</h2>
<div class="outline-text-2" id="text-org20615c5">
<ul class="org-ul">
<li>The Mnemonic gives the symbolic name of the instruction used in
assembly language</li>
<li>The ISA specifies the smallest subset of the instruction set
architecture that allows this instruction.  The Core subset is a
minimal architecture; the Standard subset contains a full range of
instructions</li>
<li>The R15 entry indicates how the instruction uses R15: cc indicates
the instruction sets the condition code in R15, and x indicates the
instruction places data in R15.  A blank entry means the
instruction does not change R15.</li>
<li>The P entry indicates whether the instruction is Privileged (P) or
not (blank)</li>
</ul>

<p>
The Args column shows the assembly language statement format.
</p>
<ul class="org-ul">
<li>R is a register, e.g. R4 or R15</li>
<li>D is an expression denoting the displacement, which must be
representable in 16 bits</li>
<li>k is a small constant representable in 4 bits, so 0 &lt;= k &lt; 16</li>
<li>K is a large constant representable in 12 bits, so 0 &lt;=k &lt; 4096</li>
</ul>

<p>
The first word of an instruction:
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">Op</td>
<td class="org-left">D</td>
<td class="org-left">A</td>
<td class="org-left">B</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">J</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>

<p>
Fields of the first instruction word:
</p>

<ul class="org-ul">
<li>Op = bits 15..12.  Used in all instructions as the
primary operation code</li>
<li>D = bits 11,10,9,8.  Destination register (e.g. R5)</li>
<li>A = bits 7..4.  First operand register (e.g. R12)</li>
<li>B = bits 3..0.  is either second operand register (e.g. R7) or secondary opcode
(4-bit constant)</li>
<li>k is a 4-bit constant in the d field, (e.g. 5)</li>
<li>ab is 8-bit secondary opcode for EXP format (e.g. $c3)</li>
<li>C is a control register specified by 4 bits</li>
<li>A "don't care" field is indicated with a dash</li>
</ul>
<p>
The second word of an instruction, for RX and EXP formats:
</p>



<p>
Formats for the second word of an instruction.  The second word may
consist of one of the following:
</p>
<ul class="org-ul">
<li>disp - a 16-bit constant</li>
<li>kq - a 4-bit constant k (in the e field), followed by a 12-bit
constant q (in the fgh fields)</li>
<li></li>
</ul>

<p>
The following table summarises the instructions in the Core subset of
Sigma16.  The columns are:
</p>
<ul class="org-ul">
<li>Mnemonic.  The assembly language name of the instruction</li>
<li>ISA. The Instruction Set Architecture subset that contains the
instruction; for this table all the instructions are Core.</li>
<li>P. * indicates that the instruction is privileged, blank indicates
that it is not.  All of the Core instructions are unprivileged.  For
the meaning of "privileged", see the System section.</li>
<li>Fmt. The instruction format.  There are two Core instruction
formats: RRR (instruction has three operand fields, each a register)
and RX (instruction has a register operand and an X operand
consisting of a displacement constant and an index register).</li>
<li>Args.  The assembly language argument format.  Usually this is the
same as Fmt.  However, some instructions don't use all the fields,
and the assembly language statement omits the irrelevant field
(e.g. cmp is RRR format but the assembly language statement omits
the d field, which is ignored).</li>
<li>Code.</li>
<li>Effect.  A statement in an imperative programming language which
describes what the instruction does.</li>
</ul>


<p>
Assembly directives
</p>

<ul class="org-ul">
<li>data</li>
</ul>
</div>

<div id="outline-container-orgabbfd23" class="outline-3">
<h3 id="orgabbfd23">RRR instructions</h3>
<div class="outline-text-3" id="text-orgabbfd23">
<div style="overflow-x: auto">

<!-- This HTML table template is generated by emacs 29.4 -->
<table border="1">
  <tr>
    <td align="left" valign="top">
      &nbsp;Assembly&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;Op&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;Code&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;Effect&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
  </tr>
  <tr>
    <td align="left" valign="top">
      &nbsp;add&nbsp;Rd,Ra,Rb&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;&nbsp;0&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;$0&nbsp;d&nbsp;a&nbsp;b&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;R[d]&nbsp;:=&nbsp;R[a]&nbsp;+&nbsp;R[g]&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;R15&nbsp;~=&nbsp;&nbsp;gGElvVC&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
  </tr>
  <tr>
    <td align="left" valign="top">
      &nbsp;sub&nbsp;Rd,Ra,Rb&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;&nbsp;1&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;$1&nbsp;d&nbsp;a&nbsp;b&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;R[d]&nbsp;:=&nbsp;R[a]&nbsp;-&nbsp;R[b]&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
  </tr>
  <tr>
    <td align="left" valign="top">
      &nbsp;mul&nbsp;d,a,b&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;&nbsp;2&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;$2&nbsp;d&nbsp;a&nbsp;b&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;R[d]&nbsp;:=&nbsp;R[a]&nbsp;*&nbsp;R[b]&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
  </tr>
  <tr>
    <td align="left" valign="top">
      &nbsp;div&nbsp;d,a,b&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;&nbsp;3&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;$3&nbsp;d&nbsp;a&nbsp;b&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;R[d]&nbsp;:=&nbsp;R[a]&nbsp;/&nbsp;R[b]&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;R[15]&nbsp;:=&nbsp;R[a]&nbsp;%&nbsp;R[b]&nbsp;&nbsp;&nbsp;
    </td>
  </tr>
  <tr>
    <td align="left" valign="top">
      &nbsp;cmp&nbsp;d,a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;&nbsp;4&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;$4&nbsp;-&nbsp;a&nbsp;b&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;R[15]&nbsp;:=&nbsp;R[a]&nbsp;cp&nbsp;R[b]&nbsp;&nbsp;
    </td>
  </tr>
  <tr>
    <td align="left" valign="top">
      &nbsp;addc&nbsp;d,a,b&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;&nbsp;5&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;$5&nbsp;d&nbsp;a&nbsp;b&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;Rd&nbsp;:=&nbsp;Ra&nbsp;+&nbsp;Rb&nbsp;+&nbsp;R15.C)&nbsp;
    </td>
  </tr>
  <tr>
    <td align="left" valign="top">
      &nbsp;muln&nbsp;d,a,b&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;&nbsp;6&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;$6&nbsp;d&nbsp;a&nbsp;b&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;Rd&nbsp;:=&nbsp;Ra&nbsp;:*:&nbsp;Rb&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
  </tr>
  <tr>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;R15&nbsp;:=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
  </tr>
  <tr>
    <td align="left" valign="top">
      &nbsp;divn&nbsp;d,a,b&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;&nbsp;7&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;$7&nbsp;d&nbsp;a&nbsp;b&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;R15++Rd&nbsp;:=&nbsp;R15++Ra&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
  </tr>
  <tr>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;:/:&nbsp;Rb&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
  </tr>
  <tr>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;&nbsp;8&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;$8&nbsp;-&nbsp;-&nbsp;-&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;nop&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
  </tr>
  <tr>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;&nbsp;9&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;$9&nbsp;-&nbsp;-&nbsp;-&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;nop&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
  </tr>
  <tr>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;&nbsp;a&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;$a&nbsp;-&nbsp;-&nbsp;-&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;nop&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
  </tr>
  <tr>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;&nbsp;b&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;$b&nbsp;-&nbsp;-&nbsp;-&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;nop&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
  </tr>
  <tr>
    <td align="left" valign="top">
      &nbsp;trap&nbsp;d,a,b&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;&nbsp;c&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;$c&nbsp;d&nbsp;a&nbsp;b&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;interrupt&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
  </tr>
  <tr>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;&nbsp;d&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;$d&nbsp;d&nbsp;a&nbsp;b&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;escape&nbsp;reserved&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
  </tr>
  <tr>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;&nbsp;e&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;$e&nbsp;d&nbsp;ab&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;escape&nbsp;EXP&nbsp;op=ab&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
  </tr>
  <tr>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;&nbsp;f&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;$f&nbsp;d&nbsp;a&nbsp;b&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;escape&nbsp;RX&nbsp;op=b&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
  </tr>
</table>

</div>
</div>
</div>

<div id="outline-container-org09550e1" class="outline-3">
<h3 id="org09550e1">RX instructions</h3>
<div class="outline-text-3" id="text-org09550e1">
<div style="overflow-x: auto">

<!-- This HTML table template is generated by emacs 29.4 -->
<table border="1">
  <tr>
    <td align="left" valign="top">
      &nbsp;Assembly&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;Op&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;Code&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;Effect&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;CC&nbsp;
    </td>
  </tr>
  <tr>
    <td align="left" valign="top">
      &nbsp;lea&nbsp;Rd,disp[Ra]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;f,0&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;$f&nbsp;d&nbsp;a&nbsp;$0&nbsp;<br />
      &nbsp;disp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;R[d]&nbsp;:=&nbsp;disp+R[a]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;
    </td>
  </tr>
  <tr>
    <td align="left" valign="top">
      &nbsp;load&nbsp;Rd,disp[Ra]&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;f,1&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;$f&nbsp;d&nbsp;a&nbsp;$1&nbsp;<br />
      &nbsp;disp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;R[d]&nbsp;:=&nbsp;M[disp+R[a]]&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;
    </td>
  </tr>
  <tr>
    <td align="left" valign="top">
      &nbsp;store&nbsp;Rd,disp[Ra]&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;f,2&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;$f&nbsp;d&nbsp;a&nbsp;$2&nbsp;<br />
      &nbsp;disp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;M[disp+R[a]]&nbsp;:=&nbsp;R[d]&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;
    </td>
  </tr>
  <tr>
    <td align="left" valign="top">
      &nbsp;jump&nbsp;disp[Ra]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;f,3&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;$f&nbsp;d&nbsp;a&nbsp;$3&nbsp;<br />
      &nbsp;disp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;pc&nbsp;:=&nbsp;disp+R[a]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;
    </td>
  </tr>
  <tr>
    <td align="left" valign="top">
      &nbsp;jumpc0&nbsp;d,disp[Ra]&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;f,4&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;$f&nbsp;d&nbsp;a&nbsp;$4&nbsp;<br />
      &nbsp;disp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;if&nbsp;R[15].d=0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;then&nbsp;pc&nbsp;:=&nbsp;disp+R[a]&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;
    </td>
  </tr>
  <tr>
    <td align="left" valign="top">
      &nbsp;jumpc1&nbsp;d,disp[Ra]&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;f,5&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;$f&nbsp;d&nbsp;a&nbsp;$5&nbsp;<br />
      &nbsp;disp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;if&nbsp;R[15].d=1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;then&nbsp;pc&nbsp;:=&nbsp;disp+R[a]&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;
    </td>
  </tr>
  <tr>
    <td align="left" valign="top">
      &nbsp;jal&nbsp;Rd,disp[Ra]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;f,6&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;$f&nbsp;d&nbsp;a&nbsp;$6&nbsp;<br />
      &nbsp;disp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;R[d]:=pc,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;pc:=disp+R[a]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;
    </td>
  </tr>
  <tr>
    <td align="left" valign="top">
      &nbsp;jumpz&nbsp;Rd,disp[Ra]&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;f,7&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;$f&nbsp;d&nbsp;a&nbsp;$7&nbsp;<br />
      &nbsp;disp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;if&nbsp;R[15].d=0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;then&nbsp;pc&nbsp;:=&nbsp;disp+R[a]&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;
    </td>
  </tr>
  <tr>
    <td align="left" valign="top">
      &nbsp;jumpnz&nbsp;Rd,disp[Ra]&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;f,8&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;$f&nbsp;d&nbsp;a&nbsp;$8&nbsp;<br />
      &nbsp;disp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;if&nbsp;R[15].d=1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;then&nbsp;pc&nbsp;:=&nbsp;disp+R[a]&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;
    </td>
  </tr>
  <tr>
    <td align="left" valign="top">
      &nbsp;testset&nbsp;Rd,disp[Ra]&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;f,9&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;$f&nbsp;d&nbsp;a&nbsp;$9&nbsp;<br />
      &nbsp;disp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;R[d]:=M[disp+R[a]],&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;M[disp+R[a]]:=0001&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;
    </td>
  </tr>
  <tr>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;f,a&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;$f&nbsp;d&nbsp;a&nbsp;$a&nbsp;<br />
      &nbsp;disp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;nop,&nbsp;reserved&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;
    </td>
  </tr>
  <tr>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;...&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;
    </td>
  </tr>
  <tr>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;f,f&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;$f&nbsp;d&nbsp;a&nbsp;$f&nbsp;<br />
      &nbsp;disp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;nop,&nbsp;reserved&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;
    </td>
  </tr>
</table>

</div>
</div>
</div>

<div id="outline-container-org2c91fc7" class="outline-3">
<h3 id="org2c91fc7">EXP instructions</h3>
<div class="outline-text-3" id="text-org2c91fc7">
<p>
Instructions and pseudoinstructions in each format:
</p>
<ul class="org-ul">
<li>EXP/: resume</li>
<li>EXP/R pseudo: invf</li>
<li>EXP/Rk: dispatch  (k is efgh)</li>
<li>EXP/RR pseudo
<ul class="org-ul">
<li>andw, orw, xorw, andf, orf, xorf</li>
<li>Rd = first operand register and destination register</li>
<li>Re = second operand register</li>
<li>f = unused</li>
<li>g = unused</li>
<li>h = generated by pseudo expansion</li>
</ul></li>
<li>EXP/RRk: shiftl, shiftr</li>
<li>EXP/RRkR: save, restore</li>
<li>EXP/RRkk pseudo: andb, orb, xorb, invb, orb, xorb</li>
<li>EXP/RRkkk: logicf, logicb, extract</li>
</ul>


<div style="overflow-x: auto">

<!-- This HTML table template is generated by emacs 29.4 -->
<table border="1">
  <tr>
    <td align="left" valign="top">
      &nbsp;Assembly&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;Op&nbsp;
    </td>
    <td align="left" valign="top">
      Format
    </td>
    <td align="left" valign="top">
      Code&nbsp;
    </td>
    <td align="left" valign="top">
      Effect&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
  </tr>
  <tr>
    <td align="left" valign="top">
      logicf&nbsp;Rd,Re,f,g,h&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      e,00<br />
      &nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      EXP&nbsp;&nbsp;&nbsp;<br />
      RRkkk&nbsp;
    </td>
    <td align="left" valign="top">
      Ed00&nbsp;<br />
      efgh&nbsp;
    </td>
    <td align="left" valign="top">
      Rd.f:g&nbsp;:=&nbsp;h#(Rd.f:g,Re.f:g)<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
  </tr>
  <tr>
    <td align="left" valign="top">
      invw&nbsp;Rd&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      pseudo<br />
      R&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      Ed01&nbsp;<br />
      e0F1&nbsp;
    </td>
    <td align="left" valign="top">
      logicf&nbsp;Rd,Re,0,15,1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
  </tr>
  <tr>
    <td align="left" valign="top">
      andw&nbsp;Rd,Re&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      pseudo<br />
      RR&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      Ed01&nbsp;<br />
      e0F1&nbsp;
    </td>
    <td align="left" valign="top">
      logicf&nbsp;Rd,Re,0,15,1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
  </tr>
  <tr>
    <td align="left" valign="top">
      orw&nbsp;Rd,Re&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      pseudo<br />
      RR&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      Ed01&nbsp;<br />
      e0F1&nbsp;
    </td>
    <td align="left" valign="top">
      logicf&nbsp;Rd,Re,0,15,1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
  </tr>
  <tr>
    <td align="left" valign="top">
      xorw&nbsp;Rd,Re&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      pseudo<br />
      RR&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      Ed01&nbsp;<br />
      e0F1&nbsp;
    </td>
    <td align="left" valign="top">
      logicf&nbsp;Rd,Re,0,15,1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
  </tr>
  <tr>
    <td align="left" valign="top">
      invf&nbsp;Rd,f,g&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      pseudo<br />
      R&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      Ed01&nbsp;<br />
      e0F1&nbsp;
    </td>
    <td align="left" valign="top">
      logicf&nbsp;Rd,Re,0,15,1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
  </tr>
  <tr>
    <td align="left" valign="top">
      andf&nbsp;Rd,Re,f,g&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      pseudo<br />
      RR&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      Ed01&nbsp;<br />
      e0F1&nbsp;
    </td>
    <td align="left" valign="top">
      logicf&nbsp;Rd,Re,0,15,1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
  </tr>
  <tr>
    <td align="left" valign="top">
      orf&nbsp;Rd,Re,f,g&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      pseudo<br />
      RR&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      Ed01&nbsp;<br />
      e0F1&nbsp;
    </td>
    <td align="left" valign="top">
      logicf&nbsp;Rd,Re,0,15,1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
  </tr>
  <tr>
    <td align="left" valign="top">
      xorf&nbsp;Rd,Re,f,g&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      pseudo<br />
      RR&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      Ed01&nbsp;<br />
      e0F1&nbsp;
    </td>
    <td align="left" valign="top">
      logicf&nbsp;Rd,Re,0,15,1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
  </tr>
  <tr>
    <td align="left" valign="top">
      logicb&nbsp;Rd,Re,f,g,h&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      e,01<br />
      &nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      EXP&nbsp;&nbsp;&nbsp;<br />
      RRkkk&nbsp;
    </td>
    <td align="left" valign="top">
      Ed01&nbsp;<br />
      efgh&nbsp;
    </td>
    <td align="left" valign="top">
      Rd.f&nbsp;:=&nbsp;h(Rd.f,Re.g)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
  </tr>
  <tr>
    <td align="left" valign="top">
      invb&nbsp;Rd,Re,f,g&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      pseudo<br />
      RRkk&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      Ed01&nbsp;<br />
      efg1&nbsp;
    </td>
    <td align="left" valign="top">
      logicb&nbsp;Rd,Re,f,g,1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
  </tr>
  <tr>
    <td align="left" valign="top">
      andb&nbsp;Rd,Re,f,g&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      pseudo<br />
      RRkk&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      Ed01&nbsp;<br />
      efg1&nbsp;
    </td>
    <td align="left" valign="top">
      logicb&nbsp;Rd,Re,f,g,1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
  </tr>
  <tr>
    <td align="left" valign="top">
      orb&nbsp;Rd,Re,f,g&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      pseudo<br />
      RRkk&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      Ed01&nbsp;<br />
      efg1&nbsp;
    </td>
    <td align="left" valign="top">
      logicb&nbsp;Rd,Re,f,g,1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
  </tr>
  <tr>
    <td align="left" valign="top">
      xorb&nbsp;Rd,Re,f,g&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      pseudo<br />
      RRkk&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      Ed01&nbsp;<br />
      efg1&nbsp;
    </td>
    <td align="left" valign="top">
      logicb&nbsp;Rd,Re,f,g,1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
  </tr>
  <tr>
    <td align="left" valign="top">
      shiftl&nbsp;Rd,Re,h&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      e,03<br />
      &nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      EXP&nbsp;&nbsp;&nbsp;<br />
      RRk&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      Rd&nbsp;:=&nbsp;Re&nbsp;shl&nbsp;h&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
  </tr>
  <tr>
    <td align="left" valign="top">
      shiftr&nbsp;Rd,Re,h&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      e,04<br />
      &nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      EXP&nbsp;&nbsp;&nbsp;<br />
      RRk&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      Rd&nbsp;:=&nbsp;Re&nbsp;shr&nbsp;h&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
  </tr>
  <tr>
    <td align="left" valign="top">
      extract&nbsp;Rd,Re,f,g,h&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      e,05<br />
      &nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      EXP&nbsp;&nbsp;&nbsp;<br />
      RRkkk&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      Rd.f~g&nbsp;:=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
  </tr>
  <tr>
    <td align="left" valign="top">
      push&nbsp;Rd,Re,Rf&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      e,07<br />
      &nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      EXP&nbsp;&nbsp;&nbsp;<br />
      RRR&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      M[ea]&nbsp;:=&nbsp;Rd,&nbsp;Rb++&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
  </tr>
  <tr>
    <td align="left" valign="top">
      pop&nbsp;Rd,Re,Rf&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      e,08<br />
      &nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      EXP&nbsp;&nbsp;&nbsp;<br />
      RRR&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      Rb--,&nbsp;Rd&nbsp;:=&nbsp;M[ea]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
  </tr>
  <tr>
    <td align="left" valign="top">
      top&nbsp;Rd,Re,Rf&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      e,09<br />
      &nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      EXP&nbsp;&nbsp;&nbsp;<br />
      RRR&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      Rb--,&nbsp;Rd&nbsp;:=&nbsp;M[ea]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
  </tr>
  <tr>
    <td align="left" valign="top">
      save&nbsp;Rd,Re,gh[Rf]&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      e,0a<br />
      &nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      EXP&nbsp;&nbsp;&nbsp;<br />
      RRkR&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      M[Rf+gh]&nbsp;:=&nbsp;Rd&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      M[Rf+gh+1]&nbsp;:=&nbsp;Rd+1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      M[Rf+gh+e-d]&nbsp;:=&nbsp;Re&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
  </tr>
  <tr>
    <td align="left" valign="top">
      restore&nbsp;Rd,Re,gh[Rf]<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      e,0b<br />
      &nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      EXP&nbsp;&nbsp;&nbsp;<br />
      RRkR&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      Rd&nbsp;:=&nbsp;M[Rf+gh]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      Rd+1&nbsp;:=&nbsp;M[Rf+gh+1]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      Re&nbsp;:=&nbsp;M[Rf+gh+e-d]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
  </tr>
  <tr>
    <td align="left" valign="top">
      brc0&nbsp;Rd,e,fgh&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      e,0c<br />
      &nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      EXP&nbsp;&nbsp;&nbsp;<br />
      Rkk&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      Ed0C&nbsp;<br />
      efgh&nbsp;
    </td>
    <td align="left" valign="top">
      if&nbsp;R[d].e=0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;then&nbsp;pc:=pc+fgh&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
  </tr>
  <tr>
    <td align="left" valign="top">
      brc1&nbsp;Rd,e,fgh&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      e,0d<br />
      e,0d
    </td>
    <td align="left" valign="top">
      EXP&nbsp;&nbsp;&nbsp;<br />
      Rkk&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      Ed0D&nbsp;<br />
      efgh&nbsp;
    </td>
    <td align="left" valign="top">
      if&nbsp;R[d].e=1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;then&nbsp;pc:=pc+fgh&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
  </tr>
  <tr>
    <td align="left" valign="top">
      brz&nbsp;Rd,efgh&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      e,0e<br />
      &nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      EXP&nbsp;&nbsp;&nbsp;<br />
      Rk&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      Ed0E&nbsp;<br />
      efgh&nbsp;
    </td>
    <td align="left" valign="top">
      if&nbsp;R[d]=0000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;then&nbsp;pc:=pc+efgh&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
  </tr>
  <tr>
    <td align="left" valign="top">
      brnz&nbsp;Rd,efgh&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      e,0f<br />
      &nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      EXP&nbsp;&nbsp;&nbsp;<br />
      Rk&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      Ed0F&nbsp;<br />
      efgh&nbsp;
    </td>
    <td align="left" valign="top">
      if&nbsp;R[d]!=0000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;then&nbsp;pc:=pc+efgh&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
  </tr>
  <tr>
    <td align="left" valign="top">
      dispatch&nbsp;Rd,efgh&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      e,10<br />
      &nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      EXP&nbsp;&nbsp;&nbsp;<br />
      Rk&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      Ed10&nbsp;<br />
      efgh&nbsp;
    </td>
    <td align="left" valign="top">
      pc&nbsp;:=&nbsp;M[pc+min(Rd,efgh)]]&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
  </tr>
  <tr>
    <td align="left" valign="top">
      getctl&nbsp;Rd,c&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      e,11<br />
      &nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      EXP&nbsp;&nbsp;&nbsp;<br />
      RC&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      Rd&nbsp;:=&nbsp;Sc&nbsp;privileged&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
  </tr>
  <tr>
    <td align="left" valign="top">
      putctl&nbsp;Rd,c&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      e,12<br />
      &nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      EXP&nbsp;&nbsp;&nbsp;<br />
      RC&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      Sc&nbsp;:=&nbsp;Rd&nbsp;privileged&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
  </tr>
  <tr>
    <td align="left" valign="top">
      resume&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      e,13<br />
      &nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      EXP&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      pc&nbsp;:=&nbsp;ipc,&nbsp;(privileged)&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;status&nbsp;:=&nbsp;istatus&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
  </tr>
  <tr>
    <td align="left" valign="top">
      timon&nbsp;Rd,efgh&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      e,14<br />
      &nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      EXP&nbsp;&nbsp;&nbsp;<br />
      R&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      timer&nbsp;:=&nbsp;efgh,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      start&nbsp;timer&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
  </tr>
  <tr>
    <td align="left" valign="top">
      timoff&nbsp;Rd,efgh&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      e,15<br />
      &nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      EXP&nbsp;&nbsp;&nbsp;<br />
      R&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      stop&nbsp;timer&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
  </tr>
  <tr>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      e,16
    </td>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;reserved:&nbsp;nop&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
  </tr>
  <tr>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      ...&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;...&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
  </tr>
  <tr>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      e,ff
    </td>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;reserved:&nbsp;nop&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
  </tr>
</table>


</div>
</div>
</div>

<div id="outline-container-orga7889db" class="outline-3">
<h3 id="orga7889db">Summary of pseudoinstructions</h3>
<div class="outline-text-3" id="text-orga7889db">
<p>
Pseudoinstructions for comparisons
</p>

<ul class="org-ul">
<li>jumplt jump if &lt;</li>
<li>jumple jump if &lt;=</li>
<li>jumpeq jump if =</li>
<li>jumpne jump if !=</li>
<li>jumpge jump if &gt;-</li>
<li>jumpgt jump if &gt;</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-orgbde6406" class="outline-2">
<h2 id="orgbde6406">Assembly language</h2>
<div class="outline-text-2" id="text-orgbde6406">
<p>
:CUSTOM<sub>ID</sub>: sec-assembly-language
</p>

<p>
A computer is a digital circuit that executes programs in machine
language, which is hard for humans to read because it consists
entirely of numbers.  Assembly language provides a readable notation
for writing machine language programs.  It uses names for instructions
and variables, as well as other notations to make the code easier to
understand.
</p>

<p>
An instruction in machine language is just one or more words (often
written in hexadecimal notation), while the corresponding instruction
in assembly language uses mnemonic names so the programmer doesn't
have to memorise all the operation codes, addresses of variables, and
so on. For example, the assembly language statement mul R12,R3,R8 is
more readable than the corresponding machine language instruction
2c38.  However, the assembly language still gives the programmer
complete control over every bit a program.
</p>


<p>
A programmer writes a machine-level program in assembly language.  A
software application called the <b>assembler</b> reads it in and translates
it to machine language.  When it sees an instruction mnemonic like add
or div, it replaces it with the operation code (0, 3, or whatever).
The assembler helps with variable names &#x2014; the machine language needs
addresses (numbers) and the assembler calculates them
</p>

<ul class="org-ul">
<li>You can use names (add, div) rather than numeric codes (0, 3)</li>
<li>You can use variable names (x, y, sum) rather than memory addresses
(02c3, 18d2)</li>
<li>You write a program in assemply language</li>
<li>The assembler translates it into machine language</li>
</ul>

<p>
Compilers and assemblers are similar in some ways: both of them
translate a program from one language to another.  The main difference
is that compilers translate between languages that are quite
different, while assemblers translate between similar languages.
</p>

<p>
Example: a sequence of RRR instructions
</p>

<p>
Assembly language
</p>
<div class="CodeListing" id="org8aaed26"><pre>
add    R3,R5,R1
sub    R4,R2,R3
mul    R1,R9,R10   
</pre></div>

<p>
Machine language
</p>
<div class="CodeListing" id="org18944a1"><pre>
0351
1423
219a
</pre></div>
</div>

<div id="outline-container-org370c863" class="outline-3">
<h3 id="org370c863">Programs, modules, and files</h3>
<div class="outline-text-3" id="text-org370c863">
<p>
Sigma16 has the flexibility required for "programming in the large".
It provides modules, separate assembly, import and export, relocation,
linking, executables, and booting.  It also has special conventions
that enable the user to skip those complications, and simply enter a
standalone program, assemble it, and run it.  The system is
straightforward for beginners but allows a transition to realistic
systems programming.
</p>

<p>
The assembler inputs a program in assembly language.  This is called
the <i>source module</i>.  The assembler outputs an <i>object module</i> that
contains the machine language code.  The assembler also produces an
<i>assembly listing</i>, which presents the program in a form useful for
the programmer.  The assembly listing shows the source code, the
corresponding machine language, a symbol table, and any error
messages.  Finally, the assembler outputs a <i>metadata module</i> that
enables the emulator to track the source statement corresponding to
each instruction.
</p>

<p>
A simple program consists of just one source module that does not
import anything.  This is a <i>standalone program</i>, and assembling it
produces an <i>executable program</i>.  An executable program is an object
module that does not require linking; it can be booted directly in the
processor.
</p>

<p>
A larger program may consist of several source modules, including one
main program.  This requires use of the <i>linker</i> to combine the
collection of object modules into a single executable program.
</p>
</div>

<div id="outline-container-org87b8c7d" class="outline-4">
<h4 id="org87b8c7d">Standalone programs</h4>
<div class="outline-text-4" id="text-org87b8c7d">
<p>
If a program consists of just one source module that does not import
any names, it is <i>standalone</i>.  There are several ways to input a
standalone program: you can choose it from one of the examples, load
it from a file, or type it into the editor.  In all cases, the text of
the program is shown in the editor pane.  Go to the Assembler pane and
click Assemble.  If there are no errors, go directly to the Processor
pane (you can skip the Linker) and click Boot.  This will read the
machine language into the memory, and now you can run the program.
</p>
</div>
</div>

<div id="outline-container-orgf7615fd" class="outline-4">
<h4 id="orgf7615fd">Modules</h4>
<div class="outline-text-4" id="text-orgf7615fd">
<p>
Large programs are easier to develop if you break them into separate
modules which can be assembled separately.  One of the modules is
identified as the <i>main module</i>, and it imports the other modules.
This allows you to define procedures, global variables, and symbolic
constants in separate modules.  Many separate programs can reuse these
modules simply by importing them.
</p>

<p>
The Sigma16 app maintains a <i>Module Set</i> describing all the modules
that it knows about.  The usual workflow is to read in all the modules
comprising a program, and to assemble each of them.  Then the linker
combines all the modules in the Module Set to form an executable.  The
executable can be saved to a file, or it can be booted into the
processor.
</p>

<p>
The Module Set is displayed in the <i>Modules</i> page.  Key information
about each module is shown, including the first few lines of the
source code.  It is good practice to begin every source module with
two or three lines of comments that identify the code, giving its
name, purpose, author, and date.
</p>

<p>
The app maintains several invariants:
</p>
<ul class="org-ul">
<li>At all times, there is at least one module.  If you close the last
remaining module, a new one with empty source code is immediately
created, to ensure that there is at least one module.</li>
<li>At all times, exactly one module is <i>selected</i>.  The assembler
always works on the selected module. When you go to the Assemble
page, the assembler source code is set to the text of the selected
module.</li>
<li>At all times, the source code text of the selected module is
displayed in the editor window.</li>
</ul>

<p>
Each module in the Module Set has a <i>module record</i> that contains
everything the app knows about the module:
</p>
<ul class="org-ul">
<li>(optional) the name of the module</li>
<li>(always) the source code (which could just be an empty or blank
string)</li>
<li>(optional) the filename and file handle of the source code</li>
<li>(if there is a file handle) whether the code in the file is <i>stale</i>
(i.e.  the current source code has been edited and differs from the
text in the file)</li>
<li>(after assembly) the object code. Each module has an associated
object code, which may be empty. The object code can be produced by
a successful assembly (i.e. an assembly with no errors) or it can be
obtained from the Editor.  This allows object code to be read from a
file or entered directly by the user.</li>
<li>(after assembly) the assembly listing</li>
<li>(after assembly) the metadata</li>
</ul>
</div>

<ul class="org-ul">
<li><a id="org7689c59"></a>Creating a module<br />
<div class="outline-text-5" id="text-org7689c59">
<ul class="org-ul">
<li><i>Launch.</i> When the Sigma16 app is launched, it creates the initial
Module Set containing a module whose source text is the empty
string.  This module is automatically selected, and it is not
associated with a file.  As always, you can see the source code text
(which is empty) by going to the Editor.</li>
<li><i>Load example.</i> You can open one of the Examples: Go to the Examples
page, navigate through the index pages to one of the programs, and
select it.  This will add a new module to the Module Set, select it,
and set its source code to the contents of the file.  The object
code is set to empty.</li>
<li><i>Read file.</i> You can read a source file from your user space to
create a module.  Go to the Modules page and click Choose Module.
This adds the result to the Module Set.  The object code is set to
empty.</li>
<li><i>Editor: New.</i> Go to the Editor page and click <i>New</i>.  This creates
a new module whose name is <code>Anonymous</code> whose source text is the
empty string.  The new module is selected and added to the Module
Set (you can see it by going to the Modules page).  The previous
text in the editor page is not lost; it remains in the module that
had previous been selected.</li>
</ul>
</div>
</li>

<li><a id="org4dd6d11"></a>Selecting a module<br />
<div class="outline-text-5" id="text-org4dd6d11">
<p>
The Modules page shows which module is currently selected, and its
source text is visible if you go to the Editor page.
</p>
</div>
</li>

<li><a id="org87a639e"></a>Changing a module<br />
<div class="outline-text-5" id="text-org87a639e">
<ul class="org-ul">
<li><i>Edit text.</i></li>
<li><i>Save.</i></li>
<li><i>Select.</i></li>
</ul>
</div>
</li>

<li><a id="org0bc79e5"></a>Closing a module<br />
<div class="outline-text-5" id="text-org0bc79e5">
<ul class="org-ul">
<li><i>Close.</i></li>
</ul>
</div>
</li>
</ul>
</div>

<div id="outline-container-org4733c95" class="outline-4">
<h4 id="org4733c95">Modules page</h4>
<div class="outline-text-4" id="text-org4733c95">
<ul class="org-ul">
<li>In Modules tab, click Choose Files
<ul class="org-ul">
<li>The dialogue shows .asm.txt, .lnk.txt, .obj.txt, .md.txt</li>
<li>To select all the relevant files in a directory, click the little
box at the left on the row giving "Name, date modified, &#x2026;"</li>
<li>Click Open (or cancel)</li>
</ul></li>
</ul>
</div>
</div>

<div id="outline-container-org381bbb3" class="outline-4">
<h4 id="org381bbb3">Editor page</h4>
<div class="outline-text-4" id="text-org381bbb3">
<p>
Editor operations on files and modules
</p>

<p>
Each operation that changes the editor buffer (New, Open, Close)
checks first to see whehter the buffer has been changed since it was
last saved.  If so, a dialogue asks whether the file should be saved.
</p>

<ul class="org-ul">
<li>New &#x2013; Check whether text in the editor buffer has been saved; if
not, ask whether to save it.  Create a new module with empty text
and no file name, add it to the module set, and select it as the
current module.  Clear the text in the editor buffer.</li>

<li>Open &#x2013; Check whether text in the editor buffer has been saved; if
not, ask whether to save it.  Enter the open file dialogue where an
existing file can be found by navigation or by typing in its name.
If the dialogue is cancelled, the module set and editor buffer are
left unchanged.  If a file is selected in the dialogue, and it is
already in the module set, then it is selected in the current
module.  Otherwise, a new module is created with the file's
contents, and is selected as the current module.  and The file is
loaded into the editor buffer and added to the module set.</li>

<li>Refresh &#x2013; The file corresponding to the current module is read, and
its contents are loaded into the editor buffer.</li>

<li>SaveAs &#x2013; Enters the save file dialogue where the directory and file
name can be chosen.  The editor buffer is written into this file.</li>

<li>Save &#x2013; Writes the editor buffer into the current file and
directory.  If either the module name or directory is not known,
this reverts to a SaveAs.</li>

<li>Select &#x2013; Opens a list of all modules; you can click one of them
which is then set as the current module.</li>

<li>Close &#x2013; Check whether text in the editor buffer has been saved; if
not, ask whether to save it. The module is removed from the module
set, and the editor buffer is cleared.  The first module (module
number 0) is selected as the current module, but if there is no
module at all, an empty module is created and selected as current
(in effect, if there is only one module and you close it, an
automatic New is performed).</li>

<li>Example &#x2013; Reads in a simple example program and sets it as the
current module.  This is a standalone program; you can simply click
Editor: Example, then Assembler: Assemble, then Processor: Boot, and
run the program.  This example is used in the first "getting
started" tutorial.  The example program is also available in the
Examples directory, accessible through Editor: Open.</li>
</ul>

<p>
Select is for switching among the existing modules, while New and Open
are for introducing a new module.
</p>
</div>
</div>

<div id="outline-container-orgf6e9eb6" class="outline-4">
<h4 id="orgf6e9eb6">Files</h4>
<div class="outline-text-4" id="text-orgf6e9eb6">
<p>
A source module may be stored in a file, although this is not
required.  The assembler will produce several objects, which can also
be stored into files.
</p>

<p>
There is a standard convention for Sigma16 filenames.  All filenames
end with a two-part extension, such as <code>.asm.txt</code>.  The first part
(<code>.asm</code>) tells Sigma16 what kind of information the file contains, and
the final part (<code>.txt</code>) enables the computer you're running on to
interpret the file as plain text.  If you have a program named
<code>MyProgram</code>, then the files associated with it must be named as
follows:
</p>

<div style="overflow-x: auto">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Description</th>
<th scope="col" class="org-left">Language</th>
<th scope="col" class="org-left">Filename</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">source code</td>
<td class="org-left">assembly language</td>
<td class="org-left">MyProgram.asm.txt</td>
</tr>

<tr>
<td class="org-left">object code</td>
<td class="org-left">object language</td>
<td class="org-left">MyProgram.obj.txt</td>
</tr>

<tr>
<td class="org-left">assembly listing</td>
<td class="org-left">plain text</td>
<td class="org-left">MyProgram.lst.txt</td>
</tr>

<tr>
<td class="org-left">metadata</td>
<td class="org-left">plain text</td>
<td class="org-left">MyProgram.md.txt</td>
</tr>
</tbody>
</table>
</div>

<p>
The first part of the filename (<code>MyProgram</code>) is the <i>base name</i>, and
is the same for all the files for the module.  The last part
(<code>.asm.txt</code>) is the <i>extension</i>.
</p>

<p>
A filename can be specified either as a full path (the unique
identification of the file (<code>C:\\Users\...\prog.asm.txt</code>), or as just
a filename (myprogram.asm.txt) which is relative to the current
directory.
</p>

<p>
To edit a file, the modDir and modName are both optional.  An edited
file may have a module name specified with a module statement.  To
read or save a file, both the module directory and name must be known.
</p>

<p>
There are two ways to read in a file:
</p>
<ul class="org-ul">
<li>Go to the <i>Examples</i> page, navigate to one of the examples, and open
it.  This will create a new module record and read the <code>.asm.txt</code>
file into the source code for that record.  The object, assembly
listing, and metadata for the module record are set to the empty
string.</li>
<li>Go to the <i>Modules</i> page, click <i>Choose File</i>, and navigate to a
source file anywhere in your file space. Selet that file, and it
will be read into the source code for a newly created module record.</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-org0b55b5b" class="outline-3">
<h3 id="org0b55b5b">Fixed and relocatable values</h3>
<div class="outline-text-3" id="text-org0b55b5b">
<p>
A value is a 16-bit word.  An assembly language program uses
expressions to denote values, but the actual underlying quantity is a
value.  A value consists of a word and several attributes:
</p>

<ul class="org-ul">
<li>word is a natural number in the range from 0 to 2<sup>16</sup>-1.</li>
<li>origin
<ul class="org-ul">
<li>if origin=Local, the value is defined within the module</li>
<li>if origin=External, the value is imported from another module</li>
</ul></li>
<li>movability
<ul class="org-ul">
<li>If movability = Relocatable, the value must be adjusted by the
relocation constant when the module is relocated</li>
<li>If movability = Fixed, the value is not affected during relocation</li>
</ul></li>
</ul>
</div>

<div id="outline-container-org16918ee" class="outline-4">
<h4 id="org16918ee">Expressions</h4>
<div class="outline-text-4" id="text-org16918ee">
<p>
An expression is syntax that denotes a value. 
</p>

<p>
A <b>name</b> must begin with a letter (a-z or A-Z), and may contain
letters, digits, or underscore characters.
</p>

<p>
Constants can be written in decimal, hexadecimal, or binary:
</p>

<ul class="org-ul">
<li><b>Decimal constants</b> consist of a sequence of digits, with an
optional leading - sign.  Examples: 42 55039 -1</li>

<li><b>Hexadecimal constants</b> are written with a dollar sign $ followed by
four hex digits (0 1 2 3 4 5 6 7 8 9 a b c d e f).  Examples: $0249
$c78a</li>

<li><b>Binary constants</b> are written with a hash sign # followed by any
number of 0 or 1 characters.  You can write fewer than 16 bits; they
will be padded on the left with zeros.  Examples: #1101
#000100000001101</li>
</ul>

<p>
Expressions may contain arithmetic operators + - * /.
</p>
<div style="overflow-x: auto">

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">operand</th>
<th scope="col" class="org-left">operator</th>
<th scope="col" class="org-left">operator</th>
<th scope="col" class="org-left">result</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">fixed</td>
<td class="org-left">+</td>
<td class="org-left">fixed</td>
<td class="org-left">fixed</td>
</tr>

<tr>
<td class="org-left">fixed</td>
<td class="org-left">+</td>
<td class="org-left">relocatable</td>
<td class="org-left">relocatable</td>
</tr>

<tr>
<td class="org-left">relocatable</td>
<td class="org-left">+</td>
<td class="org-left">fixed</td>
<td class="org-left">relocatable</td>
</tr>

<tr>
<td class="org-left">relocatable</td>
<td class="org-left">+</td>
<td class="org-left">relocatable</td>
<td class="org-left">error</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">fixed</td>
<td class="org-left">-</td>
<td class="org-left">fixed</td>
<td class="org-left">fixed</td>
</tr>

<tr>
<td class="org-left">fixed</td>
<td class="org-left">-</td>
<td class="org-left">relocatable</td>
<td class="org-left">relocatable</td>
</tr>

<tr>
<td class="org-left">relocatable</td>
<td class="org-left">-</td>
<td class="org-left">fixed</td>
<td class="org-left">relocatable</td>
</tr>

<tr>
<td class="org-left">relocatable</td>
<td class="org-left">-</td>
<td class="org-left">relocatable</td>
<td class="org-left">fixed</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">fixed</td>
<td class="org-left">*</td>
<td class="org-left">fixed</td>
<td class="org-left">fixed</td>
</tr>

<tr>
<td class="org-left">fixed</td>
<td class="org-left">*</td>
<td class="org-left">relocatable</td>
<td class="org-left">error</td>
</tr>

<tr>
<td class="org-left">relocatable</td>
<td class="org-left">*</td>
<td class="org-left">fixed</td>
<td class="org-left">error</td>
</tr>

<tr>
<td class="org-left">relocatable</td>
<td class="org-left">*</td>
<td class="org-left">relocatable</td>
<td class="org-left">error</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">fixed</td>
<td class="org-left">/</td>
<td class="org-left">fixed</td>
<td class="org-left">fixed</td>
</tr>

<tr>
<td class="org-left">fixed</td>
<td class="org-left">/</td>
<td class="org-left">relocatable</td>
<td class="org-left">error</td>
</tr>

<tr>
<td class="org-left">relocatable</td>
<td class="org-left">/</td>
<td class="org-left">fixed</td>
<td class="org-left">error</td>
</tr>

<tr>
<td class="org-left">relocatable</td>
<td class="org-left">/</td>
<td class="org-left">relocatable</td>
<td class="org-left">error</td>
</tr>
</tbody>
</table>
</div>


<p>
relocatable 
</p>


<p>
An expression can do arithmetic on a local label, but not on an
imported name.  The reason is that arithmetic requires that the value
of the name is known.  That's why an expression like a equ rcd+5 can
be used only after the label rcd is defined: it enables the value of
each name to be calculated during pass 1.  But the values of imported
names are not known at all during assembly; they become defined only
during linking.  Such a value can affect the values of words in the
object code, but not their locations.
</p>

<p>
An expression is assembly language syntax that, when evaluated,
denotes a value (i.e. a 16-bit word).  Evaluation takes place entirely
at assembly time.  Expressions may be labels, constants, or
may be calculated.
</p>
</div>
</div>

<div id="outline-container-orgd265a6b" class="outline-4">
<h4 id="orgd265a6b">Location counter</h4>
<div class="outline-text-4" id="text-orgd265a6b">
<p>
The assembler maintains a variable called the location counter, which
is the address where the next word of object code will be loaded.  The
location counter is a local value.  It is initialized to 0000
Relocatable.
</p>

<p>
When an instruction word or data word is generated, its address is set
to the current value of the location counter, which is then
incremented.
</p>

<p>
The org directive specifies a new value of the location counter.
First the operand of the org statement is evaluated.  This value must
be local (it is an error if the value is external).  The location
counter and its movability are set to the value and movability of the
operand.
</p>
</div>
</div>

<div id="outline-container-orgfe6a65b" class="outline-4">
<h4 id="orgfe6a65b">Attributes</h4>
<div class="outline-text-4" id="text-orgfe6a65b">
<p>
A machine language program consists of words stored in memory at
particular addresses.  A word is just a collection of 16 bits; it has
no type.
</p>

<p>
An assembly language program specifies all the words that comprise a
program.  In principle you could just write out all the words as
numbers, but this is difficult and prone to errors.  Thw whole point
of assembly language is to provide notations that make it easier to
specify these numbers, while retaining total control&#x2014;every single
bit in the object code is determined by the assembly language.
</p>

<p>
A <b>value</b> is a word of 16 bits.  Values do not have types; their type
depends entirely on usage.  Values may be used in generating object
code, either as the displacment field of an RX instruction or as the
operand of a data statement.
</p>

<p>
Every value is either <b>fixed</b> or <b>relocatable</b>.  If a module is
linked, then its relocatable values may be translated, but the fixed
values remain unchanged.
</p>
</div>
</div>
</div>

<div id="outline-container-org400e821" class="outline-3">
<h3 id="org400e821">Code generators</h3>
<div class="outline-text-3" id="text-org400e821">
<p>
Each line of source code is an assembly language statement.  Unlike
higher level languages, assembly language statements are not nested.
There are three kinds of assembly language statement:
</p>

<ul class="org-ul">
<li><i>Comments</i> (blank lines, or lines beginning with ;)</li>
<li><i>Code</i> statements define instructions or constant data</li>
<li>/Directives provide metadata but don't generate any code</li>
</ul>

<p>
An assembly language statement contains one or more fields.  A field
consists of non-space characters (with one exception: a space may
appear in a string literal).  Fields are separated from each other by
one or more white space characters.
</p>

<ul class="org-ul">
<li>Label.  The label field is optional.  If present, the label must be
a name and it must begin in the first character of the line.  If the
first character is a space, then that line has no label.</li>

<li>Operation.  The operation field is an identifier that specifies an
instruction or assembler directive.  It must be preceded by one or
more white space characters.  Every statement (apart from a full
line comment) must have an operation field.</li>

<li>Operands.  The operands field specifies operands for an instruction
or arguments for assembly directives.  There may be several
operands, which must be separated by commas.  Each type of statement
(determined by the operation field) requires a specific syntax for
the operands.  Most instructions and assembler directives require
operands, but some do not.</li>

<li>Comment.  All text that either (1) follows white space after the
operands field, or (2) follows a semicolon (;), is a comment, and is
ignored by the assembler.  If one or more of the other fields
(label, operation, operands) is missing, the comment must be
preceded by a semicolon to prevent it from being interpreted as
operands.  The rule is: all text after a semicolon is a comment, and
all text after white space following operands is a comment.  A
statement where the first non-space character is a semicolon is a
full line comment.  If the statement has no operands, then all text
after the operation field is a comment.  It is good practice always
to begin a comment with a semicolon.</li>
</ul>
</div>

<div id="outline-container-orgc052004" class="outline-4">
<h4 id="orgc052004">Instructions</h4>
<div class="outline-text-4" id="text-orgc052004">
<p>
Assembly language statements generally correspond to the instruction
formats, but there is not an exact correspondence for several reasons:
</p>

<ul class="org-ul">
<li>Sometimes an instruction is written in assembly language with a
field omitted which exists in the machine language code but is
ignored.  For example, the instruction <b>cmp R1,R2</b> generates an RRR
instruction, but the third operand field is omitted because the
instruction requires only one operand, not two.  The assembler sets
the unused operand to 0, but the machine ignores it.  This is called
a "don't care" field in the instruction.</li>

<li>Sometimes two instructions look the same in assembly language but
use different machine language instruction formats.  For example,
<b>add R1,R2,R3</b> and <b>push R1,R2,R3</b> look similar, but <b>add</b> uses the
RRR instruction format and <b>push</b> uses the EXP instruction format.
The reason for this is that there are not enough bits in the op
field to accommodate all the instructions with three register
operands, so an <b>expanding opcode</b> is used.  Thus push is
represented with op=14, indicating EXP format, and the EXP variant
is used for this instruction.</li>

<li>The 4-bit fields are sometimes used to denote a register from the
register file (R3), or a control register (mask), or a constant .
In assembly language the constants are written just as a number
(e.g. shiftl R1,R2,5).  Control registers are written by name rather
than their number in the control register file (e.g. getctl
R3,mask).</li>

<li>Some assembly language statements are <b>pseudoinstructions</b>.  These
are special cases of more general instructions.  For example, <b>and</b>
is a pseudoinstruction which generates a <b>logicf</b> instruction
specialised to perform a logical and.</li>
</ul>

<p>
Table: <b>Assembly language statement formats</b>
</p>

<div style="overflow-x: auto">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">afmt</th>
<th scope="col" class="org-left">operand general form</th>
<th scope="col" class="org-left">example</th>
<th scope="col" class="org-left">notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">RRR</td>
<td class="org-left">Rd,Ra,Rb</td>
<td class="org-left">add R1,R2,R3</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">RR</td>
<td class="org-left">Ra,Rb</td>
<td class="org-left">cmp R1,R2</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">RX</td>
<td class="org-left">Rd,disp[Ra]</td>
<td class="org-left">load R1,xyz[R2]</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">kX</td>
<td class="org-left">k,disp[Ra]</td>
<td class="org-left">jumpc0 6,loop[R2]</td>
<td class="org-left">0 &lt;= k &lt;= 15</td>
</tr>

<tr>
<td class="org-left">RRRk</td>
<td class="org-left">Rd,Ra,Rb,K[Re]</td>
<td class="org-left">save R1,R5,3[R14]</td>
<td class="org-left">0 &lt;= K &lt;= 255</td>
</tr>

<tr>
<td class="org-left">RRk</td>
<td class="org-left">Ra,Rb,k</td>
<td class="org-left">shiftl R1,R2,5</td>
<td class="org-left">0 &lt;= k &lt;= 15</td>
</tr>

<tr>
<td class="org-left">Rkkkk</td>
<td class="org-left">Rd,e,f,g,h</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">RkkRk</td>
<td class="org-left">Ra,j,n,Rb,k</td>
<td class="org-left">extract</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">RC</td>
<td class="org-left">Rc,Rd</td>
<td class="org-left">putctl vect,R4</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>
</div>


<div style="overflow-x: auto">

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Label</th>
<th scope="col" class="org-left">Statement</th>
<th scope="col" class="org-left">Operands</th>
<th scope="col" class="org-left">Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">optname</td>
<td class="org-left">data</td>
<td class="org-left">exprs</td>
<td class="org-left">generate word for each exp</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">RRRop</td>
<td class="org-left">r,r,r</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">RXop</td>
<td class="org-left">r,exp[r]</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">RRop</td>
<td class="org-left">r,r</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">Rop</td>
<td class="org-left">r</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">RRKKop</td>
<td class="org-left">r,r,k,k</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>
</div>



<div style="overflow-x: auto">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Asm</th>
<th scope="col" class="org-left">instruction</th>
<th scope="col" class="org-left">operands</th>
<th scope="col" class="org-left">ML formats</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">RRR</td>
<td class="org-left">add</td>
<td class="org-left">Rd,Ra,Rb</td>
<td class="org-left">RRR</td>
</tr>

<tr>
<td class="org-left">RX</td>
<td class="org-left">lea</td>
<td class="org-left">Rd,disp[Ra]</td>
<td class="org-left">RX</td>
</tr>

<tr>
<td class="org-left">RR</td>
<td class="org-left">inv</td>
<td class="org-left">Rd,Ra</td>
<td class="org-left">RRR (b ignored), RREXP</td>
</tr>

<tr>
<td class="org-left">JX</td>
<td class="org-left">jump</td>
<td class="org-left">disp[Ra]</td>
<td class="org-left">RX (b ignored)</td>
</tr>

<tr>
<td class="org-left">KX</td>
<td class="org-left">jumpc0</td>
<td class="org-left">d,disp[Ra]</td>
<td class="org-left">RX (d is constant)</td>
</tr>

<tr>
<td class="org-left">RRK</td>
<td class="org-left">shiftl</td>
<td class="org-left">Rd,Ra,k</td>
<td class="org-left">EXP</td>
</tr>

<tr>
<td class="org-left">RkkRk</td>
<td class="org-left">extract</td>
<td class="org-left">Rd,e,f,Rg,h</td>
<td class="org-left">EXP</td>
</tr>

<tr>
<td class="org-left">RCEXP</td>
<td class="org-left">getctl</td>
<td class="org-left">Re,Cf</td>
<td class="org-left">EXP</td>
</tr>
</tbody>
</table>

</div>

<p>
An EXP instruction may use the fields op, d, ab, e, f, g, h.  The g
and h fields can be combined into a single 8-bit field gh All EXP
instructions combine the a and b fields into a single 8-bit field
called ab.  Some EXP instructions combine the g and h fields into a
single 8-bit field called gh.  The EXP format has the following
variants.
</p>

<ul class="org-ul">
<li>The RREXP format takes two register operands, which are in the e and
f fields of the second word. The d field of the first word and the g
and h fields of the second word are ignored (the assembler will set
these to 0).  Any RREXP instruction could be reprsented as RRR, but
there are only a few RRR opcodes avaiable, so uncommon instructions
that require two registers are represented as RREXP.  Example:
<b>execute R5,R6</b> is RREXP.</li>

<li>The RCEXP format takes two register operands; the first is a general
register and the second is a control register.  An example of the
operand field is <b>R3,mask</b>.  The operands are in the e and f fields
of the second word.  The d field of the first word and the g and h
fields of the second word are ignored (the assembler will set these
to 0.)  The first operand is an element of the register file (for
example, R4).  The second operand is a control register, which is
specified by a 4-bit number.  In assembly language, we normally
refer to the control registers by name rather than number, to make
it easier to remember which is which.  For example, <b>getctl
R3,status</b> has RCEXP format.</li>

<li>The RRREXP format takes three register operands, which are in the f,
g, and h fields of the second word. An example of the operand field
is $R1,R2,R3*.  The d field of the first word and the e field of the
second word are ignored (the assembler will set these to 0).  The
RRREXP instructions would be a natural fit for the RRR format, but
there are not enough RRR opcodes available, so the EXP format is
used to expand the number of instructions that can be represented.
For example, <b>push R5,R8,R9</b> has RRREXP format.</li>

<li>The RRKEXP format takes two register operands and a 4-bit constant
number.  An example of the operand field is <b>R1,R2,13</b>.  The
register operands are in the f and g fields of the second word, and
constant is in the h field of the second word.  The d field of the
first word and the e field of the second word are ignored (the
assembler sets these to 0).  For example, <b>shiftr R3,R6,7</b> has
RRKEXP format.</li>

<li>The RRKKEXP format takes two register operands and two 4-bit
constant binary number operands.  The register operands are in the e
and f fields of the second word, while the two constants are in the
g and h fields.  The d field of the first word is ignored (the
assembler sets it to 0).</li>

<li>The RRXEXP format takes two register operands as well as a memory
address specified with an 8-bit offset and index register.  Thus
these instructions require three registers to be specified, as well
as the offset.  Thus every bit of both instruction words is needed
to represent an RRXEXP format instruction.  In assembly language,
the memory address is written as <b>offset[Rh]</b> where <b>offset</b> is an
-bit binary number and Rh is a register.  The effective memory
address is <b>offset+Rh</b>. This is similar to ordinary memory
addresses; the only difference is that it uses an 8-bit offset
rather than a 16-bit displacement. For example, <b>save R1,R9,2[R14]</b>
has RRKEXP format.</li>
</ul>

<p>
Expressions, values and relocatables
</p>

<ul class="org-ul">
<li>An expression is syntax: 23, -5, $b23e, struc+5, arrEnd-arrStart</li>
<li>A value denotes a word (it is a number) and is the result of
evaluating an expression</li>
<li>A value is marked as either relocatable or fixed</li>
<li>Expressions may occur in
<ul class="org-ul">
<li>Displacement field of an assembly language statement; the value of
the expression is placed in the displacement field of the
corresponding machine language instruction.</li>
<li>If a displacement value is relocatable, its address is recorded in
the list of addressess of words to be relocated</li>
<li>Right hand side of an equ statement.  The value may be fixed or
relocatable.  The name (the left hand side) is defined as a new
identifier, the definition line is the line containing the equ,
the value is the evaluation of the right hand side, which may be
either fixed or relocatable.  Identifiers used in the expression
on the RHS have the line number included in their usage lines.</li>
<li>But identifiers that appear in an expression (even if relocatable)
are not recorded in the relocation list; only displacements are
placed in the relocation list.</li>
</ul></li>
</ul>
</div>

<ul class="org-ul">
<li><a id="orga2d73f9"></a>Instruction set<br />
<div class="outline-text-5" id="text-orga2d73f9">
<p>
The following sections describe the instructions in groups organized
by their function.  Some of the groups contain instructions with
different formats.  From the programmer's perspective the function is
more important, so these groups are useful in finding the right
instruction to use.  (From the perspective of designing a digital
circuit to impleemnt the architecture, the format is essential.)
</p>
</div>
</li>
</ul>
</div>
<div id="outline-container-org396767e" class="outline-4">
<h4 id="org396767e">Pseudoinstructions</h4>
</div>

<div id="outline-container-org8a7cdea" class="outline-4">
<h4 id="org8a7cdea">data</h4>
<div class="outline-text-4" id="text-org8a7cdea">
<p>
The data statement specifies a sequence of constants to be placed in
consecutive memory locations starting at the location counter, subject
to relocation.  Its argument is a list of one or more 4-digit hex
constants separated by commas.
</p>

<p>
A long block of data can be broken up into several data statements.
Suppose x1, x2, etc are 4-digit hex constants.  Then
</p>

<div class="CodeListing" id="orgfd846c0"><pre>
data  x1,x2,x3,x4,x5,x6
</pre></div>

<p>
is equivalent to
</p>

<div class="CodeListing" id="orgcff694e"><pre>
data x1,x2,x3
data x4,x5,x6
</pre></div>

<p>
Suppose
</p>

<ul class="org-ul">
<li>The module's relocation constant is r</li>
<li>The location counter has been set to c</li>
<li>The i'th constant (counting from 0) in a data statement is x.</li>
</ul>

<p>
Then the linker will set mem[r+c+i] := x.
</p>

<p>
One point to watch out for is that an assembly language data statement
uses $ to indicate that a number is a hex constant (e.g. $03b7) but
the object language data statement requires all numbers to be 4-digit
hex constants, and does not require (or allow) a preceding $ character
</p>
</div>
</div>
</div>

<div id="outline-container-orgcbf1518" class="outline-3">
<h3 id="orgcbf1518">Directives</h3>
<div class="outline-text-3" id="text-orgcbf1518">
<p>
A directive is an assembly language statement that gives further
information about how to translate the program to object code and how
to link the code with other modules.  Directirves specify metadata but
they don't generate an instruction or constant data.
</p>

<div style="overflow-x: auto">

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Statement</th>
<th scope="col" class="org-left">Label</th>
<th scope="col" class="org-left">Operands</th>
<th scope="col" class="org-left">Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">identifier</td>
<td class="org-left">module</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">Define name of module</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">org</td>
<td class="org-left">expression</td>
<td class="org-left">Set location counter</td>
</tr>

<tr>
<td class="org-left">identifier</td>
<td class="org-left">equ</td>
<td class="org-left">expression</td>
<td class="org-left">Define value</td>
</tr>

<tr>
<td class="org-left">identifier</td>
<td class="org-left">import</td>
<td class="org-left">identifier,identifier</td>
<td class="org-left">Import  value  from module</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">export</td>
<td class="org-left">identifier</td>
<td class="org-left">Export values</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-org29456d1" class="outline-4">
<h4 id="org29456d1">module</h4>
<div class="outline-text-4" id="text-org29456d1">
<p>
A program may be organized as a collection of modules, where each
module appears in a separate file.  When several modules are present,
each one needs a unique name.  The <i>module</i> statement declares the
name of the module, which is specified in the label field.  There are
no operands.  The following statement says that this is the object
code for module named <i>abc</i>:
</p>

<div class="CodeListing" id="org01e91d7"><pre>
abc   module 
</pre></div>

<p>
A <i>module</i> statement is optional.  If none is present in a file, the
module is anonymous.  If a file does contain a <i>module</i> statement, it
must be the first statement in the file, although it may be preceded
by comments and blank lines.  It is illegal for a file to contain more
than one <i>module</i> statement.
</p>

<p>
An anonymous module can import other modules, but other modules cannot
import anything exported from an anonymous module.  This means, in
effect, that an anonymous module is useful only as a main program.
</p>

<p>
It is good practice for the main program to have a module statement;
in effect, this is the name of the program as well as the name of the
module.
</p>

<p>
An assembly language file should have a name of the form
basename.asm.txt.  If there is a module statement <i>modname module</i>,
then basename should be <i>modname</i>.  For example, the file
Heapsort.asm.txt might contain the statement <i>Heapsort module</i>.  If
there is no module statement, basename is arbitrary.
</p>
</div>
</div>

<div id="outline-container-orga8beddf" class="outline-4">
<h4 id="orga8beddf">import</h4>
<div class="outline-text-4" id="text-orga8beddf">
<p>
The import statement states that the value of an identifier is defined
in another module.  During the assembly of the module containing the
import, the identifier is given a provisional value of 0, but this
will be replaced by the actual value by the linker.  For example,
</p>

<div class="CodeListing" id="orgf56684f"><pre>
x   import  Mod1,x
y   import  Mod1,abc
</pre></div>

<p>
says that x is a name that can be used in this module, but it is
defined in Mod1; y can be used in this module but it is defined in
Mod1 under the name abc.
</p>
</div>
</div>
<div id="outline-container-org9832b36" class="outline-4">
<h4 id="org9832b36">export</h4>
<div class="outline-text-4" id="text-org9832b36">
<p>
An export statement says that the module is making the value of a
symbol available for use in other modules, which may import it.  The
statement takes two operands: the name being exported and the value,
which must be a 4-digit hex constant.  It makes no difference whether
the name is relocatable, as the linker performs any relocation before
writing the exported value into other modules that import it.
Examples:
</p>

<div class="CodeListing" id="orgb12e750"><pre>
export  haltcode,0
export  fcn,002c
</pre></div>

<p>
The export statement states that the value of an identifier should be
made available for other modules to import.  For example, this module
defines a function and exports it so other modules can import and call
it:
</p>

<div class="CodeListing" id="orgb8f3bd1"><pre>
Mod1     module
         export fcn

fcn      add    R1,R1,R1
         jump   0[R12]
</pre></div>
</div>
</div>
</div>

<div id="outline-container-orgc3b0dc3" class="outline-3">
<h3 id="orgc3b0dc3">Assembly listing</h3>
<div class="outline-text-3" id="text-orgc3b0dc3">
<p>
The first section of the assembly listing shows each line of the
source program.  The line number appears first, followed by the memory
address that the instruction on this line will be placed in.  The
address is given as a 4 digit hexadecimal number, and it is binary
(not two's complement).  Next comes the machine language code
generated by the line of source code.  If the line contains a two-word
instruction, there will be two 4-digit hexadecimal values; for a
one-word instruction there will be one hex number, and if the line
doesn't produce any code these fields will be blank.  After the code,
the original source statement appears.
</p>

<p>
The second section of the assembly listing is the <b>Symbol Table</b>.
This shows each identifier (or "symbol") that appears in the program,
the address allocated for the symbol, the source code line where it
was defined, and the source code lines where it was used.
</p>
</div>
<div id="outline-container-orge788e04" class="outline-4">
<h4 id="orge788e04">equ</h4>
<div class="outline-text-4" id="text-orge788e04">
<div class="CodeListing" id="orgecbee36"><pre>
codeWrite  equ  2
codeRead   equ  1
</pre></div>

<p>
The expression in an equ can calculate the size of an object:
</p>

<div class="CodeListing" id="orga0890b6"><pre>
astart     data 5
           data 9
           data 78
aend
asize      equ  aend-astart
</pre></div>
</div>
</div>

<div id="outline-container-org04c9347" class="outline-4">
<h4 id="org04c9347">reserve</h4>
<div class="outline-text-4" id="text-org04c9347">
<p>
The <code>reserve</code> statement has one operand, which is a numeric constant.
The assembler increments the location counter by the value of the
operand.
</p>

<p>
This can be used to reserve a block of memory, for example
to hold a stack or heap data structure.
</p>

<div class="CodeListing" id="org85a78da"><pre>
asize   equ    100
n       reserve asize
</pre></div>

<p>
If the operand of a <code>reserve</code> statement is a symbol defined by an
<code>equ</code>, that definition must precede the <code>reserve</code> statement.  This is
because pass 1 of the assembler needs to calculate the address of each
code word, and an <code>equ</code> that follows the <code>reserve</code> statement would not
become known until after the size of the <code>reserve</code> is needed.
</p>
</div>
</div>

<div id="outline-container-org29dc424" class="outline-4">
<h4 id="org29dc424">org</h4>
<div class="outline-text-4" id="text-org29dc424">
<p>
The org statement sets the location counter to a specified address.
Subsequent instructions and data will be placed in memory at
contiguous locations starting from that address.
</p>

<div class="CodeListing" id="org1b97f5a"><pre>
org   35     ; subsequent code starts from address 0023
</pre></div>

<p>
The assembler initializes the location counter to 0 before it begins
translating an assembly language module.  Every module begins
implicitly with org 0.
</p>
</div>
</div>
</div>
</div>


<div id="outline-container-sec-linker" class="outline-2">
<h2 id="sec-linker">Object code and linker</h2>
<div class="outline-text-2" id="text-sec-linker">
<p>
Small programs often consist of just one module (or file).  The
assembler translates the assembly language source code into machine
language which is then executed by the processor.
</p>

<p>
However, there are several reasons for breaking up larger programs
into several modules.  It's easier to work with several modules of
reasonable size rather than one gigantic file.  A module may provide
generic services that can be incorporated into many programs.
Programs can be simplified if they use libraries for common tasks,
rather than implementing everything from scratch.  It is faster to
assemble small files than large ones.
</p>

<p>
When a program consists of several modules, each one can be assembled
separately.  However, the resulting machine language is not executable
if it refers to procedures or other values defined in another module.
An instruction in module A cannot refer to a word X in module B unless
it knows the address of X, and when module A is assembled it knows
nothing about module B.
</p>

<p>
To produce an executable program, its modules need to be combined into
a single executable module, with all the addresses resolved.  This is
called <b>linking</b>.
</p>

<p>
Sigma16 supports linking.  The system is designed so that programs
that consist of just one standalone module can be executed directly,
without linking.  This means you can ignore the issues of modules and
linking if you just want to write a andalone program.
</p>
</div>

<div id="outline-container-org52c6c1f" class="outline-3">
<h3 id="org52c6c1f">Object language</h3>
<div class="outline-text-3" id="text-org52c6c1f">
<p>
Object code is expressed in a textual language, so the object code is
readable by a human (at least, by a human who understands machine
language).  For example, binary data is specified using four
hexadecimal characters rather than a word of binary data.
</p>
</div>

<div id="outline-container-orgeeaa58b" class="outline-4">
<h4 id="orgeeaa58b">Object statement syntax</h4>
<div class="outline-text-4" id="text-orgeeaa58b">
<p>
The object language has a simple syntax and only a few types of
statement.  Each object statement is written on one line.  It begins
with a keyword indicating the type of statement, followed by one or
more spaces, followed by an operand field which must not contain any
white space.  The operand field is a comma-separated list of tokens;
each token is either a hex constant or an identifier.
</p>

<ul class="org-ul">
<li>In the object language, hex constants are written as four
characters, using digits 0-9 a-f.  Unlike assembly language, a hex
constant is not preceded by $.  There is no need for this, as all
numbers are written in hex in object code.  Assembly language allows
both hex and decimal numbers so there needs to be a way to tell them
apart.</li>

<li>Identifiers have the same syntax as in assembly language: a string
of letters, digits, and underscore characters, beginning with a
letter.</li>
</ul>

<p>
The object language has seven statements: <code>module</code>, <code>org</code>, <code>data</code>,
<code>import</code>, <code>export</code>, and <code>relocate</code>.  Some of these are related to
corresponding statements in assembly language, but their syntax is
different and in some cases they may contain different information.
</p>
</div>
</div>

<div id="outline-container-orga5970aa" class="outline-4">
<h4 id="orga5970aa">module</h4>
</div>

<div id="outline-container-org72ba6e3" class="outline-4">
<h4 id="org72ba6e3">org</h4>
</div>

<div id="outline-container-org89d076f" class="outline-4">
<h4 id="org89d076f">data</h4>
<div class="outline-text-4" id="text-org89d076f">
<p>
data x0,x1,&#x2026;,x<sub>j-1</sub>
</p>

<p>
Let xs be the list of j words in a data statement, and llc is the linker
location counter.  For each word x, the linker performs:
</p>

<div class="CodeListing" id="org3106bb9"><pre>
mem[llc] := x
llc := llc + 1
</pre></div>
</div>
</div>

<div id="outline-container-orga8fd4c6" class="outline-4">
<h4 id="orga8fd4c6">import</h4>
<div class="outline-text-4" id="text-orga8fd4c6">
<p>
General form
</p>

<div class="CodeListing" id="orgdb99503"><pre>
import  modName,externalName,address,field
</pre></div>

<p>
Examples
</p>

<div class="CodeListing" id="org4494e2a"><pre>
import  Mod2,abc,03c4,dist
import  Mod3,ybit,03be,g
</pre></div>
</div>
</div>

<div id="outline-container-org84c85ed" class="outline-4">
<h4 id="org84c85ed">export</h4>
</div>

<div id="outline-container-org97f9f04" class="outline-4">
<h4 id="org97f9f04">relocate</h4>
<div class="outline-text-4" id="text-org97f9f04">
<p>
The relocate statement specifies a list of addresses of words that
must be relocated.  Suppose the value x is specified in a relocate
statement, and the linker is relocating the module by offset y.  Then
the linker will set mem[x+y] = obj[x]+y.
</p>

<div class="CodeListing" id="orgc755e67"><pre>
relocate hex4,hex4,&#x2026;
</pre></div>



<p>
General form:
</p>

<p>
The relocate statement specifies a list of addresses, which refer to
object code words in the module.  The effect is to add the linker
location counter (llc) to each object code word.
</p>

<p>
code[addr] := code[addr] + llc
</p>

<div class="CodeListing" id="org2a6cf14"><pre>
relocate  addr,addr,&#x2026;,addr
</pre></div>

<p>
Each location is relcated.  The word The addresses 
</p>
</div>
</div>
</div>

<div id="outline-container-org50e7a35" class="outline-3">
<h3 id="org50e7a35">Module metadata</h3>
<div class="outline-text-3" id="text-org50e7a35">
<p>
The assembler and linker create metadata files which enable the
emulator to show the assembly language statement corresponding to the
instruction currently being executed.  The metadata is not part of the
machine language, and the emulator doesn't look at it in order to
execute the program.  It is entirely optional: the emulator can run a
program without any metadata, although without it the emulator cannot
display the current assembly language source statement.  This section
explains how the metadata works and the format of the files.
</p>

<p>
The emulator attempts to show the assembly language source as the
program runs, and it highlights the current and next instruction.  To
do this, the emulator needs to have some information that isn't
present in the object code.  This extra information is supplied in a
separate metadata file produced by the assembler and the linker.
</p>

<p>
An object file foo.obj.txt may have a corresponding metadata file
foo.omd.txt ("object metadata").  An executable file foo.exe.txt may
have a corresponding metadata file foo.xmd.txt ("executable
metadata").  The format of the metadata is identical for object and
executable; the reason for the distinction is that the user might have
a program with main program foo.asm.txt, and later give the executable
the same name foo.  In that case, there will be separate metadata
files for the object and the executable.
</p>

<p>
  The metadata contains the source code in two forms:
plain text and with html tags for highlighting the fields.  In
addition, the metadata contains a mapping from address to source code
line number.
</p>

<p>
The metadata file format is parsed in order to populate several data
structures that enable the emulator to 
The metadata contains the lines of text of the assembly listing.
These lines contain the address, the object code at that address, and
the assembly language source statement.  Each line of the assembly
listing appears t  The emulator displays most
lines of the assembly listing with the same field highlighting
</p>

<p>
A metadata file contains two sections: the ASmap followed by the
source listing text.
A metadata file must have the following contents:
</p>

<p>
$a0,s0,a1,s1,$ $a2,s2, &#x2026;,$ \(a_{n-1},s_{n-1}\)
</p>

<p>
When the pc contains address \(a_i\) then the source statement \(s_i\)
should be displayed.
</p>


<ul class="org-ul">
<li><code>fsmap</code> <i>n</i></li>
<li>comma separated list of <i>n</i> numbers, which may be split into lines</li>
<li><code>source</code> <i>n</i></li>
<li><i>n</i> lines of html giving the assembly listing.  Each line appears
twice: first a "plain" form, followed by a "decorated" form that
contains html span elements for highlighting the fields of the text</li>
</ul>

<p>
Here is an example of a metadata file:
</p>

<div class="CodeListing" id="org6d5574d"><pre>
fasmap 17
14,14,15,15,16,16,17,17,18,19
19,20,20,21,21,22,24
source 32
&lt;span class='ListingHeader'&gt;Line Addr Code Code Source&lt;/span&gt;
&lt;span class='ListingHeader'&gt;Line Addr Code Code Source&lt;/span&gt;
   1 0000            ; Main: test linker
   1 0000           &lt;span class='FIELDLABEL'&gt; &#x2026; &lt;/span&gt;
</pre></div>
</div>
</div>

<div id="outline-container-orgabe1f54" class="outline-3">
<h3 id="orgabe1f54">Linker</h3>
<div class="outline-text-3" id="text-orgabe1f54">
<ul class="org-ul">
<li>GUI: selected module is main program and also receives the
executable.  All other modules are linked, and their object code is
placed after that of the selected module.  It is an error if any
module has not been assembled.  The order of the object code depends
on the order of the modules in the module list, which is essentially
arbitrary, except that the selected module always comes first in the
executable.</li>
</ul>
</div>
</div>

<div id="outline-container-org102d5d9" class="outline-3">
<h3 id="org102d5d9">Booter</h3>
<div class="outline-text-3" id="text-org102d5d9">
</div>
<div id="outline-container-org42447ec" class="outline-4">
<h4 id="org42447ec">Executable code</h4>
<div class="outline-text-4" id="text-org42447ec">
<p>
An executable module is written in the same language as object
modules.  The only difference is that an executable module must
contain only these types of statement: module, data, org.  It is now
allowed to contain any of the following statments: import, export,
relocate.
</p>

<p>
If an assembly language program doesn't contain any import or export
directives, then its object code won't contain any import, export, or
relcate statements.  In this case, the object code is already
executable and does not require linking: it can be booted directly by
the processor.
</p>

<p>
The booter (invoked by clicking the Boot button in the processor page)
reads in the currently selected module and checks to see whether it is
a valid executable module.  If so, it loads the code into the memory.
If not, it indicates that the program cannot be booted.
</p>
</div>
</div>
</div>
</div>


<div id="outline-container-sec-programming" class="outline-2">
<h2 id="sec-programming">Programming</h2>
<div class="outline-text-2" id="text-sec-programming">
</div>

<div id="outline-container-org7b4bb15" class="outline-3">
<h3 id="org7b4bb15">Structure of a program</h3>
<div class="outline-text-3" id="text-org7b4bb15">
<p>
Simple ("static") variabls need to be declared with a data statement,
which also gives an initial value.
</p>

<div class="CodeListing" id="org703e3c6"><pre>
x  data  23
</pre></div>

<p>
This means: allocate a word in memory for x and initialize it to 23.
The data statements should come after the trap instruction that
terminates the program
</p>


<p>
The software conventions are:
</p>
<ul class="org-ul">
<li>R14 - stack pointer</li>
<li>R13 - return address</li>
<li>R12</li>
</ul>
</div>
</div>

<div id="outline-container-org6d26b1e" class="outline-3">
<h3 id="org6d26b1e">How to perform commmon tasks</h3>
<div class="outline-text-3" id="text-org6d26b1e">
</div>
<div id="outline-container-org6cec832" class="outline-4">
<h4 id="org6cec832">Using extract</h4>
<div class="outline-text-4" id="text-org6cec832">
<p>
A special case is to move a Boolean from one place to another.
</p>
<ul class="org-ul">
<li>A Boolean is a bit in a register, so it takes two 4-bit fields to
specify an arbitrary Boolean</li>
<li>Would like to make it easy to implement b := c, where b and c are
arbitrary Booleans</li>
<li>This would require two 4-bit fields for each of b and c, for a total
of four 4-bit fields</li>
<li>The Exp format could accommodate this</li>
<li>But this could also be done using the extract instruction</li>
<li>Therefore it should either be omitted, or else be a pseudo
instruction that generates an extract</li>
</ul>

<p>
The extract instruction is not essential: it can be performed by a
sequence of shift and logic instructions.  However, an extract
instruction is faster than the equivalent sequence of shifts and
logic, and it also makes a program more readable by making the
intention clear.
</p>


<p>
Pseudoinstruction
</p>

<p>
Copy a bit
</p>

<p>
Invert a bit
</p>

<p>
Generate a field mask
</p>

<p>
The field pseudoinstruction loads a word into the destination register
Rd; this word consists of 1 bits in the specified field (g,h) and 0 in
all other bit positions.  This provides a field mask that can be used
with logic instructions for a variety of purposes.
</p>

<ul class="org-ul">
<li>General form: <b>field Rd,g,h</b></li>
<li>Pseudo-instruction:  <b>injecti Rd,R0,g,h</b></li>
<li>Assembler format: RKK</li>
</ul>

<p>
Semantics
</p>
<ul class="org-ul">
<li>Rd.i = 1 for g &lt;= i &lt;- h</li>
<li>Rd.i = 0 for i &lt; g or i &gt; h</li>
</ul>

<p>
Example:
</p>

<div class="CodeListing" id="org9e0a180"><pre>
field   R3,4,  ; R3 := 0fc0
</pre></div>

<p>
Using a field mask
</p>
<ul class="org-ul">
<li>invert it to give negative mask</li>
<li>and R1 with mask to clear bits outside the field</li>
<li>and R1 with negative mask to clear only the field</li>
<li>xor R1 with mask to invert bits in the field</li>
</ul>
</div>
</div>

<div id="outline-container-orga626a3f" class="outline-4">
<h4 id="orga626a3f">Copying one register to another</h4>
<div class="outline-text-4" id="text-orga626a3f">
<p>
Sometimes you want to copy a value from one register to another: R3 :=
R12.  There isn't an instruction specifically for this purpose,
because there is no need: just use the add instruction:
</p>

<div class="CodeListing" id="org4ef3aaf"><pre>
add R3,R12,R0 ; R3 := R12
</pre></div>

<p>
Since R12 + 0 = R12, this copies the value in R12 into R3.
</p>
</div>
</div>
</div>

<div id="outline-container-org9ad6c34" class="outline-3">
<h3 id="org9ad6c34">Compilation</h3>
<div class="outline-text-3" id="text-org9ad6c34">
<p>
There are two ways to handle variables:
</p>

<p>
The statement-by-statement style: Each statement is compiled
independently.  The pattern is: load, arithmetic, store.
Straightforward but inefficient.
</p>

<p>
The register-variable style: Keep variables in registers across a
group of statements.  Don't need as many loads and stores.  More
efficient.  You have to keep track of whether variables are in memory
or a register.  Use comments to show register usage.  Real compilers
use this style.  Use this style if you like the shorter code it
produces.
</p>

<p>
We'll translate the following program fragment to assembly
language, using each style:
</p>

<div class="CodeListing" id="orgd8befd1"><pre>
x = 50;
y = 2*z;
x = x+1+z;
</pre></div>

<p>
Statement-by-statement style
</p>

<div class="CodeListing" id="orgc13eb48"><pre>
; x = 50;
     lea    R1,$0032   ; R1 = 50
     store  R1,x[R0]   ; x = 50

; y = 2*z;
     lea    R1,$0002   ; R1 = 2
     load   R2,z[R0]   ; R2 = z
     mul    R3,R1,R2   ; R3 = 2*z
     store  R3,y[R0]   ; y = 2*z

; x = x+1+z;
     load   R1,x[R0]   ; R1 = x
     lea    R2,1[R0]   ; R2 = 1
     load   R3,z[R0]   ; R3 = z
     add    R4,R1,R2   ; R4 = x+1
     add    R4,R4,R3   ; R4 = x+1+z
     store  R4,x[R0]   ; x = x+1+z
</pre></div>

<p>
Register-variable style
</p>

<div class="CodeListing" id="orga783c05"><pre>
; Usage of registers
;   R1 = x
;   R2 = y
;   R3 = z

; x = 50;
     lea    R1,$0032   ; x = 50
     load   R3,z[R0]   ; R3 = z
     lea    R4,$0002   ; R4 = 2
; y = 2*z;
     mul    R2,R4,R3   ; y = 2*z
; x = x+1+z;
     lea    R4,$0001   ; R4 = 1
     add    R1,R1,R4   ; x = x+1
     add    R1,R1,R3   ; x = x+z
     store  R1,x[R0]   ; move x to memory
     store  R2,y[R0]   ; move y to memory
</pre></div>

<p>
Comparison of the styles
</p>

<p>
Statement by statement.
</p>
<ul class="org-ul">
<li>Each statement is compiled into a separate block of code.</li>
<li>Each statement requires loads, computation, then stores.</li>
<li>A variable may appear in several different registers.</li>
<li>There may be a lot of redundant loading and storing.</li>
<li>The object code corresponds straightforwardly to the source
code, but it may be unnecessarily long.</li>
</ul>

<p>
Register variable
</p>
<ul class="org-ul">
<li>The instructions corresponding to the statemnts are mixed
together.</li>
<li>Some statements are executed entirely in the registers.</li>
<li>A variable is kept in the same register across many
statments.</li>
<li>The use of loads and stores is minimised.</li>
<li>The object code is concise, but it's harder to see how it
corresponds to the source code.</li>
<li>It's possible to have a mixture of the styles: you don't have
to follow one or the other all the time.</li>
</ul>
</div>
</div>

<div id="outline-container-org4ae3cc7" class="outline-3">
<h3 id="org4ae3cc7">Errors: avoiding, finding, and fixing</h3>
</div>


<div id="outline-container-org79b930b" class="outline-3">
<h3 id="org79b930b">Procedure call and return</h3>
<div class="outline-text-3" id="text-org79b930b">
<p>
A common usage of save and restore is to simplify procedure call and
return.  When a procedure is called, store the registers onto the
execution stack when a procedure is called (using save), and then to
load them back from the stack when the procedure is returned
(restore).  Normally, the format of a stack frame has a fixed location
for saving the registers, at a small offset from the beginning of the
frame.  A register called the <i>stack pointer</i> gives the address of the
frame, and the offset for saving the registers is normally a small
value (such as 3 or similar).
</p>
</div>

<div id="outline-container-org95fbb30" class="outline-4">
<h4 id="org95fbb30">Critical regions</h4>
<div class="outline-text-4" id="text-org95fbb30">
<p>
A testset instruction is not semantically equivalent to a load
followed by a store.  Consider this example:
</p>

<div class="CodeListing" id="org91a0e17"><pre>
; (1) testset
     testset   R1,mutex[R0]
</pre></div>

<p>
It is not the same as
</p>

<div class="CodeListing" id="orgfcb6349"><pre>
; (2) sequence of instructions
     load     R1,mutex[R0]
     lea      R2,1[R0]
     store    R2,mutex[R0]
</pre></div>

<p>
The essential difference is that (1) executes as an atomic operation,
but (2) does not, and this could lead to errors in mutual exclusion,
which could lead in turn to fatal errors, crashes, and security
violations.
</p>

<p>
Consider, for example, a situation where two processes are sharing
mutex to control access to a critical retion.
</p>

<p>
  an interrupt could occor after the
load and before the store.  Suppose, for example, that initially mutex
= 0 and the sequence  is executed.
Another process could be performing a similar sequence of instructions
on the same mutex variable.
</p>
</div>
</div>

<div id="outline-container-org1404c7c" class="outline-4">
<h4 id="org1404c7c">Robust programming</h4>
<div class="outline-text-4" id="text-org1404c7c">
<p>
*Use a systematic programming process
</p>

<ul class="org-ul">
<li>Start with a high level algorithm</li>
<li>Then translate that to the low level ("if b then goto label") form</li>
<li>Translate the low level to assembly language, keeping the higher
level versions as comments</li>
</ul>

<p>
<b>Use comments both to develop the program and to document it</b>
</p>

<ul class="org-ul">
<li>Write the comments first, as you develop the program.  There should
already be some good comments (e.g. the algorithm) before any
instructions at all have been written.</li>
<li>Don't fall into the trap of hacking out instructions and then adding
comments later: this loses the benefits that documention offers as
you're writing the code.</li>
</ul>

<p>
<b>How to write good comments</b>
</p>

<ul class="org-ul">
<li>Keep the high level and low level algorithms as comments</li>
<li>Comment each instruction</li>
<li>Use the comments to explain what your program is doing, not to
explain what an instruction does.</li>
<li>Assume that the reader already knows the language, but not the
details of your program.</li>
</ul>
</div>
</div>

<div id="outline-container-org7aaebad" class="outline-4">
<h4 id="org7aaebad">Error messages</h4>
</div>

<div id="outline-container-org14b33de" class="outline-4">
<h4 id="org14b33de">Runtime debugging</h4>
<div class="outline-text-4" id="text-org14b33de">
<p>
<b>What if an instruction doesn't do what you expected?</b>
</p>

<ul class="org-ul">
<li>Execute the program to the point where the mysterious instruction is
about to be executed, but has not yet executed.  (To do this, you
can step through the program, or set a breakpoint.)</li>

<li>Make sure you know what the instruction is supposed to do (check the
User Guide).</li>

<li>Looking at the state of the registers and memory, carefully predict
what you expect the instruction to do.</li>

<li>Execute the one instruction (click Step) and compare the state of
the machine with your prediction.</li>

<li>Make sure the instruction has not been modified in memory.  Compare
the machine language produced by the assembler with the <b>current</b>
contents of the word or words in memory where the instruction is
located.</li>
</ul>
</div>
</div>

<div id="outline-container-org43c2298" class="outline-4">
<h4 id="org43c2298">Breakpoints</h4>
<div class="outline-text-4" id="text-org43c2298">
<p>
<b>(Note: the breakpoint system is not fully implemented yet; the
following describes a temporary breakpoint facility.)</b>
</p>

<p>
A breakpoint is the address of an instruction; when the machine is
about to execute that instruction (i.e. when the pc contains that
address) the emulator will halt execution, enabling the programmer to
examine the state of registers and memory.  To set a breakpoint, click
Breakpoint and enter the instruction address you want to stop at in
the dialogue box.  There are several control buttons.  Refresh means
"read the contents of the text in the box, which must be a $ followed
by a 4 hex digit address".  Whenever you change the text, you should
click Refresh.  The Enable button toggles the breakpoint on and off.
The Close button hides the Breakpoint dialogue box.  Here's an
example.  Suppose you want to stop execution of a program at address
00f6:
</p>

<ul class="org-ul">
<li>Click Breakpoint</li>
<li>Enter $00f6</li>
<li>Click Refresh</li>
<li>Click Enable</li>
<li>Click Close</li>
<li>Click Run</li>
</ul>

<p>
The execution will run until the pc becomes equal to 00f6
and will then stop.
</p>

<p>
Click Refresh, then Enable, then
Close.  Then click Run, and the emulator will run at full speed until
the pc reaches the specified value; then it will stop so you can
examine the state of the machine.
</p>
</div>
</div>
</div>
</div>


<div id="outline-container-org5ba0053" class="outline-2">
<h2 id="org5ba0053">Installation</h2>
<div class="outline-text-2" id="text-org5ba0053">
<p>
You can run most of Sigma16 in a web browser &#x2013; there's nothing to
download, nothing to install.  Visit the Sigma16 Home Page in your
browser:
</p>

<div style="overflow-x: auto">
<p>
[Sigma16 home page](<a href="https://jtod.github.io/home/Sigma16/">https://jtod.github.io/home/Sigma16/</a>)
</p>
</div>

<p>
Click on the link to launch the app.  It will run in your browser; you
don't have to install anything.  The Home page also contains links to
the source code and further information about the project.
</p>
</div>

<div id="outline-container-org4c90195" class="outline-3">
<h3 id="org4c90195">Command line tools</h3>
<div class="outline-text-3" id="text-org4c90195">
<p>
Sigma16 also contains some advanced features that use the command
line in a shell.  These features include text commands for
assembling and linking programs, and for running the circuit
simulator.  These features require some software installation.  In
addition, building Sigma16 from soure requires some additional
software that must be installed.  All of the software required is
free and open source, and all of it runs on Windows, Macintosh, and
Gnu/Linux.
</p>
</div>

<div id="outline-container-org485ea6f" class="outline-4">
<h4 id="org485ea6f">node and npm</h4>
</div>

<div id="outline-container-org1b5aa04" class="outline-4">
<h4 id="org1b5aa04">Configuring the shell</h4>
<div class="outline-text-4" id="text-org1b5aa04">
<p>
Shell running bash
</p>

<p>
Add the following to your .bashrc file, but replace <i>Users</i> yourlogin/
Documents/ path/ to/ with your own file location.  In a bash shell
running on cygwin, try <i>Users</i> yourlogin.
</p>

<div class="CodeListing" id="org57d8d91"><pre>
SIGMA16=/Users/yourlogin/Documents/path/to/SigmaProject/Sigma16
export SIGMA16
alias helloworld="node ${SIGMA16}/app/helloworld.js"
</pre></div>
</div>
</div>

<div id="outline-container-org314cc55" class="outline-4">
<h4 id="org314cc55">Testing the installation</h4>
<div class="outline-text-4" id="text-org314cc55">
<div class="CodeListing" id="orgc06053d"><pre>
$ node &#x2013;version
v16.5.0
</pre></div>
</div>
</div>

<div id="outline-container-orgb282431" class="outline-4">
<h4 id="orgb282431">Building Sigma16</h4>
<div class="outline-text-4" id="text-orgb282431">
<p>
The Web version of Sigma16 contains several files that need to be
built from source.  Of course, if you launch the app from the Sigma16
Home Page you don't need to worry about that: you get a fully-built
version.
</p>

<p>
Use emacs to build *.html from source *.org
</p>

<div class="CodeListing" id="org155b122"><pre>
^C ^E h h
</pre></div>

<div class="CodeListing" id="org252bb36"><pre>
$ npm install -g wabt
$ wat2wasm emcore.wat &#x2013;enable-threads
</pre></div>
</div>
</div>
</div>
</div>


<div id="outline-container-sec-about-sigma16" class="outline-2">
<h2 id="sec-about-sigma16">About Sigma16</h2>
<div class="outline-text-2" id="text-sec-about-sigma16">
<p>
build tag 2
</p>
</div>

<div id="outline-container-orgbf9a992" class="outline-3">
<h3 id="orgbf9a992">Copyright and license</h3>
<div class="outline-text-3" id="text-orgbf9a992">
<p>
The architecture, software tools, and documentation were designed,
implemented, and written by John O'Donnell.  Contact email:
john.t.odonnell9@gmail.com
</p>

<p>
Copyright (C) 2020, 2021 John T. O'Donnell
</p>

<p>
License: GNU GPL Version 3 or later.  The full text of the GPL-3
license is given below.
</p>

<p>
Sigma16 is free software: you can redistribute it and/or modify it
under the terms of the GNU General Public License as published by the
Free Software Foundation, either version 3 of the License, or (at your
option) any later version.  Sigma16 is distributed in the hope that it
will be useful, but WITHOUT ANY WARRANTY; without even the implied
warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See
the GNU General Public License for more details.  You should have
received a copy of the GNU General Public License along with Sigma16.
If not, see
<a href="https://www.gnu.org/licenses/">www. gnu. org/ licenses</a>.
</p>

<div style="overflow-x: auto">
<p>
<a href="https://www.gnu.org/licenses/">https://www.gnu.org/licenses/</a>.
</p>
</div>
</div>
</div>

<div id="outline-container-org5b9ba44" class="outline-3">
<h3 id="org5b9ba44">In case of problems</h3>
<div class="outline-text-3" id="text-org5b9ba44">
<p>
If you encounter a problem with the app, please file a bug report.  It
is essential in a bug report (for any software, not just Sigma16) to
provide as much as possible of the following information.
</p>

<ul class="org-ul">
<li>State what version of the software you are running.  This is visible
in the Welcome page, as well as the User Guide and the Options page.</li>

<li>State what browser and operating system you are using.  There are
some incompatibilities between Chrome, Firefox, Edge, and Safari, as
well as differences between operating systems.</li>

<li>Describe what the problem was.</li>

<li>Provide the source code of the assembly language program you are
running.</li>

<li>If possible, provide some photos or screen shots showing the app at
the point where the problem arose.  Smartphone photos are fine.  Try
to show the processor display, including the registers.</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-org29d8d55" class="outline-2">
<h2 id="org29d8d55">License</h2>
<div class="outline-text-2" id="text-org29d8d55">
<p>
GNU GENERAL PUBLIC LICENSE
  Version 3, 29 June 2007
</p>

<p>
Copyright (C) 2007 Free Software Foundation, Inc. <a href="https://fsf.org/">https://fsf.org/</a>
Everyone is permitted to copy and distribute verbatim copies
of this license document, but changing it is not allowed.
</p>

<p>
Preamble
</p>

<p>
  The GNU General Public License is a free, copyleft license for
software and other kinds of works.
</p>

<p>
  The licenses for most software and other practical works are designed
to take away your freedom to share and change the works.  By contrast,
the GNU General Public License is intended to guarantee your freedom to
share and change all versions of a program&#x2013;to make sure it remains free
software for all its users.  We, the Free Software Foundation, use the
GNU General Public License for most of our software; it applies also to
any other work released this way by its authors.  You can apply it to
your programs, too.
</p>

<p>
  When we speak of free software, we are referring to freedom, not
price.  Our General Public Licenses are designed to make sure that you
have the freedom to distribute copies of free software (and charge for
them if you wish), that you receive source code or can get it if you
want it, that you can change the software or use pieces of it in new
free programs, and that you know you can do these things.
</p>

<p>
  To protect your rights, we need to prevent others from denying you
these rights or asking you to surrender the rights.  Therefore, you have
certain responsibilities if you distribute copies of the software, or if
you modify it: responsibilities to respect the freedom of others.
</p>

<p>
  For example, if you distribute copies of such a program, whether
gratis or for a fee, you must pass on to the recipients the same
freedoms that you received.  You must make sure that they, too, receive
or can get the source code.  And you must show them these terms so they
know their rights.
</p>

<p>
  Developers that use the GNU GPL protect your rights with two steps:
(1) assert copyright on the software, and (2) offer you this License
giving you legal permission to copy, distribute and/or modify it.
</p>

<p>
  For the developers' and authors' protection, the GPL clearly explains
that there is no warranty for this free software.  For both users' and
authors' sake, the GPL requires that modified versions be marked as
changed, so that their problems will not be attributed erroneously to
authors of previous versions.
</p>

<p>
  Some devices are designed to deny users access to install or run
modified versions of the software inside them, although the manufacturer
can do so.  This is fundamentally incompatible with the aim of
protecting users' freedom to change the software.  The systematic
pattern of such abuse occurs in the area of products for individuals to
use, which is precisely where it is most unacceptable.  Therefore, we
have designed this version of the GPL to prohibit the practice for those
products.  If such problems arise substantially in other domains, we
stand ready to extend this provision to those domains in future versions
of the GPL, as needed to protect the freedom of users.
</p>

<p>
  Finally, every program is threatened constantly by software patents.
States should not allow patents to restrict development and use of
software on general-purpose computers, but in those that do, we wish to
avoid the special danger that patents applied to a free program could
make it effectively proprietary.  To prevent this, the GPL assures that
patents cannot be used to render the program non-free.
</p>

<p>
  The precise terms and conditions for copying, distribution and
modification follow.
</p>

<p>
TERMS AND CONDITIONS
</p>

<ol class="org-ol">
<li>Definitions.</li>
</ol>

<p>
"This License" refers to version 3 of the GNU General Public License.
</p>

<p>
  "Copyright" also means copyright-like laws that apply to other kinds of
works, such as semiconductor masks.
</p>

<p>
  "The Program" refers to any copyrightable work licensed under this
License.  Each licensee is addressed as "you".  "Licensees" and
"recipients" may be individuals or organizations.
</p>

<p>
  To "modify" a work means to copy from or adapt all or part of the work
in a fashion requiring copyright permission, other than the making of an
exact copy.  The resulting work is called a "modified version" of the
earlier work or a work "based on" the earlier work.
</p>

<p>
  A "covered work" means either the unmodified Program or a work based
on the Program.
</p>

<p>
  To "propagate" a work means to do anything with it that, without
permission, would make you directly or secondarily liable for
infringement under applicable copyright law, except executing it on a
computer or modifying a private copy.  Propagation includes copying,
distribution (with or without modification), making available to the
public, and in some countries other activities as well.
</p>

<p>
  To "convey" a work means any kind of propagation that enables other
parties to make or receive copies.  Mere interaction with a user through
a computer network, with no transfer of a copy, is not conveying.
</p>

<p>
  An interactive user interface displays "Appropriate Legal Notices"
to the extent that it includes a convenient and prominently visible
feature that (1) displays an appropriate copyright notice, and (2)
tells the user that there is no warranty for the work (except to the
extent that warranties are provided), that licensees may convey the
work under this License, and how to view a copy of this License.  If
the interface presents a list of user commands or options, such as a
menu, a prominent item in the list meets this criterion.
</p>

<ol class="org-ol">
<li>Source Code.</li>
</ol>

<p>
  The "source code" for a work means the preferred form of the work
for making modifications to it.  "Object code" means any non-source
form of a work.
</p>

<p>
  A "Standard Interface" means an interface that either is an official
standard defined by a recognized standards body, or, in the case of
interfaces specified for a particular programming language, one that
is widely used among developers working in that language.
</p>

<p>
  The "System Libraries" of an executable work include anything, other
than the work as a whole, that (a) is included in the normal form of
packaging a Major Component, but which is not part of that Major
Component, and (b) serves only to enable use of the work with that
Major Component, or to implement a Standard Interface for which an
implementation is available to the public in source code form.  A
"Major Component", in this context, means a major essential component
(kernel, window system, and so on) of the specific operating system
(if any) on which the executable work runs, or a compiler used to
produce the work, or an object code interpreter used to run it.
</p>

<p>
  The "Corresponding Source" for a work in object code form means all
the source code needed to generate, install, and (for an executable
work) run the object code and to modify the work, including scripts to
control those activities.  However, it does not include the work's
System Libraries, or general-purpose tools or generally available free
programs which are used unmodified in performing those activities but
which are not part of the work.  For example, Corresponding Source
includes interface definition files associated with source files for
the work, and the source code for shared libraries and dynamically
linked subprograms that the work is specifically designed to require,
such as by intimate data communication or control flow between those
subprograms and other parts of the work.
</p>

<p>
  The Corresponding Source need not include anything that users
can regenerate automatically from other parts of the Corresponding
Source.
</p>

<p>
  The Corresponding Source for a work in source code form is that
same work.
</p>

<ol class="org-ol">
<li>Basic Permissions.</li>
</ol>

<p>
  All rights granted under this License are granted for the term of
copyright on the Program, and are irrevocable provided the stated
conditions are met.  This License explicitly affirms your unlimited
permission to run the unmodified Program.  The output from running a
covered work is covered by this License only if the output, given its
content, constitutes a covered work.  This License acknowledges your
rights of fair use or other equivalent, as provided by copyright law.
</p>

<p>
  You may make, run and propagate covered works that you do not
convey, without conditions so long as your license otherwise remains
in force.  You may convey covered works to others for the sole purpose
of having them make modifications exclusively for you, or provide you
with facilities for running those works, provided that you comply with
the terms of this License in conveying all material for which you do
not control copyright.  Those thus making or running the covered works
for you must do so exclusively on your behalf, under your direction
and control, on terms that prohibit them from making any copies of
your copyrighted material outside their relationship with you.
</p>

<p>
  Conveying under any other circumstances is permitted solely under
the conditions stated below.  Sublicensing is not allowed; section 10
makes it unnecessary.
</p>

<ol class="org-ol">
<li>Protecting Users' Legal Rights From Anti-Circumvention Law.</li>
</ol>

<p>
  No covered work shall be deemed part of an effective technological
measure under any applicable law fulfilling obligations under article
11 of the WIPO copyright treaty adopted on 20 December 1996, or
similar laws prohibiting or restricting circumvention of such
measures.
</p>

<p>
  When you convey a covered work, you waive any legal power to forbid
circumvention of technological measures to the extent such circumvention
is effected by exercising rights under this License with respect to
the covered work, and you disclaim any intention to limit operation or
modification of the work as a means of enforcing, against the work's
users, your or third parties' legal rights to forbid circumvention of
technological measures.
</p>

<ol class="org-ol">
<li>Conveying Verbatim Copies.</li>
</ol>

<p>
  You may convey verbatim copies of the Program's source code as you
receive it, in any medium, provided that you conspicuously and
appropriately publish on each copy an appropriate copyright notice;
keep intact all notices stating that this License and any
non-permissive terms added in accord with section 7 apply to the code;
keep intact all notices of the absence of any warranty; and give all
recipients a copy of this License along with the Program.
</p>

<p>
  You may charge any price or no price for each copy that you convey,
and you may offer support or warranty protection for a fee.
</p>

<ol class="org-ol">
<li>Conveying Modified Source Versions.</li>
</ol>

<p>
  You may convey a work based on the Program, or the modifications to
produce it from the Program, in the form of source code under the
terms of section 4, provided that you also meet all of these conditions:
</p>

<p>
a) The work must carry prominent notices stating that you modified
it, and giving a relevant date.
</p>

<p>
b) The work must carry prominent notices stating that it is
released under this License and any conditions added under section
</p>
<ol class="org-ol">
<li>This requirement modifies the requirement in section 4 to</li>
</ol>
<p>
"keep intact all notices".
</p>

<p>
c) You must license the entire work, as a whole, under this
License to anyone who comes into possession of a copy.  This
License will therefore apply, along with any applicable section 7
additional terms, to the whole of the work, and all its parts,
regardless of how they are packaged.  This License gives no
permission to license the work in any other way, but it does not
invalidate such permission if you have separately received it.
</p>

<p>
d) If the work has interactive user interfaces, each must display
Appropriate Legal Notices; however, if the Program has interactive
interfaces that do not display Appropriate Legal Notices, your
work need not make them do so.
</p>

<p>
  A compilation of a covered work with other separate and independent
works, which are not by their nature extensions of the covered work,
and which are not combined with it such as to form a larger program,
in or on a volume of a storage or distribution medium, is called an
"aggregate" if the compilation and its resulting copyright are not
used to limit the access or legal rights of the compilation's users
beyond what the individual works permit.  Inclusion of a covered work
in an aggregate does not cause this License to apply to the other
parts of the aggregate.
</p>

<ol class="org-ol">
<li>Conveying Non-Source Forms.</li>
</ol>

<p>
  You may convey a covered work in object code form under the terms
of sections 4 and 5, provided that you also convey the
machine-readable Corresponding Source under the terms of this License,
in one of these ways:
</p>

<p>
a) Convey the object code in, or embodied in, a physical product
(including a physical distribution medium), accompanied by the
Corresponding Source fixed on a durable physical medium
customarily used for software interchange.
</p>

<p>
b) Convey the object code in, or embodied in, a physical product
(including a physical distribution medium), accompanied by a
written offer, valid for at least three years and valid for as
long as you offer spare parts or customer support for that product
model, to give anyone who possesses the object code either (1) a
copy of the Corresponding Source for all the software in the
product that is covered by this License, on a durable physical
medium customarily used for software interchange, for a price no
more than your reasonable cost of physically performing this
conveying of source, or (2) access to copy the
Corresponding Source from a network server at no charge.
</p>

<p>
c) Convey individual copies of the object code with a copy of the
written offer to provide the Corresponding Source.  This
alternative is allowed only occasionally and noncommercially, and
only if you received the object code with such an offer, in accord
with subsection 6b.
</p>

<p>
d) Convey the object code by offering access from a designated
place (gratis or for a charge), and offer equivalent access to the
Corresponding Source in the same way through the same place at no
further charge.  You need not require recipients to copy the
Corresponding Source along with the object code.  If the place to
copy the object code is a network server, the Corresponding Source
may be on a different server (operated by you or a third party)
that supports equivalent copying facilities, provided you maintain
clear directions next to the object code saying where to find the
Corresponding Source.  Regardless of what server hosts the
Corresponding Source, you remain obligated to ensure that it is
available for as long as needed to satisfy these requirements.
</p>

<p>
e) Convey the object code using peer-to-peer transmission, provided
you inform other peers where the object code and Corresponding
Source of the work are being offered to the general public at no
charge under subsection 6d.
</p>

<p>
  A separable portion of the object code, whose source code is excluded
from the Corresponding Source as a System Library, need not be
included in conveying the object code work.
</p>

<p>
  A "User Product" is either (1) a "consumer product", which means any
tangible personal property which is normally used for personal, family,
or household purposes, or (2) anything designed or sold for incorporation
into a dwelling.  In determining whether a product is a consumer product,
doubtful cases shall be resolved in favor of coverage.  For a particular
product received by a particular user, "normally used" refers to a
typical or common use of that class of product, regardless of the status
of the particular user or of the way in which the particular user
actually uses, or expects or is expected to use, the product.  A product
is a consumer product regardless of whether the product has substantial
commercial, industrial or non-consumer uses, unless such uses represent
the only significant mode of use of the product.
</p>

<p>
  "Installation Information" for a User Product means any methods,
procedures, authorization keys, or other information required to install
and execute modified versions of a covered work in that User Product from
a modified version of its Corresponding Source.  The information must
suffice to ensure that the continued functioning of the modified object
code is in no case prevented or interfered with solely because
modification has been made.
</p>

<p>
  If you convey an object code work under this section in, or with, or
specifically for use in, a User Product, and the conveying occurs as
part of a transaction in which the right of possession and use of the
User Product is transferred to the recipient in perpetuity or for a
fixed term (regardless of how the transaction is characterized), the
Corresponding Source conveyed under this section must be accompanied
by the Installation Information.  But this requirement does not apply
if neither you nor any third party retains the ability to install
modified object code on the User Product (for example, the work has
been installed in ROM).
</p>

<p>
  The requirement to provide Installation Information does not include a
requirement to continue to provide support service, warranty, or updates
for a work that has been modified or installed by the recipient, or for
the User Product in which it has been modified or installed.  Access to a
network may be denied when the modification itself materially and
adversely affects the operation of the network or violates the rules and
protocols for communication across the network.
</p>

<p>
  Corresponding Source conveyed, and Installation Information provided,
in accord with this section must be in a format that is publicly
documented (and with an implementation available to the public in
source code form), and must require no special password or key for
unpacking, reading or copying.
</p>

<ol class="org-ol">
<li>Additional Terms.</li>
</ol>

<p>
  "Additional permissions" are terms that supplement the terms of this
License by making exceptions from one or more of its conditions.
Additional permissions that are applicable to the entire Program shall
be treated as though they were included in this License, to the extent
that they are valid under applicable law.  If additional permissions
apply only to part of the Program, that part may be used separately
under those permissions, but the entire Program remains governed by
this License without regard to the additional permissions.
</p>

<p>
  When you convey a copy of a covered work, you may at your option
remove any additional permissions from that copy, or from any part of
it.  (Additional permissions may be written to require their own
removal in certain cases when you modify the work.)  You may place
additional permissions on material, added by you to a covered work,
for which you have or can give appropriate copyright permission.
</p>

<p>
  Notwithstanding any other provision of this License, for material you
add to a covered work, you may (if authorized by the copyright holders of
that material) supplement the terms of this License with terms:
</p>

<p>
a) Disclaiming warranty or limiting liability differently from the
terms of sections 15 and 16 of this License; or
</p>

<p>
b) Requiring preservation of specified reasonable legal notices or
author attributions in that material or in the Appropriate Legal
Notices displayed by works containing it; or
</p>

<p>
c) Prohibiting misrepresentation of the origin of that material, or
requiring that modified versions of such material be marked in
reasonable ways as different from the original version; or
</p>

<p>
d) Limiting the use for publicity purposes of names of licensors or
authors of the material; or
</p>

<p>
e) Declining to grant rights under trademark law for use of some
trade names, trademarks, or service marks; or
</p>

<p>
f) Requiring indemnification of licensors and authors of that
material by anyone who conveys the material (or modified versions of
it) with contractual assumptions of liability to the recipient, for
any liability that these contractual assumptions directly impose on
those licensors and authors.
</p>

<p>
  All other non-permissive additional terms are considered "further
restrictions" within the meaning of section 10.  If the Program as you
received it, or any part of it, contains a notice stating that it is
governed by this License along with a term that is a further
restriction, you may remove that term.  If a license document contains
a further restriction but permits relicensing or conveying under this
License, you may add to a covered work material governed by the terms
of that license document, provided that the further restriction does
not survive such relicensing or conveying.
</p>

<p>
  If you add terms to a covered work in accord with this section, you
must place, in the relevant source files, a statement of the
additional terms that apply to those files, or a notice indicating
where to find the applicable terms.
</p>

<p>
  Additional terms, permissive or non-permissive, may be stated in the
form of a separately written license, or stated as exceptions;
the above requirements apply either way.
</p>

<ol class="org-ol">
<li>Termination.</li>
</ol>

<p>
  You may not propagate or modify a covered work except as expressly
provided under this License.  Any attempt otherwise to propagate or
modify it is void, and will automatically terminate your rights under
this License (including any patent licenses granted under the third
paragraph of section 11).
</p>

<p>
  However, if you cease all violation of this License, then your
license from a particular copyright holder is reinstated (a)
provisionally, unless and until the copyright holder explicitly and
finally terminates your license, and (b) permanently, if the copyright
holder fails to notify you of the violation by some reasonable means
prior to 60 days after the cessation.
</p>

<p>
  Moreover, your license from a particular copyright holder is
reinstated permanently if the copyright holder notifies you of the
violation by some reasonable means, this is the first time you have
received notice of violation of this License (for any work) from that
copyright holder, and you cure the violation prior to 30 days after
your receipt of the notice.
</p>

<p>
  Termination of your rights under this section does not terminate the
licenses of parties who have received copies or rights from you under
this License.  If your rights have been terminated and not permanently
reinstated, you do not qualify to receive new licenses for the same
material under section 10.
</p>

<ol class="org-ol">
<li>Acceptance Not Required for Having Copies.</li>
</ol>

<p>
  You are not required to accept this License in order to receive or
run a copy of the Program.  Ancillary propagation of a covered work
occurring solely as a consequence of using peer-to-peer transmission
to receive a copy likewise does not require acceptance.  However,
nothing other than this License grants you permission to propagate or
modify any covered work.  These actions infringe copyright if you do
not accept this License.  Therefore, by modifying or propagating a
covered work, you indicate your acceptance of this License to do so.
</p>

<ol class="org-ol">
<li>Automatic Licensing of Downstream Recipients.</li>
</ol>

<p>
  Each time you convey a covered work, the recipient automatically
receives a license from the original licensors, to run, modify and
propagate that work, subject to this License.  You are not responsible
for enforcing compliance by third parties with this License.
</p>

<p>
  An "entity transaction" is a transaction transferring control of an
organization, or substantially all assets of one, or subdividing an
organization, or merging organizations.  If propagation of a covered
work results from an entity transaction, each party to that
transaction who receives a copy of the work also receives whatever
licenses to the work the party's predecessor in interest had or could
give under the previous paragraph, plus a right to possession of the
Corresponding Source of the work from the predecessor in interest, if
the predecessor has it or can get it with reasonable efforts.
</p>

<p>
  You may not impose any further restrictions on the exercise of the
rights granted or affirmed under this License.  For example, you may
not impose a license fee, royalty, or other charge for exercise of
rights granted under this License, and you may not initiate litigation
(including a cross-claim or counterclaim in a lawsuit) alleging that
any patent claim is infringed by making, using, selling, offering for
sale, or importing the Program or any portion of it.
</p>

<ol class="org-ol">
<li>Patents.</li>
</ol>

<p>
  A "contributor" is a copyright holder who authorizes use under this
License of the Program or a work on which the Program is based.  The
work thus licensed is called the contributor's "contributor version".
</p>

<p>
  A contributor's "essential patent claims" are all patent claims
owned or controlled by the contributor, whether already acquired or
hereafter acquired, that would be infringed by some manner, permitted
by this License, of making, using, or selling its contributor version,
but do not include claims that would be infringed only as a
consequence of further modification of the contributor version.  For
purposes of this definition, "control" includes the right to grant
patent sublicenses in a manner consistent with the requirements of
this License.
</p>

<p>
  Each contributor grants you a non-exclusive, worldwide, royalty-free
patent license under the contributor's essential patent claims, to
make, use, sell, offer for sale, import and otherwise run, modify and
propagate the contents of its contributor version.
</p>

<p>
  In the following three paragraphs, a "patent license" is any express
agreement or commitment, however denominated, not to enforce a patent
(such as an express permission to practice a patent or covenant not to
sue for patent infringement).  To "grant" such a patent license to a
party means to make such an agreement or commitment not to enforce a
patent against the party.
</p>

<p>
  If you convey a covered work, knowingly relying on a patent license,
and the Corresponding Source of the work is not available for anyone
to copy, free of charge and under the terms of this License, through a
publicly available network server or other readily accessible means,
then you must either (1) cause the Corresponding Source to be so
available, or (2) arrange to deprive yourself of the benefit of the
patent license for this particular work, or (3) arrange, in a manner
consistent with the requirements of this License, to extend the patent
license to downstream recipients.  "Knowingly relying" means you have
actual knowledge that, but for the patent license, your conveying the
covered work in a country, or your recipient's use of the covered work
in a country, would infringe one or more identifiable patents in that
country that you have reason to believe are valid.
</p>

<p>
  If, pursuant to or in connection with a single transaction or
arrangement, you convey, or propagate by procuring conveyance of, a
covered work, and grant a patent license to some of the parties
receiving the covered work authorizing them to use, propagate, modify
or convey a specific copy of the covered work, then the patent license
you grant is automatically extended to all recipients of the covered
work and works based on it.
</p>

<p>
  A patent license is "discriminatory" if it does not include within
the scope of its coverage, prohibits the exercise of, or is
conditioned on the non-exercise of one or more of the rights that are
specifically granted under this License.  You may not convey a covered
work if you are a party to an arrangement with a third party that is
in the business of distributing software, under which you make payment
to the third party based on the extent of your activity of conveying
the work, and under which the third party grants, to any of the
parties who would receive the covered work from you, a discriminatory
patent license (a) in connection with copies of the covered work
conveyed by you (or copies made from those copies), or (b) primarily
for and in connection with specific products or compilations that
contain the covered work, unless you entered into that arrangement,
or that patent license was granted, prior to 28 March 2007.
</p>

<p>
  Nothing in this License shall be construed as excluding or limiting
any implied license or other defenses to infringement that may
otherwise be available to you under applicable patent law.
</p>

<ol class="org-ol">
<li>No Surrender of Others' Freedom.</li>
</ol>

<p>
  If conditions are imposed on you (whether by court order, agreement or
otherwise) that contradict the conditions of this License, they do not
excuse you from the conditions of this License.  If you cannot convey a
covered work so as to satisfy simultaneously your obligations under this
License and any other pertinent obligations, then as a consequence you may
not convey it at all.  For example, if you agree to terms that obligate you
to collect a royalty for further conveying from those to whom you convey
the Program, the only way you could satisfy both those terms and this
License would be to refrain entirely from conveying the Program.
</p>

<ol class="org-ol">
<li>Use with the GNU Affero General Public License.</li>
</ol>

<p>
  Notwithstanding any other provision of this License, you have
permission to link or combine any covered work with a work licensed
under version 3 of the GNU Affero General Public License into a single
combined work, and to convey the resulting work.  The terms of this
License will continue to apply to the part which is the covered work,
but the special requirements of the GNU Affero General Public License,
section 13, concerning interaction through a network will apply to the
combination as such.
</p>

<ol class="org-ol">
<li>Revised Versions of this License.</li>
</ol>

<p>
  The Free Software Foundation may publish revised and/or new versions of
the GNU General Public License from time to time.  Such new versions will
be similar in spirit to the present version, but may differ in detail to
address new problems or concerns.
</p>

<p>
  Each version is given a distinguishing version number.  If the
Program specifies that a certain numbered version of the GNU General
Public License "or any later version" applies to it, you have the
option of following the terms and conditions either of that numbered
version or of any later version published by the Free Software
Foundation.  If the Program does not specify a version number of the
GNU General Public License, you may choose any version ever published
by the Free Software Foundation.
</p>

<p>
  If the Program specifies that a proxy can decide which future
versions of the GNU General Public License can be used, that proxy's
public statement of acceptance of a version permanently authorizes you
to choose that version for the Program.
</p>

<p>
  Later license versions may give you additional or different
permissions.  However, no additional obligations are imposed on any
author or copyright holder as a result of your choosing to follow a
later version.
</p>

<ol class="org-ol">
<li>Disclaimer of Warranty.</li>
</ol>

<p>
  THERE IS NO WARRANTY FOR THE PROGRAM, TO THE EXTENT PERMITTED BY
APPLICABLE LAW.  EXCEPT WHEN OTHERWISE STATED IN WRITING THE COPYRIGHT
HOLDERS AND/OR OTHER PARTIES PROVIDE THE PROGRAM "AS IS" WITHOUT WARRANTY
OF ANY KIND, EITHER EXPRESSED OR IMPLIED, INCLUDING, BUT NOT LIMITED TO,
THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
PURPOSE.  THE ENTIRE RISK AS TO THE QUALITY AND PERFORMANCE OF THE PROGRAM
IS WITH YOU.  SHOULD THE PROGRAM PROVE DEFECTIVE, YOU ASSUME THE COST OF
ALL NECESSARY SERVICING, REPAIR OR CORRECTION.
</p>

<ol class="org-ol">
<li>Limitation of Liability.</li>
</ol>

<p>
  IN NO EVENT UNLESS REQUIRED BY APPLICABLE LAW OR AGREED TO IN WRITING
WILL ANY COPYRIGHT HOLDER, OR ANY OTHER PARTY WHO MODIFIES AND/OR CONVEYS
THE PROGRAM AS PERMITTED ABOVE, BE LIABLE TO YOU FOR DAMAGES, INCLUDING ANY
GENERAL, SPECIAL, INCIDENTAL OR CONSEQUENTIAL DAMAGES ARISING OUT OF THE
USE OR INABILITY TO USE THE PROGRAM (INCLUDING BUT NOT LIMITED TO LOSS OF
DATA OR DATA BEING RENDERED INACCURATE OR LOSSES SUSTAINED BY YOU OR THIRD
PARTIES OR A FAILURE OF THE PROGRAM TO OPERATE WITH ANY OTHER PROGRAMS),
EVEN IF SUCH HOLDER OR OTHER PARTY HAS BEEN ADVISED OF THE POSSIBILITY OF
SUCH DAMAGES.
</p>

<ol class="org-ol">
<li>Interpretation of Sections 15 and 16.</li>
</ol>

<p>
  If the disclaimer of warranty and limitation of liability provided
above cannot be given local legal effect according to their terms,
reviewing courts shall apply local law that most closely approximates
an absolute waiver of all civil liability in connection with the
Program, unless a warranty or assumption of liability accompanies a
copy of the Program in return for a fee.
</p>

<p>
END OF TERMS AND CONDITIONS
</p>

<p>
How to Apply These Terms to Your New Programs
</p>

<p>
  If you develop a new program, and you want it to be of the greatest
possible use to the public, the best way to achieve this is to make it
free software which everyone can redistribute and change under these terms.
</p>

<p>
  To do so, attach the following notices to the program.  It is safest
to attach them to the start of each source file to most effectively
state the exclusion of warranty; and each file should have at least
the "copyright" line and a pointer to where the full notice is found.
</p>

<p>
&lt;one line to give the program's name and a brief idea of what it does.&gt;
Copyright (C) &lt;year&gt;  &lt;name of author&gt;
</p>

<p>
This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.
</p>

<p>
This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.
</p>

<p>
You should have received a copy of the GNU General Public License
along with this program.  If not, see
<a href="https://www.gnu.org/licenses/">https:// www. gnu. org/ licenses/</a>
</p>

<p>
Also add information on how to contact you by electronic and paper mail.
</p>

<p>
  If the program does terminal interaction, make it output a short
notice like this when it starts in an interactive mode:
</p>

<p>
&lt;program&gt;  Copyright (C) &lt;year&gt;  &lt;name of author&gt;
This program comes with ABSOLUTELY NO WARRANTY; for details type `show w'.
This is free software, and you are welcome to redistribute it
under certain conditions; type `show c' for details.
</p>

<p>
The hypothetical commands `show w' and `show c' should show the appropriate
parts of the General Public License.  Of course, your program's commands
might be different; for a GUI interface, you would use an "about box".
</p>

<p>
  You should also get your employer (if you work as a programmer) or
school, if any, to sign a "copyright disclaimer" for the program, if
necessary.  For more information on this, and how to apply and follow
the GNU GPL, see <a href="https://www.gnu.org/licenses/">https://
www. gnu. org/ licenses/</a>
</p>

<p>
  The GNU General Public License does not permit incorporating your program
into proprietary programs.  If your program is a subroutine library, you
may consider it more useful to permit linking proprietary applications with
the library.  If this is what you want to do, use the GNU Lesser General
Public License instead of this License.  But first, please read
<a href="https://www.gnu.org/licenses/why-not-lgpl.html">why not lgpl</a>
</p>
</div>
</div>
<div id="outline-container-orgf36eb19" class="outline-2">
<h2 id="orgf36eb19">A</h2>
<div class="outline-text-2" id="text-orgf36eb19">
<ul class="org-ul">
<li><a href="Sigma16UserGuide.html#MissingReference">architecture</a></li>
<li><a href="Sigma16UserGuide.html#MissingReference">assembler</a></li>
</ul>
</div>
</div>
<div id="outline-container-orgecb049e" class="outline-2">
<h2 id="orgecb049e">C</h2>
<div class="outline-text-2" id="text-orgecb049e">
<ul class="org-ul">
<li><a href="Sigma16UserGuide.html#MissingReference">command line</a></li>
</ul>
</div>
</div>
<div id="outline-container-org8de37af" class="outline-2">
<h2 id="org8de37af">R</h2>
<div class="outline-text-2" id="text-org8de37af">
<ul class="org-ul">
<li><a href="Sigma16UserGuide.html#MissingReference">register file</a></li>
<li><a href="Sigma16UserGuide.html#MissingReference">run</a></li>
</ul>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: John T. O'Donnell (<a href="mailto:john.t.odonnell9@gmail.com">john.t.odonnell9@gmail.com</a>)</p>
<p class="date">Date: Version 3.9.0, February 2025</p>
<p class="creator"><a href="https://www.gnu.org/software/emacs/">Emacs</a> 29.4 (<a href="https://orgmode.org">Org</a> mode 9.6.15)</p>
<p class="build-date"> User Guide Build: Sat Feb  1 22:49:36 2025 </p> <p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
<!-- post html 13292 lines, 146 CL envs -->
