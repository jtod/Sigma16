
<!DOCTYPE html>
<html lang="en-US">
<head>
<meta charset="UTF-8" />
<meta name="author" content="John T. O’Donnell" />
<meta name="generator" content="LaTeX Lwarp package" />
<meta name="description" content="Sigma16 system documentation" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Sigma16 User Guide — A strange program</title>
<link rel="stylesheet" type="text/css" href="lwarp.css" />

<script>
// Lwarp MathJax emulation code
//
// Based on code by Davide P. Cervone.
// Equation numbering: https://github.com/mathjax/MathJax/issues/2427
// Starred and ifnextchar macros: https://github.com/mathjax/MathJax/issues/2428
// \left, \right delimiters: https://github.com/mathjax/MathJax/issues/2535
//
// Modified by Brian Dunn to adjust equation numbering and add subequations.
//
// LaTeX can use \seteqnumber{subequations?}{section}{number} before each equation.
// subequations? is 0 usually, 1 if inside subequations.
// section is a string printed as-is, or empty.
// number is auto-incremented by MathJax between equations.
//
MathJax = {
    subequations: "0",
    section: "",
    loader: {
        load: ['[tex]/tagformat', '[tex]/textmacros'],
    },
    startup: {
        ready() {
            //      These would be replaced by import commands if you wanted to make
            //      a proper extension.
            const Configuration = MathJax._.input.tex.Configuration.Configuration;
            const CommandMap = MathJax._.input.tex.SymbolMap.CommandMap;
            const Macro = MathJax._.input.tex.Symbol.Macro;
            const TexError = MathJax._.input.tex.TexError.default;
            const ParseUtil = MathJax._.input.tex.ParseUtil.default;
            const expandable = MathJax._.util.Options.expandable;


            //      Insert the replacement string into the TeX string, and check
            //      that there haven't been too many maxro substitutions (prevents
            //      infinite loops).
            const useArgument = (parser, text) => {
                parser.string = ParseUtil.addArgs(parser, text, parser.string.slice(parser.i));
                parser.i = 0;
                if (++parser.macroCount > parser.configuration.options.maxMacros) {
                    throw new TexError('MaxMacroSub1',
                    'MathJax maximum macro substitution count exceeded; ' +
                    'is there a recursive macro call?');
                }
            }


            //      Create the command map for:
            //          \ifstar, \ifnextchar, \ifblank, \ifstrequal, \gsub, \seteqnumber
            new CommandMap('Lwarp-macros', {
                ifstar: 'IfstarFunction',
                ifnextchar: 'IfnextcharFunction',
                ifblank: 'IfblankFunction',
                ifstrequal: 'IfstrequalFunction',
                gsubstitute: 'GsubstituteFunction',
                seteqnumber: 'SeteqnumberFunction'
            }, {
                //      This function implements an ifstar macro.
                IfstarFunction(parser, name) {
                    const resultstar = parser.GetArgument(name);
                    const resultnostar = parser.GetArgument(name);
                    const star = parser.GetStar();                      // true if there is a *
                    useArgument(parser, star ? resultstar : resultnostar);
                },


                //      This function implements an ifnextchar macro.
                IfnextcharFunction(parser, name) {
                    let whichchar = parser.GetArgument(name);
                    if (whichchar.match(/^(?:0x[0-9A-F]+|[0-9]+)$/i)) {
                        // $ syntax highlighting
                        whichchar = String.fromCodePoint(parseInt(whichchar));
                    }
                    const resultnextchar = parser.GetArgument(name);
                    const resultnotnextchar = parser.GetArgument(name);
                    const gotchar = (parser.GetNext() === whichchar);
                    useArgument(parser, gotchar ? resultnextchar : resultnotnextchar);
                },


                // This function implements an ifblank macro.
                IfblankFunction(parser, name) {
                    const blankarg = parser.GetArgument(name);
                    const resultblank = parser.GetArgument(name);
                    const resultnotblank = parser.GetArgument(name);
                    const isblank = (blankarg.trim() == "");
                    useArgument(parser, isblank ? resultblank : resultnotblank);
                },


                // This function implements an ifstrequal macro.
                IfstrequalFunction(parser, name) {
                    const strequalfirst = parser.GetArgument(name);
                    const strequalsecond = parser.GetArgument(name);
                    const resultequal = parser.GetArgument(name);
                    const resultnotequal = parser.GetArgument(name);
                    const isequal = (strequalfirst == strequalsecond);
                    useArgument(parser, isequal ? resultequal : resultnotequal);
                },


                // This function implements a gsub macro.
                GsubstituteFunction(parser, name) {
                    const gsubfirst = parser.GetArgument(name);
                    const gsubsecond = parser.GetArgument(name);
                    const gsubthird = parser.GetArgument(name);
                    let gsubresult=gsubfirst.replace(gsubsecond, gsubthird);
                    useArgument(parser, gsubresult);
                },


                //      This function modifies the equation numbers.
                SeteqnumberFunction(parser, name) {
                        //   Get the macro parameters
                        const star = parser.GetStar();                    // true if there is a *
                        const optBrackets = parser.GetBrackets(name);     // contents of optional brackets
                        const newsubequations = parser.GetArgument(name);    // the subequations argument
                        const neweqsection = parser.GetArgument(name);    // the eq section argument
                        const neweqnumber = parser.GetArgument(name);     // the eq number argument
                        MathJax.config.subequations=newsubequations ;     // a string with boolean meaning
                        MathJax.config.section=neweqsection ;             // a string with numeric meaning
                        parser.tags.counter = parser.tags.allCounter = neweqnumber ;
                }


            });


            //      Create the Lwarp-macros package
            Configuration.create('Lwarp-macros', {
                handler: {macro: ['Lwarp-macros']}
            });


            MathJax.startup.defaultReady();


            // For forward references:
            MathJax.startup.input[0].preFilters.add(({math}) => {
                if (math.inputData.recompile){
                        MathJax.config.subequations = math.inputData.recompile.subequations;
                        MathJax.config.section = math.inputData.recompile.section;
                }
            });
            MathJax.startup.input[0].postFilters.add(({math}) => {
                if (math.inputData.recompile){
                        math.inputData.recompile.subequations = MathJax.config.subequations;
                        math.inputData.recompile.section = MathJax.config.section;
                }
            });


                // For \left, \right with unicode-math:
                const {DelimiterMap} = MathJax._.input.tex.SymbolMap;
                const {Symbol} = MathJax._.input.tex.Symbol;
                const {MapHandler} = MathJax._.input.tex.MapHandler;
                const delimiter = MapHandler.getMap('delimiter');
                delimiter.add('\\lBrack', new Symbol('\\lBrack', '\u27E6'));
                delimiter.add('\\rBrack', new Symbol('\\rBrack', '\u27E7'));
                delimiter.add('\\lAngle', new Symbol('\\lAngle', '\u27EA'));
                delimiter.add('\\rAngle', new Symbol('\\rAngle', '\u27EB'));
                delimiter.add('\\lbrbrak', new Symbol('\\lbrbrak', '\u2772'));
                delimiter.add('\\rbrbrak', new Symbol('\\rbrbrak', '\u2773'));
                delimiter.add('\\lbag', new Symbol('\\lbag', '\u27C5'));
                delimiter.add('\\rbag', new Symbol('\\rbag', '\u27C6'));
                delimiter.add('\\llparenthesis', new Symbol('\\llparenthesis', '\u2987'));
                delimiter.add('\\rrparenthesis', new Symbol('\\rrparenthesis', '\u2988'));
                delimiter.add('\\llangle', new Symbol('\\llangle', '\u2989'));
                delimiter.add('\\rrangle', new Symbol('\\rrangle', '\u298A'));
                delimiter.add('\\Lbrbrak', new Symbol('\\Lbrbrak', '\u27EC'));
                delimiter.add('\\Rbrbrak', new Symbol('\\Rbrbrak', '\u27ED'));
                delimiter.add('\\lBrace', new Symbol('\\lBrace', '\u2983'));
                delimiter.add('\\rBrace', new Symbol('\\rBrace', '\u2984'));
                delimiter.add('\\lParen', new Symbol('\\lParen', '\u2985'));
                delimiter.add('\\rParen', new Symbol('\\rParen', '\u2986'));
                delimiter.add('\\lbrackubar', new Symbol('\\lbrackubar', '\u298B'));
                delimiter.add('\\rbrackubar', new Symbol('\\rbrackubar', '\u298C'));
                delimiter.add('\\lbrackultick', new Symbol('\\lbrackultick', '\u298D'));
                delimiter.add('\\rbracklrtick', new Symbol('\\rbracklrtick', '\u298E'));
                delimiter.add('\\lbracklltick', new Symbol('\\lbracklltick', '\u298F'));
                delimiter.add('\\rbrackurtick', new Symbol('\\rbrackurtick', '\u2990'));
                delimiter.add('\\langledot', new Symbol('\\langledot', '\u2991'));
                delimiter.add('\\rangledot', new Symbol('\\rangledot', '\u2992'));
                delimiter.add('\\lparenless', new Symbol('\\lparenless', '\u2993'));
                delimiter.add('\\rparengtr', new Symbol('\\rparengtr', '\u2994'));
                delimiter.add('\\Lparengtr', new Symbol('\\Lparengtr', '\u2995'));
                delimiter.add('\\Rparenless', new Symbol('\\Rparenless', '\u2996'));
                delimiter.add('\\lblkbrbrak', new Symbol('\\lblkbrbrak', '\u2997'));
                delimiter.add('\\rblkbrbrak', new Symbol('\\rblkbrbrak', '\u2998'));
                delimiter.add('\\lvzigzag', new Symbol('\\lvzigzag', '\u29D8'));
                delimiter.add('\\rvzigzag', new Symbol('\\rvzigzag', '\u29D9'));
                delimiter.add('\\Lvzigzag', new Symbol('\\Lvzigzag', '\u29DA'));
                delimiter.add('\\Rvzigzag', new Symbol('\\Rvzigzag', '\u29DB'));
                delimiter.add('\\lcurvyangle', new Symbol('\\lcurvyangle', '\u29FC'));
                delimiter.add('\\rcurvyangle', new Symbol('\\rcurvyangle', '\u29FD'));
                delimiter.add('\\Vvert', new Symbol('\\Vvert', '\u2980'));
        }        // ready
    },           // startup


    tex: {
        packages: {'[+]': ['tagformat', 'Lwarp-macros', 'textmacros']},
        tags: "ams",
                tagformat: {
                        number: function (n) {
                             if(MathJax.config.subequations==0)
                                 return(MathJax.config.section + n);
                             else
                                 return(MathJax.config.section + String.fromCharCode(96+n));
                        },
                },
    }
}
</script>


<script
        id="MathJax-script"
        src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"
></script>

</head>
<body>


<a id="Sigma16UserGuide-autopage-75"></a>
<nav class="topnavigation"><a href="index.html" class="linkhome" >
Home</a></nav>


<div class="bodyandsidetoc">
<div class="sidetoccontainer">


<nav class="sidetoc">


<div class="sidetoctitle">

<p>
<span class="sidetocthetitle">Sigma16 User Guide</span>
</p>

<p>
Contents
</p>
</div>


<div class="sidetoccontents">

<p>
<a href="index.html" class="linkhome" >
Home</a>
</p>

<p>
<a href="Introduction.html#autosec-5" class="tocsection" >
<span class="sectionnumber">1</span>&#x2003;Introduction</a>
</p>


<p>
<a href="Core-architecture-tutorials.html#autosec-7" class="tocsection" >
<span class="sectionnumber">2</span>&#x2003;Core architecture tutorials</a>
</p>


<p>
<a href="Core-architecture-tutorials.html#autosec-8" class="tocsubsection" >
<span class="sectionnumber">2.1</span>&#x2003;Hello, world!</a>
</p>


<p>
<a href="A-quick-tour.html#autosec-10" class="tocsubsection" >
<span class="sectionnumber">2.2</span>&#x2003;A quick tour</a>
</p>


<p>
<a href="Registers-constants-arithmetic.html#autosec-12" class="tocsubsection" >
<span class="sectionnumber">2.3</span>&#x2003;Registers, constants, and arithmetic</a>
</p>


<p>
<a href="Keeping-variables-in-memory.html#autosec-27" class="tocsubsection" >
<span class="sectionnumber">2.4</span>&#x2003;Keeping variables in memory</a>
</p>


<p>
<a href="Assembly-language.html#autosec-32" class="tocsubsection" >
<span class="sectionnumber">2.5</span>&#x2003;Assembly language</a>
</p>


<p>
<a href="Editing-files.html#autosec-41" class="tocsubsection" >
<span class="sectionnumber">2.6</span>&#x2003;Editing files</a>
</p>


<p>
<a href="Jumps-conditionals.html#autosec-43" class="tocsubsection" >
<span class="sectionnumber">2.7</span>&#x2003;Jumps and conditionals</a>
</p>


<p>
<a href="Loops.html#autosec-58" class="tocsubsection" >
<span class="sectionnumber">2.8</span>&#x2003;Loops</a>
</p>


<p>
<a href="Machine-language.html#autosec-65" class="tocsubsection" >
<span class="sectionnumber">2.9</span>&#x2003;Machine language</a>
</p>


<p>
<a href="Pseudoinstructions.html#autosec-72" class="tocsubsection" >
<span class="sectionnumber">2.10</span>&#x2003;Pseudoinstructions</a>
</p>


<p>
<a href="A-strange-program.html#autosec-76" class="tocsubsection" >
<span class="sectionnumber">2.11</span>&#x2003;A strange program</a>
</p>


<p>
<a href="Breakpoints.html#autosec-79" class="tocsubsection" >
<span class="sectionnumber">2.12</span>&#x2003;Breakpoints</a>
</p>


<p>
<a href="Summary-core-instruction-formats.html#autosec-86" class="tocsubsection" >
<span class="sectionnumber">2.13</span>&#x2003;Summary of core instruction formats</a>
</p>


<p>
<a href="Summary-core-instructions.html#autosec-91" class="tocsubsection" >
<span class="sectionnumber">2.14</span>&#x2003;Summary of core instructions</a>
</p>


<p>
<a href="Standard-architecture-tutorials.html#autosec-93" class="tocsection" >
<span class="sectionnumber">3</span>&#x2003;Standard architecture tutorials</a>
</p>


<p>
<a href="Standard-architecture-tutorials.html#autosec-94" class="tocsubsection" >
<span class="sectionnumber">3.1</span>&#x2003;Logic</a>
</p>


<p>
<a href="Shifting.html#autosec-97" class="tocsubsection" >
<span class="sectionnumber">3.2</span>&#x2003;Shifting</a>
</p>


<p>
<a href="Bit-fields.html#autosec-101" class="tocsubsection" >
<span class="sectionnumber">3.3</span>&#x2003;Bit fields</a>
</p>


<p>
<a href="Saving-registers-procedure-call.html#autosec-107" class="tocsubsection" >
<span class="sectionnumber">3.4</span>&#x2003;Saving registers for procedure call</a>
</p>


<p>
<a href="Branching-pc-relative-address.html#autosec-111" class="tocsubsection" >
<span class="sectionnumber">3.5</span>&#x2003;Branching to pc-relative address</a>
</p>


<p>
<a href="Stack-instructions.html#autosec-113" class="tocsubsection" >
<span class="sectionnumber">3.6</span>&#x2003;Stack instructions</a>
</p>


<p>
<a href="Arithmetic-on-natural-numbers.html#autosec-115" class="tocsubsection" >
<span class="sectionnumber">3.7</span>&#x2003;Arithmetic on natural numbers</a>
</p>


<p>
<a href="Modules-linking.html#autosec-117" class="tocsubsection" >
<span class="sectionnumber">3.8</span>&#x2003;Modules and linking</a>
</p>


<p>
<a href="System-control-registers.html#autosec-119" class="tocsubsection" >
<span class="sectionnumber">3.9</span>&#x2003;System control registers</a>
</p>


<p>
<a href="Interrupts.html#autosec-121" class="tocsubsection" >
<span class="sectionnumber">3.10</span>&#x2003;Interrupts</a>
</p>


<p>
<a href="The-Sigma16-architecture.html#autosec-123" class="tocsection" >
<span class="sectionnumber">4</span>&#x2003;The Sigma16 architecture</a>
</p>


<p>
<a href="The-Sigma16-architecture.html#autosec-124" class="tocsubsection" >
<span class="sectionnumber">4.1</span>&#x2003;Implementations</a>
</p>


<p>
<a href="Subsystems.html#autosec-126" class="tocsubsection" >
<span class="sectionnumber">4.2</span>&#x2003;Subsystems</a>
</p>


<p>
<a href="Words.html#autosec-128" class="tocsubsection" >
<span class="sectionnumber">4.3</span>&#x2003;Words</a>
</p>


<p>
<a href="Memory.html#autosec-139" class="tocsubsection" >
<span class="sectionnumber">4.4</span>&#x2003;Memory</a>
</p>


<p>
<a href="Registers.html#autosec-141" class="tocsubsection" >
<span class="sectionnumber">4.5</span>&#x2003;Registers</a>
</p>


<p>
<a href="Instruction-representation.html#autosec-158" class="tocsubsection" >
<span class="sectionnumber">4.6</span>&#x2003;Instruction representation</a>
</p>


<p>
<a href="Instruction-set.html#autosec-182" class="tocsection" >
<span class="sectionnumber">5</span>&#x2003;Instruction set</a>
</p>


<p>
<a href="Instruction-set.html#autosec-183" class="tocsubsection" >
<span class="sectionnumber">5.1</span>&#x2003;Accessing memory</a>
</p>


<p>
<a href="Arithmetic.html#autosec-213" class="tocsubsection" >
<span class="sectionnumber">5.2</span>&#x2003;Arithmetic</a>
</p>


<p>
<a href="Jumps.html#autosec-237" class="tocsubsection" >
<span class="sectionnumber">5.3</span>&#x2003;Jumps</a>
</p>


<p>
<a href="Branches.html#autosec-246" class="tocsubsection" >
<span class="sectionnumber">5.4</span>&#x2003;Branches</a>
</p>


<p>
<a href="Logic.html#autosec-258" class="tocsubsection" >
<span class="sectionnumber">5.5</span>&#x2003;Logic</a>
</p>


<p>
<a href="Bit-manipulation.html#autosec-298" class="tocsubsection" >
<span class="sectionnumber">5.6</span>&#x2003;Bit manipulation</a>
</p>


<p>
<a href="System-control.html#autosec-317" class="tocsubsection" >
<span class="sectionnumber">5.7</span>&#x2003;System control</a>
</p>


<p>
<a href="Summary-instruction-set.html#autosec-326" class="tocsection" >
<span class="sectionnumber">6</span>&#x2003;Summary of instruction set</a>
</p>


<p>
<a href="Assembly-language-2.html#autosec-341" class="tocsection" >
<span class="sectionnumber">7</span>&#x2003;Assembly language 2</a>
</p>


<p>
<a href="Assembly-language-2.html#autosec-344" class="tocsubsection" >
<span class="sectionnumber">7.1</span>&#x2003;Programs, modules, and files</a>
</p>


<p>
<a href="Fixed-relocatable-values.html#autosec-357" class="tocsubsection" >
<span class="sectionnumber">7.2</span>&#x2003;Fixed and relocatable values</a>
</p>


<p>
<a href="Code-generators.html#autosec-366" class="tocsubsection" >
<span class="sectionnumber">7.3</span>&#x2003;Code generators</a>
</p>


<p>
<a href="Directives.html#autosec-381" class="tocsubsection" >
<span class="sectionnumber">7.4</span>&#x2003;Directives</a>
</p>


<p>
<a href="Object-code-linker.html#autosec-404" class="tocsection" >
<span class="sectionnumber">8</span>&#x2003;Object code and linker</a>
</p>


<p>
<a href="Object-code-linker.html#autosec-405" class="tocsubsection" >
<span class="sectionnumber">8.1</span>&#x2003;Object language</a>
</p>


<p>
<a href="Module-metadata.html#autosec-425" class="tocsubsection" >
<span class="sectionnumber">8.2</span>&#x2003;Module metadata</a>
</p>


<p>
<a href="Linker.html#autosec-428" class="tocsubsection" >
<span class="sectionnumber">8.3</span>&#x2003;Linker</a>
</p>


<p>
<a href="Booter.html#autosec-430" class="tocsubsection" >
<span class="sectionnumber">8.4</span>&#x2003;Booter</a>
</p>


<p>
<a href="Programming.html#autosec-433" class="tocsection" >
<span class="sectionnumber">9</span>&#x2003;Programming</a>
</p>


<p>
<a href="Programming.html#autosec-434" class="tocsubsection" >
<span class="sectionnumber">9.1</span>&#x2003;Structure of a program</a>
</p>


<p>
<a href="How-perform-commmon-tasks.html#autosec-437" class="tocsubsection" >
<span class="sectionnumber">9.2</span>&#x2003;How to perform commmon tasks</a>
</p>


<p>
<a href="Compilation.html#autosec-444" class="tocsubsection" >
<span class="sectionnumber">9.3</span>&#x2003;Compilation</a>
</p>


<p>
<a href="Errors-avoiding-finding-fixing.html#autosec-449" class="tocsubsection" >
<span class="sectionnumber">9.4</span>&#x2003;Errors: avoiding, finding, and fixing</a>
</p>


<p>
<a href="Installation.html#autosec-462" class="tocsection" >
<span class="sectionnumber">10</span>&#x2003;Installation</a>
</p>


<p>
<a href="Installation.html#autosec-463" class="tocsubsection" >
<span class="sectionnumber">10.1</span>&#x2003;Command line tools</a>
</p>


<p>
<a href="About-Sigma16.html#autosec-476" class="tocsection" >
<span class="sectionnumber">11</span>&#x2003;About Sigma16</a>
</p>


<p>
<a href="About-Sigma16.html#autosec-477" class="tocsubsection" >
<span class="sectionnumber">11.1</span>&#x2003;Copyright and license</a>
</p>


<p>
<a href="In-case-problems.html#autosec-479" class="tocsubsection" >
<span class="sectionnumber">11.2</span>&#x2003;In case of problems</a>
</p>


<p>
<a href="Release-notes.html#autosec-481" class="tocsubsection" >
<span class="sectionnumber">11.3</span>&#x2003;Release notes</a>
</p>


<p>
<a href="GPL3-license.html#autosec-495" class="tocsubsection" >
<span class="sectionnumber">11.4</span>&#x2003;GPL3 license</a>
</p>


</div>

</nav>

</div>


<main class="bodycontainer">


<section class="textbody">

<h1>Sigma16 User Guide</h1>

<!--MathJax customizations:-->


<div class="hidden">

\(\newcommand{\footnotename}{footnote}\)

\(\def \LWRfootnote {1}\)

\(\newcommand {\footnote }[2][\LWRfootnote ]{{}^{\mathrm {#1}}}\)

\(\newcommand {\footnotemark }[1][\LWRfootnote ]{{}^{\mathrm {#1}}}\)

\(\let \LWRorighspace \hspace \)

\(\renewcommand {\hspace }{\ifstar \LWRorighspace \LWRorighspace }\)

\(\newcommand {\mathnormal }[1]{{#1}}\)

\(\newcommand \ensuremath [1]{#1}\)

\(\newcommand {\LWRframebox }[2][]{\fbox {#2}} \newcommand {\framebox }[1][]{\LWRframebox } \)

\(\newcommand {\setlength }[2]{}\)

\(\newcommand {\addtolength }[2]{}\)

\(\newcommand {\setcounter }[2]{}\)

\(\newcommand {\addtocounter }[2]{}\)

\(\newcommand {\arabic }[1]{}\)

\(\newcommand {\number }[1]{}\)

\(\newcommand {\noalign }[1]{\text {#1}\notag \\}\)

\(\newcommand {\cline }[1]{}\)

\(\newcommand {\directlua }[1]{\text {(directlua)}}\)

\(\newcommand {\luatexdirectlua }[1]{\text {(directlua)}}\)

\(\newcommand {\protect }{}\)

\(\def \LWRabsorbnumber #1 {}\)

\(\def \LWRabsorbquotenumber &quot;#1 {}\)

\(\newcommand {\LWRabsorboption }[1][]{}\)

\(\newcommand {\LWRabsorbtwooptions }[1][]{\LWRabsorboption }\)

\(\def \mathchar {\ifnextchar &quot;\LWRabsorbquotenumber \LWRabsorbnumber }\)

\(\def \mathcode #1={\mathchar }\)

\(\let \delcode \mathcode \)

\(\let \delimiter \mathchar \)

\(\def \oe {\unicode {x0153}}\)

\(\def \OE {\unicode {x0152}}\)

\(\def \ae {\unicode {x00E6}}\)

\(\def \AE {\unicode {x00C6}}\)

\(\def \aa {\unicode {x00E5}}\)

\(\def \AA {\unicode {x00C5}}\)

\(\def \o {\unicode {x00F8}}\)

\(\def \O {\unicode {x00D8}}\)

\(\def \l {\unicode {x0142}}\)

\(\def \L {\unicode {x0141}}\)

\(\def \ss {\unicode {x00DF}}\)

\(\def \SS {\unicode {x1E9E}}\)

\(\def \dag {\unicode {x2020}}\)

\(\def \ddag {\unicode {x2021}}\)

\(\def \P {\unicode {x00B6}}\)

\(\def \copyright {\unicode {x00A9}}\)

\(\def \pounds {\unicode {x00A3}}\)

\(\let \LWRref \ref \)

\(\renewcommand {\ref }{\ifstar \LWRref \LWRref }\)

\( \newcommand {\multicolumn }[3]{#3}\)

\(\require {textcomp}\)

</div>

<p>
<!--
...... subsection A strange program ......
-->
<h5 id="autosec-76"><span class="sectionnumber">2.11&#x2003;</span>A strange program</h5>
<a id="Sigma16UserGuide-autopage-76"></a>
<a id="Sigma16UserGuide-autofile-12"></a> <a id="sec:orgaa945ea"></a>

<p>
Consider “Program Strange” below. This program doesn’t compute anything particularly useful. It’s rather strange and not a model for good programming style, but it illustrates an extremely important concept, which is discussed below.
</p>

<p>
You can find the program on the Examples page, in the Core section, or you can copy it below and paste it into the Editor page. Run the program with different initial values of a variable <b>y</b>, as described below. For each value of <b>y</b>,
first try executing the program manually, with paper and pencil, and then run it on the emulator to check whether your execution was correct. Give the final values of the registers, and think about what is going on as the program runs. For each run,
assume that all the registers contain 0 after the program is booted, before it begins execution.
</p>

<ul style="list-style-type:none">

<li>
<p>
1. Run the program in its original form, with <b>y data 0</b>
</p>

</li>
<li>

<p>
2. Change the last line to <b>y data 1</b> and run it again
</p>

</li>
<li>

<p>
3. Now use <b>y data 256</b>
</p>

</li>
<li>

<p>
4. <b>y data 8192</b>
</p>

</li>
<li>

<p>
5. <b>y data -5424</b>
</p>
</li>
</ul>
<pre class="verbatim">
; Strange: A Sigma16 program that is a bit strange
          load    R1,y[R0]
          load    R2,x[R0]
          add     R2,R2,R1
          store   R2,x[R0]
          lea     R3,3[R0]
          lea     R4,4[R0]
x         add     R5,R3,R3
          add     R0,R0,R7
          trap    R0,R0,R0
y         data    0

</pre>

<p>
<b>Solution</b> – it’s best to try answering the questions on your own first, and then to check by running the program on the emulator, before reading the solution!
</p>

<p>
The program loads an <b>instruction</b> into a register, does arithmetic on it by adding <b>y</b> to it, and stores the result back into memory. This phenomenon is called <b>self-modifying code</b>, and it exploits the fact that instructions
and data are held in the same memory (this is the <b>stored program computer</b> concept). The original instruction is <b>add R5,R3,R3</b>, and its machine language code is 0533.
</p>

<ul style="list-style-type:none">

<li>
<p>
1. When y=0, the final values are: R1=0, R2=0533, R3=3, R4=4, R5=6. The only notable points are that the store instruction doesn’t actually change the value of the word in memory (it was 0533 and 0533 is being stored there), and the last add
instruction doesn’t change the value in R0 because R0 can never change; it is always 0. (Of course if R7=0 then the result of the addition is 0 anyway.)
</p>
</li>
<li>

<p>
2. When y=1, the final values are: R1=1, R2=0534, R3=3, R4=4, R5=7. Note that R5 is <b>not</b> 3+3=6. When y=1 is added to the instruction, the result is 0534 which means <b>add R5,R3,R4</b>, so instead of adding R3+R3 it adds
R3+R4.
</p>
</li>
<li>

<p>
3. When y=256, the final values are: R1=256=0100, R2=0633, R3=3, R4=4, R5=0, R6=6. The decimal number 256 is 0100 in hexadecimal. When this is added to the instruction, the result is 0633, which means <b>add R6,R3,R3</b> so R3+R3
is loaded into R6, not into R5.
</p>
</li>
<li>

<p>
4. When y=8192, the final values are: R1=4096=2000, R2=2533, R3=3, R4=4, R5=9. The decimal number 8192 is 2000 in hexadecimal, and when this is added to the instruction the result is 2533, which means <b>mul R5,R3,R3</b>. It’s no
longer an <b>add</b> instruction, it’s a <b>multiply</b> instruction that calculates R5 := R3*R3 = 9.
</p>
</li>
<li>

<p>
5. When y=-5424 the program goes into an infinite loop. R1=ead0 (the hexadecimal representation of -5424, R2=f003, R3=3, and R4=4. What started out as the <b>add</b> instruction at x has been transformed into <b>jump 7[R0]</b>,
comprising the word at <b>x</b> (f003) and the following word (which is 0007). This jump instruction goes back to the first lea instruction, and the program runs for ever (lea, lea, jump).
</p>
</li>
</ul>

<p>
There is a lot to say about the phenomenon of self-modifying code.
</p>

<p>
This program shows clearly that a computer does not execute assembly language; it executes machine language. Try running it on the Sigma16 application (single step each instruction). You’ll see that the assembly language statement <b>add
R5,R3,R3</b> is highlighted in red, but that is just the GUI trying to be helpful. What’s important is that the machine language instruction is fetched from memory and loaded into ir (the instruction register), and that is not 0533. The machine
decodes the contents of ir and does whatever that says to do; it isn’t aware of the assembly language statement. Indeed, a machine doesn’t even understand the concept of assembly language — everything is just bits!
</p>

<p>
To follow exactly what is happening in the emulator, it’s important to look at the pc and ir registers. These reflect what the machine is doing. The assembly language does not.
</p>

<p>
What is self-modifying code good for? The answer lies in the early history of electronic computers. Early computers (late 1940s and early 1950s) did not use an effective address (i.e. displacement + index) like Sigma16; the instructions simply
specified the absolute memory address of an operand. This is ok for simple variables, but how could they process arrays?
</p>

<p>
The solution was to use self modifying code. In a loop that traverses an array, there would be a load instruction using address 0. In the body of the loop, there would be instructions to calculate the address of x[i] by loading the address of x and
adding i; this is then stored into the address field of the load instruction. That instruction is then executed, obtaining the value of x[i]. This technique became obsolete in the early 1950s with the invention of index registers and effective addresses.
</p>

<p>
The pioneers of computers considered the concept of the <b>stored program computer</b> (i.e. the program and data are in the same memory) to be fundamental and essential. One of the most important reasons was that it made arrays
possible. Now we consider the stored program concept to be fundamental <b>for different reasons</b>.
</p>

<p>
Self modifying code is tricky, and difficult to debug. It makes programs hard to read: you can’t rely on what the program says, but on what its instructions will become in the future. For these reasonas, self modifying code is now considered to be bad
programming practice.
</p>

<p>
If a program modifies itself, you can’t have one copy of the program in memory and allow it to be shared by several users. For example, it’s common now to have a web browser open with several tabs. Each tab is served by an independent process (a
separate running instance of a program that updates the window showing the web page). If you have 5 tabs open, there are 5 processes, each running the same machine language code, and there’s only one copy of that in memory. This wouldn’t work
if the program modified itself!
</p>

<p>
Self modifying code leads to security holes: if a hacker has the ability to change your machine language code in memory, they could make your own program act against you.
</p>

<p>
Modern computers use a technique called <b>segmentation</b> that prevents a program from modifying itself. This leads to increased reliability and security.
</p>

<p>
Some computers have a facility that allows you to gain the power of self modifying code without actually modifying the code in memory. The idea is to have an instruction <b>execute R1,x[R0]</b> which calculates the logical or of the two
operands and then executes the result; x is the address of an instruction and R1 contains the modification to it. The modified instruction is executed, but there is no change to the machine code in memory. This idea was used in the IBM 360 and its
successors. However, as the design of effective addresses has become more sophisticated, the execute instruction is rarely needed, and most modern computers don’t provide it.
</p>

</section>

</main>

</div>


<nav class="botnavigation"><a href="index.html" class="linkhome" >
Home</a></nav>

</body>
</html>
